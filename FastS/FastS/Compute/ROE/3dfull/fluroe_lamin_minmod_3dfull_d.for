C        Generated by TAPENADE     (INRIA, Ecuador team)
C  Tapenade 3.13 (r6666M) - 28 May 2018 09:28
C
C  Differentiation of fluroe_lamin_minmod_3dfull in forward (tangent) mode:
C   variations   of useful results: drodm
C   with respect to varying inputs: rop
C   RW status of diff variables: rop:in drodm:out
C
C
C
C
C
C
C
C
C
C
C
C***********************************************************************
C     $Date: 2013-08-26 16:00:23 +0200 (lun. 26 ao√ªt 2013) $
C     $Revision: 64 $
C     $Author: IvanMary $
C***********************************************************************
      SUBROUTINE FLUROE_LAMIN_MINMOD_3DFULL_D(ndom, ithread, param_int, 
     +                                        param_real, ind_dm, 
     +                                        ind_loop, ijkv_bloc, 
     +                                        ijkv_cache, 
     +                                        synchro_send_sock, 
     +                                        synchro_send_th, 
     +                                        synchro_receive_sock, 
     +                                        synchro_receive_th, ibloc
     +                                        , jbloc, kbloc, icache, 
     +                                        jcache, kcache, rop, ropd
     +                                        , drodm, drodmd, wig, 
     +                                        venti, ventj, ventk, ti, 
     +                                        tj, tk, vol, xmut)
      IMPLICIT NONE
C
C
Climiteur 'minmod'
C
C
      REAL souszero
      PARAMETER (souszero=-1e-12)
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
      INTEGER*4 ndom, ithread, nptpsi, icache, jcache, kcache, ibloc, 
     +          jbloc, kbloc, ijkv_bloc(3), ijkv_cache(3), ind_loop(6), 
     +          ind_dm(6), synchro_send_sock(3), synchro_send_th(3), 
     +          synchro_receive_sock(3), synchro_receive_th(3), 
     +          param_int(0:*)
C
      REAL*8 xmut(param_int(41))
      REAL*8 rop(param_int(41)*param_int(36))
      REAL*8 ropd(param_int(41)*param_int(36))
      REAL*8 drodm(param_int(41)*param_int(36))
      REAL*8 drodmd(param_int(41)*param_int(36))
      REAL*8 wig(param_int(41)*3)
      REAL*8 venti(param_int(44)*param_int(40))
      REAL*8 ventj(param_int(44)*param_int(40))
      REAL*8 ventk(param_int(44)*param_int(40))
C
      REAL*8 ti(param_int(43)*param_int(37)), tj(param_int(43)*param_int
     +       (37)), tk(param_int(43)*param_int(38))
      REAL*8 vol(param_int(43))
C
      REAL*8 param_real(0:*)
C
C Var loc
      INTEGER*4 inc, incmax, l, lt, i, j, k, incmax2, nm, nm2, np, l0, 
     +          lt0, inci, incj, inck, ci, cj, lij, ltij, inci_mtr, 
     +          incj_mtr, inck_mtr, icorr, jcorr, ls, v1, v2, v3, v4, v5
     +          , v6, wig_i, wig_j, wig_k, lt200, lt100, lt010, lt210, 
     +          lt020, lt110, lt002, lt012, lt102, lt001, lt021, lt201, 
     +          lt120, lvo, lvo200, lvo020, lvo002, vslp, lvol, lvor, ir
     +          , il, l200, l100, l010, l020, l110, l101, l011, v1mtr, 
     +          v2mtr, v3mtr, l001, l002, l210, l220, l201, l202, l021, 
     +          l022, l120, l102, l012
C
      REAL*8 c1, c2, c3, c4, c5, c6, c4sa, c5sa, c6sa, si, sj, sk, qm, 
     +       qp, tcx, tcy, tcz, tc, r1, h1, rou1, rov1, row1, r2, h2, 
     +       rou2, rov2, row2, gam, gam1, gam2, gam3, gam4, qn1, qn2, u
     +       , tdu, p1p2, roref, uref, tam, tam1, qm1, qm2, qm3, qm4, 
     +       qm5, qm6, qp1, qp2, qp3, qp4, qp5, qp6, mut1, mut2, flu1, 
     +       flu2, flu3, flu4, flu5, flu6, p1, p2, qen, sigma_1, ck_vent
     +       , div, f1, f2, f3, f4, f5, f6, fv, fv5, volinv, test
      REAL*8 cmus1, temp01, coesut, tix, tiy, tiz, tix1, tiy1, tiz1, tjx
     +       , tjy, tjz, tjx1, tjy1, tjz1, tkx, tky, tkz, tkx1, tky1, 
     +       tkz1, xmutvol, cvisq, rgp, son, c, gradu_nx, gradu_ny, 
     +       gradu_nz, gradv_nx, gradv_ny, gradv_nz, gradw_nx, gradw_ny
     +       , gradw_nz, gradt_nx, gradt_ny, gradt_nz, delp, delm, delq
     +       , slq, slp, roff, tmin_1, du, dv, dw, dp, dqn, s_1, nx, ny
     +       , nz, qn, r, v, w, h, q, r_1, psiroe, avmin, xktvol, xmulam
     +       , xmutur, xmutot
      REAL*8 qmd, qpd, r1d, h1d, rou1d, r2d, h2d, rou2d, qn1d, qn2d, ud
     +       , p1p2d, qm1d, qm2d, qm3d, qm4d, qm5d, qp1d, qp2d, qp3d, 
     +       qp4d, qp5d, flu1d, flu2d, flu3d, flu4d, flu5d, p1d, p2d, 
     +       divd, f1d, f2d, f3d, f4d, f5d, f6d, fvd, fv5d, cd, 
     +       gradu_nxd, gradu_nyd, gradu_nzd, gradv_nxd, gradv_nyd, 
     +       gradv_nzd, gradw_nxd, gradw_nyd, gradw_nzd, gradt_nxd, 
     +       gradt_nyd, gradt_nzd, delpd, delmd, delqd, slqd, slpd, 
     +       roffd, dud, dvd, dwd, dpd, dqnd, qnd, rd, vd, wd, hd, qd, 
     +       r_1d
C
C    adresse point courant pour tableau de la taille d'un domaine 
      INTEGER*4 inddm, i_1, j_1, k_1
C    adresse interface pour tableau metric
      INTEGER*4 indmtr, i_3, j_3, k_3
      INTRINSIC ABS
      INTRINSIC SQRT
      INTRINSIC MIN
      INTRINSIC MAX
      INTRINSIC SIGN
      REAL*8 max1
      REAL*8 max1d
      REAL*8 max2
      REAL*8 max2d
      REAL*8 max3
      REAL*8 max3d
      REAL*8 max4
      REAL*8 max4d
      REAL*8 max5
      REAL*8 max5d
      REAL*8 max6
      REAL*8 max6d
      REAL*8 max7
      REAL*8 max7d
      REAL*8 max8
      REAL*8 max8d
      REAL*8 max9
      REAL*8 max9d
      REAL*8 max10
      REAL*8 max10d
      REAL*8 max11
      REAL*8 max11d
      REAL*8 max12
      REAL*8 max12d
      REAL*8 max13
      REAL*8 max13d
      REAL*8 max14
      REAL*8 max14d
      REAL*8 max15
      REAL*8 max15d
      REAL*8 abs0
      REAL*8 abs0d
      REAL*8 max16
      REAL*8 abs1
      REAL*8 abs1d
      REAL*8 abs2
      REAL*8 abs3
      REAL*8 abs3d
      REAL*8 abs4
      REAL*8 abs5
      REAL*8 abs5d
      REAL*8 abs6
      REAL*8 abs7
      REAL*8 abs7d
      REAL*8 max17
      REAL*8 max17d
      REAL*8 max18
      REAL*8 max18d
      REAL*8 max19
      REAL*8 max19d
      REAL*8 max20
      REAL*8 max20d
      REAL*8 max21
      REAL*8 max21d
      REAL*8 max22
      REAL*8 max22d
      REAL*8 max23
      REAL*8 max23d
      REAL*8 max24
      REAL*8 max24d
      REAL*8 max25
      REAL*8 max25d
      REAL*8 max26
      REAL*8 max26d
      REAL*8 max27
      REAL*8 max27d
      REAL*8 max28
      REAL*8 max28d
      REAL*8 max29
      REAL*8 max29d
      REAL*8 max30
      REAL*8 max30d
      REAL*8 max31
      REAL*8 max31d
      REAL*8 abs8
      REAL*8 abs8d
      REAL*8 max32
      REAL*8 abs9
      REAL*8 abs9d
      REAL*8 abs10
      REAL*8 abs11
      REAL*8 abs11d
      REAL*8 abs12
      REAL*8 abs13
      REAL*8 abs13d
      REAL*8 abs14
      REAL*8 abs15
      REAL*8 abs15d
      REAL*8 max33
      REAL*8 max33d
      REAL*8 max34
      REAL*8 max34d
      REAL*8 max35
      REAL*8 max35d
      REAL*8 max36
      REAL*8 max36d
      REAL*8 max37
      REAL*8 max37d
      REAL*8 max38
      REAL*8 max38d
      REAL*8 max39
      REAL*8 max39d
      REAL*8 max40
      REAL*8 max40d
      REAL*8 max41
      REAL*8 max41d
      REAL*8 max42
      REAL*8 max42d
      REAL*8 max43
      REAL*8 max43d
      REAL*8 max44
      REAL*8 max44d
      REAL*8 max45
      REAL*8 max45d
      REAL*8 max46
      REAL*8 max46d
      REAL*8 max47
      REAL*8 max47d
      REAL*8 abs16
      REAL*8 abs16d
      REAL*8 max48
      REAL*8 abs17
      REAL*8 abs17d
      REAL*8 abs18
      REAL*8 abs19
      REAL*8 abs19d
      REAL*8 abs20
      REAL*8 abs21
      REAL*8 abs21d
      REAL*8 abs22
      REAL*8 abs23
      REAL*8 abs23d
      REAL*8 max49
      REAL*8 max49d
      REAL*8 max50
      REAL*8 max50d
      REAL*8 max51
      REAL*8 max51d
      REAL*8 max52
      REAL*8 max52d
      REAL*8 max53
      REAL*8 max53d
      REAL*8 max54
      REAL*8 max54d
      REAL*8 max55
      REAL*8 max55d
      REAL*8 max56
      REAL*8 max56d
      REAL*8 max57
      REAL*8 max57d
      REAL*8 max58
      REAL*8 max58d
      REAL*8 max59
      REAL*8 max59d
      REAL*8 max60
      REAL*8 max60d
      REAL*8 max61
      REAL*8 max61d
      REAL*8 max62
      REAL*8 max62d
      REAL*8 max63
      REAL*8 max63d
      REAL*8 abs24
      REAL*8 abs24d
      REAL*8 max64
      REAL*8 abs25
      REAL*8 abs25d
      REAL*8 abs26
      REAL*8 abs27
      REAL*8 abs27d
      REAL*8 abs28
      REAL*8 abs29
      REAL*8 abs29d
      REAL*8 abs30
      REAL*8 abs31
      REAL*8 abs31d
      REAL*8 max65
      REAL*8 max65d
      REAL*8 max66
      REAL*8 max66d
      REAL*8 max67
      REAL*8 max67d
      REAL*8 max68
      REAL*8 max68d
      REAL*8 max69
      REAL*8 max69d
      REAL*8 max70
      REAL*8 max70d
      REAL*8 max71
      REAL*8 max71d
      REAL*8 max72
      REAL*8 max72d
      REAL*8 max73
      REAL*8 max73d
      REAL*8 max74
      REAL*8 max74d
      REAL*8 max75
      REAL*8 max75d
      REAL*8 max76
      REAL*8 max76d
      REAL*8 max77
      REAL*8 max77d
      REAL*8 max78
      REAL*8 max78d
      REAL*8 max79
      REAL*8 max79d
      REAL*8 abs32
      REAL*8 abs32d
      REAL*8 max80
      REAL*8 abs33
      REAL*8 abs33d
      REAL*8 abs34
      REAL*8 abs35
      REAL*8 abs35d
      REAL*8 abs36
      REAL*8 abs37
      REAL*8 abs37d
      REAL*8 abs38
      REAL*8 abs39
      REAL*8 abs39d
      REAL*8 max81
      REAL*8 max81d
      REAL*8 max82
      REAL*8 max82d
      REAL*8 max83
      REAL*8 max83d
      REAL*8 max84
      REAL*8 max84d
      REAL*8 max85
      REAL*8 max85d
      REAL*8 max86
      REAL*8 max86d
      REAL*8 max87
      REAL*8 max87d
      REAL*8 max88
      REAL*8 max88d
      REAL*8 max89
      REAL*8 max89d
      REAL*8 max90
      REAL*8 max90d
      REAL*8 max91
      REAL*8 max91d
      REAL*8 max92
      REAL*8 max92d
      REAL*8 max93
      REAL*8 max93d
      REAL*8 max94
      REAL*8 max94d
      REAL*8 max95
      REAL*8 max95d
      REAL*8 abs40
      REAL*8 abs40d
      REAL*8 max96
      REAL*8 abs41
      REAL*8 abs41d
      REAL*8 abs42
      REAL*8 abs43
      REAL*8 abs43d
      REAL*8 abs44
      REAL*8 abs45
      REAL*8 abs45d
      REAL*8 abs46
      REAL*8 abs47
      REAL*8 abs47d
      REAL*8 arg1
      REAL*8 y1d
      REAL*8 x1d
      REAL*8 y91d
      REAL*8 y2d
      REAL*8 x2d
      REAL*8 y92d
      REAL*8 y3d
      REAL*8 y4d
      REAL*8 x3d
      REAL*8 y93d
      REAL*8 y5d
      REAL*8 x4d
      REAL*8 y94d
      REAL*8 y6d
      REAL*8 y7d
      REAL*8 x5d
      REAL*8 y95d
      REAL*8 y8d
      REAL*8 x6d
      REAL*8 y96d
      REAL*8 y9d
      REAL*8 y10d
      REAL*8 x7d
      REAL*8 y97d
      REAL*8 y11d
      REAL*8 x8d
      REAL*8 y98d
      REAL*8 y12d
      REAL*8 y13d
      REAL*8 x9d
      REAL*8 y99d
      REAL*8 y14d
      REAL*8 x10d
      REAL*8 y100d
      REAL*8 y15d
      REAL*8 y16d
      REAL*8 x11d
      REAL*8 y101d
      REAL*8 y17d
      REAL*8 x12d
      REAL*8 y102d
      REAL*8 y18d
      REAL*8 y19d
      REAL*8 x13d
      REAL*8 y103d
      REAL*8 y20d
      REAL*8 x14d
      REAL*8 y104d
      REAL*8 y21d
      REAL*8 y22d
      REAL*8 x15d
      REAL*8 y105d
      REAL*8 y23d
      REAL*8 x16d
      REAL*8 y106d
      REAL*8 y24d
      REAL*8 y25d
      REAL*8 x17d
      REAL*8 y107d
      REAL*8 y26d
      REAL*8 x18d
      REAL*8 y108d
      REAL*8 y27d
      REAL*8 y28d
      REAL*8 x19d
      REAL*8 y109d
      REAL*8 y29d
      REAL*8 x20d
      REAL*8 y110d
      REAL*8 y30d
      REAL*8 y31d
      REAL*8 x21d
      REAL*8 y111d
      REAL*8 y32d
      REAL*8 x22d
      REAL*8 y112d
      REAL*8 y33d
      REAL*8 y34d
      REAL*8 x23d
      REAL*8 y113d
      REAL*8 y35d
      REAL*8 x24d
      REAL*8 y114d
      REAL*8 y36d
      REAL*8 y37d
      REAL*8 x25d
      REAL*8 y115d
      REAL*8 y38d
      REAL*8 x26d
      REAL*8 y116d
      REAL*8 y39d
      REAL*8 y40d
      REAL*8 x27d
      REAL*8 y117d
      REAL*8 y41d
      REAL*8 x28d
      REAL*8 y118d
      REAL*8 y42d
      REAL*8 y43d
      REAL*8 x29d
      REAL*8 y119d
      REAL*8 y44d
      REAL*8 x30d
      REAL*8 y120d
      REAL*8 y45d
      REAL*8 y46d
      REAL*8 x31d
      REAL*8 y121d
      REAL*8 y47d
      REAL*8 x32d
      REAL*8 y122d
      REAL*8 y48d
      REAL*8 y49d
      REAL*8 x33d
      REAL*8 y123d
      REAL*8 y50d
      REAL*8 x34d
      REAL*8 y124d
      REAL*8 y51d
      REAL*8 y52d
      REAL*8 x35d
      REAL*8 y125d
      REAL*8 y53d
      REAL*8 x36d
      REAL*8 y126d
      REAL*8 y54d
      REAL*8 y55d
      REAL*8 x37d
      REAL*8 y127d
      REAL*8 y56d
      REAL*8 x38d
      REAL*8 y128d
      REAL*8 y57d
      REAL*8 y58d
      REAL*8 x39d
      REAL*8 y129d
      REAL*8 y59d
      REAL*8 x40d
      REAL*8 y130d
      REAL*8 y60d
      REAL*8 y61d
      REAL*8 x41d
      REAL*8 y131d
      REAL*8 y62d
      REAL*8 x42d
      REAL*8 y132d
      REAL*8 y63d
      REAL*8 y64d
      REAL*8 x43d
      REAL*8 y133d
      REAL*8 y65d
      REAL*8 x44d
      REAL*8 y134d
      REAL*8 y66d
      REAL*8 y67d
      REAL*8 x45d
      REAL*8 y135d
      REAL*8 y68d
      REAL*8 x46d
      REAL*8 y136d
      REAL*8 y69d
      REAL*8 y70d
      REAL*8 x47d
      REAL*8 y137d
      REAL*8 y71d
      REAL*8 x48d
      REAL*8 y138d
      REAL*8 y72d
      REAL*8 y73d
      REAL*8 x49d
      REAL*8 y139d
      REAL*8 y74d
      REAL*8 x50d
      REAL*8 y140d
      REAL*8 y75d
      REAL*8 y76d
      REAL*8 x51d
      REAL*8 y141d
      REAL*8 y77d
      REAL*8 x52d
      REAL*8 y142d
      REAL*8 y78d
      REAL*8 y79d
      REAL*8 x53d
      REAL*8 y143d
      REAL*8 y80d
      REAL*8 x54d
      REAL*8 y144d
      REAL*8 y81d
      REAL*8 y82d
      REAL*8 x55d
      REAL*8 y145d
      REAL*8 y83d
      REAL*8 x56d
      REAL*8 y146d
      REAL*8 y84d
      REAL*8 y85d
      REAL*8 x57d
      REAL*8 y147d
      REAL*8 y86d
      REAL*8 x58d
      REAL*8 y148d
      REAL*8 y87d
      REAL*8 y88d
      REAL*8 x59d
      REAL*8 y149d
      REAL*8 y89d
      REAL*8 x60d
      REAL*8 y150d
      REAL*8 y90d
      INTEGER ii1
      REAL*8 y93
      REAL*8 y121
      REAL*8 y92
      REAL*8 y120
      REAL*8 y91
      REAL*8 y90
      REAL*8 x19
      REAL*8 x18
      REAL*8 x17
      REAL*8 x16
      REAL*8 x15
      REAL*8 x14
      REAL*8 y150
      REAL*8 x13
      REAL*8 x12
      REAL*8 x49
      REAL*8 y29
      REAL*8 x11
      REAL*8 x48
      REAL*8 y28
      REAL*8 x10
      REAL*8 x47
      REAL*8 y27
      REAL*8 x46
      REAL*8 y26
      REAL*8 x45
      REAL*8 y25
      REAL*8 x44
      REAL*8 y24
      REAL*8 x43
      REAL*8 y23
      REAL*8 x42
      REAL*8 y22
      REAL*8 y59
      REAL*8 x41
      REAL*8 y21
      REAL*8 y58
      REAL*8 x40
      REAL*8 y20
      REAL*8 y57
      REAL*8 y56
      REAL*8 y55
      REAL*8 x9
      REAL*8 y54
      REAL*8 x8
      REAL*8 y119
      REAL*8 y53
      REAL*8 x7
      REAL*8 y118
      REAL*8 y52
      REAL*8 y89
      REAL*8 x6
      REAL*8 y117
      REAL*8 y51
      REAL*8 y88
      REAL*8 x5
      REAL*8 y116
      REAL*8 y50
      REAL*8 y87
      REAL*8 x4
      REAL*8 y115
      REAL*8 y86
      REAL*8 x3
      REAL*8 y114
      REAL*8 y85
      REAL*8 x2
      REAL*8 y113
      REAL*8 y84
      REAL*8 x1
      REAL*8 y112
      REAL*8 y149
      REAL*8 y83
      REAL*8 y111
      REAL*8 y148
      REAL*8 y82
      REAL*8 y110
      REAL*8 y147
      REAL*8 y81
      REAL*8 y146
      REAL*8 y80
      REAL*8 y145
      REAL*8 y144
      REAL*8 y143
      REAL*8 y142
      REAL*8 y141
      REAL*8 y140
      REAL*8 x39
      REAL*8 y19
      REAL*8 x38
      REAL*8 y18
      REAL*8 x37
      REAL*8 y17
      REAL*8 x36
      REAL*8 y16
      REAL*8 x35
      REAL*8 y15
      REAL*8 x34
      REAL*8 y14
      REAL*8 x33
      REAL*8 y13
      REAL*8 x32
      REAL*8 y12
      REAL*8 y49
      REAL*8 x31
      REAL*8 y11
      REAL*8 y48
      REAL*8 x30
      REAL*8 y10
      REAL*8 y47
      REAL*8 y46
      REAL*8 y45
      REAL*8 y44
      REAL*8 y109
      REAL*8 y43
      REAL*8 y108
      REAL*8 y42
      REAL*8 y79
      REAL*8 y107
      REAL*8 y41
      REAL*8 y78
      REAL*8 y106
      REAL*8 x60
      REAL*8 y40
      REAL*8 y77
      REAL*8 y105
      REAL*8 y76
      REAL*8 y104
      REAL*8 y75
      REAL*8 y103
      REAL*8 y74
      REAL*8 y102
      REAL*8 y139
      REAL*8 y73
      REAL*8 y101
      REAL*8 y138
      REAL*8 y72
      REAL*8 y100
      REAL*8 y137
      REAL*8 y71
      REAL*8 y136
      REAL*8 y70
      REAL*8 y135
      REAL*8 y134
      REAL*8 y133
      REAL*8 y132
      REAL*8 y131
      REAL*8 y130
      REAL*8 x29
      REAL*8 x28
      REAL*8 x27
      REAL*8 x26
      REAL*8 x25
      REAL*8 x24
      REAL*8 x23
      REAL*8 x22
      REAL*8 x59
      REAL*8 y39
      REAL*8 x21
      REAL*8 x58
      REAL*8 y38
      REAL*8 x20
      REAL*8 x57
      REAL*8 y37
      REAL*8 x56
      REAL*8 y36
      REAL*8 x55
      REAL*8 y35
      REAL*8 x54
      REAL*8 y34
      REAL*8 x53
      REAL*8 y33
      REAL*8 x52
      REAL*8 y32
      REAL*8 y69
      REAL*8 x51
      REAL*8 y31
      REAL*8 y68
      REAL*8 x50
      REAL*8 y30
      REAL*8 y67
      REAL*8 y66
      REAL*8 y9
      REAL*8 y65
      REAL*8 y8
      REAL*8 y64
      REAL*8 y129
      REAL*8 y7
      REAL*8 y63
      REAL*8 y128
      REAL*8 y6
      REAL*8 y62
      REAL*8 y99
      REAL*8 y127
      REAL*8 y5
      REAL*8 y61
      REAL*8 y98
      REAL*8 y126
      REAL*8 y4
      REAL*8 y60
      REAL*8 y97
      REAL*8 y125
      REAL*8 y3
      REAL*8 y96
      REAL*8 y124
      REAL*8 y2
      REAL*8 y95
      REAL*8 y123
      REAL*8 y1
      REAL*8 y94
      REAL*8 y122
C
CC!DIR$ ASSUME_ALIGNED xmut: 32
C
      IF (ind_loop(1) .GT. ind_loop(2)) THEN
        RETURN
      ELSE IF (ind_loop(3) .GT. ind_loop(4)) THEN
        RETURN
      ELSE IF (ind_loop(5) .GT. ind_loop(6)) THEN
        RETURN
      ELSE
C
        inci = 1
        incj = param_int(0)
        inck = param_int(0)*param_int(0+1)
C
        inci_mtr = param_int(5)
        incj_mtr = param_int(5+1)
Cmetric
        inck_mtr = param_int(5+2)
C
        lt = 1 + (1+param_int(5+3)-1)*param_int(5) + (1+param_int(5+3)-1
     +    )*param_int(5+1) + (1+param_int(5+4)-1)*param_int(5+2)
        lvo = lt
        tcx = ti(lt)
        tcy = tj(lt)
        tcz = tk(lt)
        IF (tcx .GE. 0.) THEN
          si = tcx
        ELSE
          si = -tcx
        END IF
        IF (tcy .GE. 0.) THEN
          sj = tcy
        ELSE
          sj = -tcy
        END IF
        IF (tcz .GE. 0.) THEN
          sk = tcz
        ELSE
          sk = -tcz
        END IF
C-----Variables physiques
        volinv = 0.5/vol(lvo)
C
        gam = param_real(1)
CCv(gama-1)= R (gas parfait)
        rgp = param_real(2)*(gam-1.)
        gam1 = gam/(gam-1.)
        gam2 = 1./gam
        gam3 = gam1/param_real(10)*rgp
        gam4 = gam1/param_real(38)*rgp
C
        cmus1 = param_real(13)
        temp01 = 1./param_real(12)
        coesut = param_real(11)*(1.+cmus1*temp01)
        sigma_1 = 1./(2./3.)
C
        roref = param_real(3)
        uref = param_real(5)
C
        psiroe = param_real(34)
C!si T< 0.01Tinf, alors limiteur null
        tmin_1 = 100./param_real(6)
C
C modif suite chant metrique et suppression tc dans flux final
        c1 = 0.02*uref
C modif suite chant metrique et suppression tc dans flux final
        c2 = 0.02/(uref*roref)
C    roff MUSCL
        c3 = -2.
C
        c6 = 1./6.
        c4 = 5.*c6
        c5 = 2.*c6
        c6 = -(1.*c6)
C
C      c7     = c4/c5
C
        cvisq = 1./3
C
Ccorrection indice boucle i pour traiter l'interface ind_loop(2)+1 si necessaire
        icorr = 0
        jcorr = 0
        IF (ibloc .EQ. ijkv_bloc(1) .AND. synchro_receive_sock(1) .EQ. 0
     +      .AND. icache .EQ. ijkv_cache(1) .AND. synchro_receive_th(1) 
     +      .EQ. 0) icorr = 1
        IF (jbloc .EQ. ijkv_bloc(2) .AND. synchro_receive_sock(2) .EQ. 0
     +      .AND. jcache .EQ. ijkv_cache(2) .AND. synchro_receive_th(2) 
     +      .EQ. 0) jcorr = 1
C
        v1 = 0
        v2 = param_int(41)
        v3 = 2*param_int(41)
        v4 = 3*param_int(41)
        v5 = 4*param_int(41)
        v6 = 5*param_int(41)
C
        v1mtr = 0
        v2mtr = param_int(43)
        v3mtr = 2*param_int(43)
C
        wig_i = v1
        wig_j = v2
        wig_k = v3
C
C
C
CC!DIR$ ASSUME (mod(inck,   4) .eq. 0)
CC!DIR$ ASSUME (mod(incj,   4) .eq. 0)
CC!DIR$ ASSUME (mod(param_int(41), 4) .eq. 0)
C
        DO k=ind_loop(5),ind_loop(6)
          DO j=ind_loop(3),ind_loop(4)
C
            lij = 1 + (ind_loop(1)+param_int(0+3)-1) + (j+param_int(0+3)
     +        -1)*param_int(0) + (k+param_int(0+4)-1)*param_int(0)*
     +        param_int(0+1) - 1
            ltij = lij - (1+(ind_loop(1)+param_int(5+3)-1)*param_int(5)+
     +        (j+param_int(5+3)-1)*param_int(5+1)+(k+param_int(5+4)-1)*
     +        param_int(5+2)) + 1
CC    !DIR$ ASSUME (mod(lij,4) .eq. 0)
CDIR$ IVDEP
CDIR$ DISTRIBUTE POINT
            DO l=lij+1,lij+1+ind_loop(2)-ind_loop(1)
C
              lt = l - ltij
              lvo = lt
              l0 = l - inck
C.....Metrique
              tcx = tk(lt+v1mtr)
              tcy = tk(lt+v2mtr)
              tcz = tk(lt+v3mtr)
              arg1 = tcx*tcx + tcy*tcy + tcz*tcz
              sk = SQRT(arg1)
C
              nm = l - inck
              nm2 = l - 2*inck
              np = l + inck
C
C pente (qm) a l'interface droite et  (qp) a l'interface gauche
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v1
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y1 = 1.
                y1d = 0.0
              ELSE
                y1d = tmin_1*ropd(l+v5)
                y1 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y1) THEN
                max1d = y1d
                max1 = y1
              ELSE
                max1 = 0.
                max1d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max1d
              roff = .5*max1
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x1d = delmd
                x1 = delm
              ELSE
                x1d = -delmd
                x1 = -delm
              END IF
              y91d = SIGN(1., delm)*delpd
              y91 = SIGN(1., delm)*delp
              IF (x1 .GT. y91) THEN
                y2d = y91d
                y2 = y91
              ELSE
                y2d = x1d
                y2 = x1
              END IF
              IF (0. .LT. y2) THEN
                max2d = y2d
                max2 = y2
              ELSE
                max2 = 0.
                max2d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max2+roff*max2d)
              slp = roff*(SIGN(1., delm)*max2)
              IF (delq .GE. 0.) THEN
                x2d = delqd
                x2 = delq
              ELSE
                x2d = -delqd
                x2 = -delq
              END IF
              y92d = SIGN(1., delq)*delmd
              y92 = SIGN(1., delq)*delm
              IF (x2 .GT. y92) THEN
                y3d = y92d
                y3 = y92
              ELSE
                y3d = x2d
                y3 = x2
              END IF
              IF (0. .LT. y3) THEN
                max3d = y3d
                max3 = y3
              ELSE
                max3 = 0.
                max3d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max3+roff*max3d)
              slq = roff*(SIGN(1., delq)*max3)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm1d = qmd
              qm1 = qm
              qp1d = qpd
              qp1 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v2
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y4 = 1.
                y4d = 0.0
              ELSE
                y4d = tmin_1*ropd(l+v5)
                y4 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y4) THEN
                max4d = y4d
                max4 = y4
              ELSE
                max4 = 0.
                max4d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max4d
              roff = .5*max4
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x3d = delmd
                x3 = delm
              ELSE
                x3d = -delmd
                x3 = -delm
              END IF
              y93d = SIGN(1., delm)*delpd
              y93 = SIGN(1., delm)*delp
              IF (x3 .GT. y93) THEN
                y5d = y93d
                y5 = y93
              ELSE
                y5d = x3d
                y5 = x3
              END IF
              IF (0. .LT. y5) THEN
                max5d = y5d
                max5 = y5
              ELSE
                max5 = 0.
                max5d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max5+roff*max5d)
              slp = roff*(SIGN(1., delm)*max5)
              IF (delq .GE. 0.) THEN
                x4d = delqd
                x4 = delq
              ELSE
                x4d = -delqd
                x4 = -delq
              END IF
              y94d = SIGN(1., delq)*delmd
              y94 = SIGN(1., delq)*delm
              IF (x4 .GT. y94) THEN
                y6d = y94d
                y6 = y94
              ELSE
                y6d = x4d
                y6 = x4
              END IF
              IF (0. .LT. y6) THEN
                max6d = y6d
                max6 = y6
              ELSE
                max6 = 0.
                max6d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max6+roff*max6d)
              slq = roff*(SIGN(1., delq)*max6)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm2d = qmd
              qm2 = qm
              qp2d = qpd
              qp2 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v3
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y7 = 1.
                y7d = 0.0
              ELSE
                y7d = tmin_1*ropd(l+v5)
                y7 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y7) THEN
                max7d = y7d
                max7 = y7
              ELSE
                max7 = 0.
                max7d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max7d
              roff = .5*max7
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x5d = delmd
                x5 = delm
              ELSE
                x5d = -delmd
                x5 = -delm
              END IF
              y95d = SIGN(1., delm)*delpd
              y95 = SIGN(1., delm)*delp
              IF (x5 .GT. y95) THEN
                y8d = y95d
                y8 = y95
              ELSE
                y8d = x5d
                y8 = x5
              END IF
              IF (0. .LT. y8) THEN
                max8d = y8d
                max8 = y8
              ELSE
                max8 = 0.
                max8d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max8+roff*max8d)
              slp = roff*(SIGN(1., delm)*max8)
              IF (delq .GE. 0.) THEN
                x6d = delqd
                x6 = delq
              ELSE
                x6d = -delqd
                x6 = -delq
              END IF
              y96d = SIGN(1., delq)*delmd
              y96 = SIGN(1., delq)*delm
              IF (x6 .GT. y96) THEN
                y9d = y96d
                y9 = y96
              ELSE
                y9d = x6d
                y9 = x6
              END IF
              IF (0. .LT. y9) THEN
                max9d = y9d
                max9 = y9
              ELSE
                max9 = 0.
                max9d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max9+roff*max9d)
              slq = roff*(SIGN(1., delq)*max9)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm3d = qmd
              qm3 = qm
              qp3d = qpd
              qp3 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v4
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y10 = 1.
                y10d = 0.0
              ELSE
                y10d = tmin_1*ropd(l+v5)
                y10 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y10) THEN
                max10d = y10d
                max10 = y10
              ELSE
                max10 = 0.
                max10d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max10d
              roff = .5*max10
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x7d = delmd
                x7 = delm
              ELSE
                x7d = -delmd
                x7 = -delm
              END IF
              y97d = SIGN(1., delm)*delpd
              y97 = SIGN(1., delm)*delp
              IF (x7 .GT. y97) THEN
                y11d = y97d
                y11 = y97
              ELSE
                y11d = x7d
                y11 = x7
              END IF
              IF (0. .LT. y11) THEN
                max11d = y11d
                max11 = y11
              ELSE
                max11 = 0.
                max11d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max11+roff*max11d)
              slp = roff*(SIGN(1., delm)*max11)
              IF (delq .GE. 0.) THEN
                x8d = delqd
                x8 = delq
              ELSE
                x8d = -delqd
                x8 = -delq
              END IF
              y98d = SIGN(1., delq)*delmd
              y98 = SIGN(1., delq)*delm
              IF (x8 .GT. y98) THEN
                y12d = y98d
                y12 = y98
              ELSE
                y12d = x8d
                y12 = x8
              END IF
              IF (0. .LT. y12) THEN
                max12d = y12d
                max12 = y12
              ELSE
                max12 = 0.
                max12d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max12+roff*max12d)
              slq = roff*(SIGN(1., delq)*max12)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm4d = qmd
              qm4 = qm
              qp4d = qpd
              qp4 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v5
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y13 = 1.
                y13d = 0.0
              ELSE
                y13d = tmin_1*ropd(l+v5)
                y13 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y13) THEN
                max13d = y13d
                max13 = y13
              ELSE
                max13 = 0.
                max13d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max13d
              roff = .5*max13
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x9d = delmd
                x9 = delm
              ELSE
                x9d = -delmd
                x9 = -delm
              END IF
              y99d = SIGN(1., delm)*delpd
              y99 = SIGN(1., delm)*delp
              IF (x9 .GT. y99) THEN
                y14d = y99d
                y14 = y99
              ELSE
                y14d = x9d
                y14 = x9
              END IF
              IF (0. .LT. y14) THEN
                max14d = y14d
                max14 = y14
              ELSE
                max14 = 0.
                max14d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max14+roff*max14d)
              slp = roff*(SIGN(1., delm)*max14)
              IF (delq .GE. 0.) THEN
                x10d = delqd
                x10 = delq
              ELSE
                x10d = -delqd
                x10 = -delq
              END IF
              y100d = SIGN(1., delq)*delmd
              y100 = SIGN(1., delq)*delm
              IF (x10 .GT. y100) THEN
                y15d = y100d
                y15 = y100
              ELSE
                y15d = x10d
                y15 = x10
              END IF
              IF (0. .LT. y15) THEN
                max15d = y15d
                max15 = y15
              ELSE
                max15 = 0.
                max15d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max15+roff*max15d)
              slq = roff*(SIGN(1., delq)*max15)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm5d = qmd
              qm5 = qm
              qp5d = qpd
              qp5 = qp
C
Cdetermination etat gauche (rou1) et droit (rou2): ro, roui, roe+p
              r1d = qp1d
              r1 = qp1
              p1d = rgp*(r1d*qp5+r1*qp5d)
              p1 = r1*qp5*rgp
Cdetermination etat droite: ro, roui, roe+p
              h1d = gam1*rgp*qp5d + .5*(qp2d*qp2+qp2*qp2d+qp3d*qp3+qp3*
     +          qp3d+qp4d*qp4+qp4*qp4d)
              h1 = gam1*qp5*rgp + .5*(qp2*qp2+qp3*qp3+qp4*qp4)
C
              r2d = qm1d
              r2 = qm1
              p2d = rgp*(r2d*qm5+r2*qm5d)
              p2 = r2*qm5*rgp
              h2d = gam1*rgp*qm5d + .5*(qm2d*qm2+qm2*qm2d+qm3d*qm3+qm3*
     +          qm3d+qm4d*qm4+qm4*qm4d)
              h2 = gam1*qm5*rgp + .5*(qm2*qm2+qm3*qm3+qm4*qm4)
C
Cdetermination etat moyenne roe
              IF (r1 .EQ. 0.0) THEN
                qp1d = 0.D0
              ELSE
                qp1d = r1d/(2.0*SQRT(r1))
              END IF
              qp1 = SQRT(r1)
              IF (r2 .EQ. 0.0) THEN
                qm1d = 0.D0
              ELSE
                qm1d = r2d/(2.0*SQRT(r2))
              END IF
              qm1 = SQRT(r2)
              rd = qp1d*qm1 + qp1*qm1d
              r = qp1*qm1
              r_1d = -((qp1d+qm1d)/(qp1+qm1)**2)
              r_1 = 1./(qp1+qm1)
              ud = (qp1d*qp2+qp1*qp2d+qm1d*qm2+qm1*qm2d)*r_1 + (qp1*qp2+
     +          qm1*qm2)*r_1d
              u = (qp1*qp2+qm1*qm2)*r_1
              vd = (qp1d*qp3+qp1*qp3d+qm1d*qm3+qm1*qm3d)*r_1 + (qp1*qp3+
     +          qm1*qm3)*r_1d
              v = (qp1*qp3+qm1*qm3)*r_1
              wd = (qp1d*qp4+qp1*qp4d+qm1d*qm4+qm1*qm4d)*r_1 + (qp1*qp4+
     +          qm1*qm4)*r_1d
              w = (qp1*qp4+qm1*qm4)*r_1
              hd = (qp1d*h1+qp1*h1d+qm1d*h2+qm1*h2d)*r_1 + (qp1*h1+qm1*
     +          h2)*r_1d
              h = (qp1*h1+qm1*h2)*r_1
              qd = .5*(ud*u+u*ud+vd*v+v*vd+wd*w+w*wd)
              q = .5*(u*u+v*v+w*w)
              IF (h - q .GE. 0.) THEN
                abs0d = hd - qd
                abs0 = h - q
              ELSE
                abs0d = -(hd-qd)
                abs0 = -(h-q)
              END IF
              IF ((gam-1.)*abs0 .EQ. 0.0) THEN
                cd = 0.D0
              ELSE
                cd = (gam-1.)*abs0d/(2.0*SQRT((gam-1.)*abs0))
              END IF
              c = SQRT((gam-1.)*abs0)
C
Cdetermination vitesse normale interface
              qn1d = tcx*qp2d + tcy*qp3d + tcz*qp4d
              qn1 = qp2*tcx + qp3*tcy + qp4*tcz
              qn2d = tcx*qm2d + tcy*qm3d + tcz*qm4d
              qn2 = qm2*tcx + qm3*tcy + qm4*tcz
C
              dud = sk*(qm2d-qp2d)
              du = (qm2-qp2)*sk
              dvd = sk*(qm3d-qp3d)
              dv = (qm3-qp3)*sk
              dwd = sk*(qm4d-qp4d)
              dw = (qm4-qp4)*sk
              dpd = p2d - p1d
              dp = p2 - p1
CSdqn
              dqnd = qn2d - qn1d
              dqn = qn2 - qn1
              IF (sk .LT. 1.e-30) THEN
                max16 = 1.e-30
              ELSE
                max16 = sk
              END IF
C
C.....Evaluation des valeurs propres
              s_1 = 1./max16
              nx = tcx*s_1
              ny = tcy*s_1
              nz = tcz*s_1
C
              qnd = nx*ud + ny*vd + nz*wd
              qn = u*nx + v*ny + w*nz
C
              f1d = qnd
              f1 = qn
              IF (f1 .GE. 0.) THEN
                abs1d = f1d
                abs1 = f1
              ELSE
                abs1d = -f1d
                abs1 = -f1
              END IF
Cdelta
              f4d = psiroe*(abs1d+cd)
              f4 = psiroe*(abs1+c)
              IF (f1 .GE. 0.) THEN
                abs2 = f1
              ELSE
                abs2 = -f1
              END IF
C
              f2 = .5 + SIGN(.5, abs2 - f4)
              IF (f1 .GE. 0.) THEN
                abs3d = f1d
                abs3 = f1
              ELSE
                abs3d = -f1d
                abs3 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs3d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs3
C  a123
              f1d = sk*(r2d-r1d-(dpd*c**2-dp*(cd*c+c*cd))/(c*c)**2)
              f1 = (r2-r1-dp/(c*c))*sk
              flu1d = f3d*f1 + f3*f1d
              flu1 = f3*f1
              flu2d = f3d*(f1*u+r*(du-nx*dqn)) + f3*(f1d*u+f1*ud+rd*(du-
     +          nx*dqn)+r*(dud-nx*dqnd))
              flu2 = f3*(f1*u+r*(du-nx*dqn))
              flu3d = f3d*(f1*v+r*(dv-ny*dqn)) + f3*(f1d*v+f1*vd+rd*(dv-
     +          ny*dqn)+r*(dvd-ny*dqnd))
              flu3 = f3*(f1*v+r*(dv-ny*dqn))
              flu4d = f3d*(f1*w+r*(dw-nz*dqn)) + f3*(f1d*w+f1*wd+rd*(dw-
     +          nz*dqn)+r*(dwd-nz*dqnd))
              flu4 = f3*(f1*w+r*(dw-nz*dqn))
              flu5d = f3d*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn)) + f3*(f1d*q+
     +          f1*qd+rd*(u*du+v*dv+w*dw-qn*dqn)+r*(ud*du+u*dud+vd*dv+v*
     +          dvd+wd*dw+w*dwd-qnd*dqn-qn*dqnd))
              flu5 = f3*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn))
C
              f1d = qnd + cd
              f1 = qn + c
              IF (f1 .GE. 0.) THEN
                abs4 = f1
              ELSE
                abs4 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs4 - f4)
              IF (f1 .GE. 0.) THEN
                abs5d = f1d
                abs5 = f1
              ELSE
                abs5d = -f1d
                abs5 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs5d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs5
Clambda4*S*a4
              f1d = sk*(((dpd+s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp+r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp+r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp+r*c*dqn*s_1)/(2.*c*c)*sk*f3
C
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u+nx*c) + f1*(ud+nx*cd)
              flu2 = flu2 + f1*(u+nx*c)
              flu3d = flu3d + f1d*(v+ny*c) + f1*(vd+ny*cd)
              flu3 = flu3 + f1*(v+ny*c)
              flu4d = flu4d + f1d*(w+nz*c) + f1*(wd+nz*cd)
              flu4 = flu4 + f1*(w+nz*c)
              flu5d = flu5d + f1d*(h+qn*c) + f1*(hd+qnd*c+qn*cd)
              flu5 = flu5 + f1*(h+qn*c)
C
              f1d = qnd - cd
              f1 = qn - c
              IF (f1 .GE. 0.) THEN
                abs6 = f1
              ELSE
                abs6 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs6 - f4)
              IF (f1 .GE. 0.) THEN
                abs7d = f1d
                abs7 = f1
              ELSE
                abs7d = -f1d
                abs7 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs7d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs7
C
Clambda5*S*a5
              f1d = sk*(((dpd-s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp-r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp-r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp-r*c*dqn*s_1)/(2.*c*c)*f3*sk
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u-nx*c) + f1*(ud-nx*cd)
              flu2 = flu2 + f1*(u-nx*c)
              flu3d = flu3d + f1d*(v-ny*c) + f1*(vd-ny*cd)
              flu3 = flu3 + f1*(v-ny*c)
              flu4d = flu4d + f1d*(w-nz*c) + f1*(wd-nz*cd)
              flu4 = flu4 + f1*(w-nz*c)
              flu5d = flu5d + f1d*(h-qn*c) + f1*(hd-qnd*c-qn*cd)
              flu5 = flu5 + f1*(h-qn*c)
C
              rou1d = r1d*qn1 + r1*qn1d
              rou1 = r1*qn1
              rou2d = r2d*qn2 + r2*qn2d
              rou2 = r2*qn2
              p1p2d = p1d + p2d
              p1p2 = p1 + p2
              flu1d = 0.5*(flu1d+rou1d+rou2d)
              flu1 = (flu1+rou1+rou2)*0.5
              flu2d = 0.5*(flu2d+rou1d*qp2+rou1*qp2d+rou2d*qm2+rou2*qm2d
     +          +tcx*p1p2d)
              flu2 = (flu2+rou1*qp2+rou2*qm2+tcx*p1p2)*0.5
              flu3d = 0.5*(flu3d+rou1d*qp3+rou1*qp3d+rou2d*qm3+rou2*qm3d
     +          +tcy*p1p2d)
              flu3 = (flu3+rou1*qp3+rou2*qm3+tcy*p1p2)*0.5
              flu4d = 0.5*(flu4d+rou1d*qp4+rou1*qp4d+rou2d*qm4+rou2*qm4d
     +          +tcz*p1p2d)
              flu4 = (flu4+rou1*qp4+rou2*qm4+tcz*p1p2)*0.5
C1=?+1; 
C3=?+2 
C2=?-1
C4=?-2
Cl341  = (i+2,j-2,k+1)
              flu5d = 0.5*(flu5d+rou1d*h1+rou1*h1d+rou2d*h2+rou2*h2d)
              flu5 = (flu5+rou1*h1+rou2*h2)*0.5
              lt002 = lt - inck_mtr
              lt001 = lt + inck_mtr
              lt102 = lt + inci_mtr - inck_mtr
              lt100 = lt + inci_mtr
              lt010 = lt + incj_mtr
              lt012 = lt + incj_mtr - inck_mtr
C
              lvor = lt
              lvol = lt002
C
              il = l - inck
              ir = l
              l001 = l + inck
              l200 = l - inci
              l100 = l + inci
              l010 = l + incj
              l020 = l - incj
              l202 = l - inci - inck
              l022 = l - incj - inck
              l102 = l + inci - inck
              l012 = l + incj - inck
CCCCCC
CCCCCC
CCCCCC   Facette K
CCCCCC
CCCCCC
              tix = .5*(tk(lt+v1mtr)+tk(lt002+v1mtr))
              tiy = .5*(tk(lt+v2mtr)+tk(lt002+v2mtr))
              tiz = .5*(tk(lt+v3mtr)+tk(lt002+v3mtr))
              tix1 = .5*(tk(lt+v1mtr)+tk(lt001+v1mtr))
              tiy1 = .5*(tk(lt+v2mtr)+tk(lt001+v2mtr))
              tiz1 = .5*(tk(lt+v3mtr)+tk(lt001+v3mtr))
C
              tjx = .125*(ti(lt+v1mtr)+ti(lt002+v1mtr))
              tjy = .125*(ti(lt+v2mtr)+ti(lt002+v2mtr))
              tjz = .125*(ti(lt+v3mtr)+ti(lt002+v3mtr))
              tjx1 = .125*(ti(lt100+v1mtr)+ti(lt102+v1mtr))
              tjy1 = .125*(ti(lt100+v2mtr)+ti(lt102+v2mtr))
              tjz1 = .125*(ti(lt100+v3mtr)+ti(lt102+v3mtr))
C
              tkx = .125*(tj(lt+v1mtr)+tj(lt002+v1mtr))
              tky = .125*(tj(lt+v2mtr)+tj(lt002+v2mtr))
              tkz = .125*(tj(lt+v3mtr)+tj(lt002+v3mtr))
              tkx1 = .125*(tj(lt010+v1mtr)+tj(lt012+v1mtr))
              tky1 = .125*(tj(lt010+v2mtr)+tj(lt012+v2mtr))
C --- Gradients en U_k
              tkz1 = .125*(tj(lt010+v3mtr)+tj(lt012+v3mtr))
C
              f1d = ropd(il+v2)
              f1 = rop(il+v2)
              f2d = ropd(ir+v2)
              f2 = rop(ir+v2)
              f3d = ropd(ir+v2) + ropd(il+v2) + ropd(l202+v2) + ropd(
     +          l200+v2)
              f3 = rop(ir+v2) + rop(il+v2) + rop(l202+v2) + rop(l200+v2)
              f4d = ropd(ir+v2) + ropd(il+v2) + ropd(l102+v2) + ropd(
     +          l100+v2)
              f4 = rop(ir+v2) + rop(il+v2) + rop(l102+v2) + rop(l100+v2)
              f5d = ropd(ir+v2) + ropd(il+v2) + ropd(l022+v2) + ropd(
     +          l020+v2)
              f5 = rop(ir+v2) + rop(il+v2) + rop(l022+v2) + rop(l020+v2)
              f6d = ropd(ir+v2) + ropd(il+v2) + ropd(l012+v2) + ropd(
     +          l010+v2)
              f6 = rop(ir+v2) + rop(il+v2) + rop(l012+v2) + rop(l010+v2)
C
              gradu_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradu_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradu_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradu_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en V_k
              gradu_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradu_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v3)
              f1 = rop(il+v3)
              f2d = ropd(ir+v3)
              f2 = rop(ir+v3)
              f3d = ropd(ir+v3) + ropd(il+v3) + ropd(l202+v3) + ropd(
     +          l200+v3)
              f3 = rop(ir+v3) + rop(il+v3) + rop(l202+v3) + rop(l200+v3)
              f4d = ropd(ir+v3) + ropd(il+v3) + ropd(l102+v3) + ropd(
     +          l100+v3)
              f4 = rop(ir+v3) + rop(il+v3) + rop(l102+v3) + rop(l100+v3)
              f5d = ropd(ir+v3) + ropd(il+v3) + ropd(l022+v3) + ropd(
     +          l020+v3)
              f5 = rop(ir+v3) + rop(il+v3) + rop(l022+v3) + rop(l020+v3)
              f6d = ropd(ir+v3) + ropd(il+v3) + ropd(l012+v3) + ropd(
     +          l010+v3)
              f6 = rop(ir+v3) + rop(il+v3) + rop(l012+v3) + rop(l010+v3)
C
              gradv_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradv_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradv_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradv_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en W_k
              gradv_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradv_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v4)
              f1 = rop(il+v4)
              f2d = ropd(ir+v4)
              f2 = rop(ir+v4)
              f3d = ropd(ir+v4) + ropd(il+v4) + ropd(l202+v4) + ropd(
     +          l200+v4)
              f3 = rop(ir+v4) + rop(il+v4) + rop(l202+v4) + rop(l200+v4)
              f4d = ropd(ir+v4) + ropd(il+v4) + ropd(l102+v4) + ropd(
     +          l100+v4)
              f4 = rop(ir+v4) + rop(il+v4) + rop(l102+v4) + rop(l100+v4)
              f5d = ropd(ir+v4) + ropd(il+v4) + ropd(l022+v4) + ropd(
     +          l020+v4)
              f5 = rop(ir+v4) + rop(il+v4) + rop(l022+v4) + rop(l020+v4)
              f6d = ropd(ir+v4) + ropd(il+v4) + ropd(l012+v4) + ropd(
     +          l010+v4)
              f6 = rop(ir+v4) + rop(il+v4) + rop(l012+v4) + rop(l010+v4)
C
              gradw_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradw_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradw_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradw_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en T_k
              gradw_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradw_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v5)
              f1 = rop(il+v5)
              f2d = ropd(ir+v5)
              f2 = rop(ir+v5)
              f3d = ropd(ir+v5) + ropd(il+v5) + ropd(l202+v5) + ropd(
     +          l200+v5)
              f3 = rop(ir+v5) + rop(il+v5) + rop(l202+v5) + rop(l200+v5)
              f4d = ropd(ir+v5) + ropd(il+v5) + ropd(l102+v5) + ropd(
     +          l100+v5)
              f4 = rop(ir+v5) + rop(il+v5) + rop(l102+v5) + rop(l100+v5)
              f5d = ropd(ir+v5) + ropd(il+v5) + ropd(l022+v5) + ropd(
     +          l020+v5)
              f5 = rop(ir+v5) + rop(il+v5) + rop(l022+v5) + rop(l020+v5)
              f6d = ropd(ir+v5) + ropd(il+v5) + ropd(l012+v5) + ropd(
     +          l010+v5)
              f6 = rop(ir+v5) + rop(il+v5) + rop(l012+v5) + rop(l010+v5)
C
              gradt_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradt_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradt_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradt_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- assemblage flux
              gradt_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradt_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              divd = cvisq*(gradu_nxd+gradv_nyd+gradw_nzd)
              div = (gradu_nx+gradv_ny+gradw_nz)*cvisq
              f1d = gradu_nxd - divd
              f1 = gradu_nx - div
              f2d = gradu_nyd + gradv_nxd
              f2 = gradu_ny + gradv_nx
              f3d = gradu_nzd + gradw_nxd
              f3 = gradu_nz + gradw_nx
              f4d = gradv_nyd - divd
              f4 = gradv_ny - div
              f5d = gradv_nzd + gradw_nyd
              f5 = gradv_nz + gradw_ny
              f6d = gradw_nzd - divd
              f6 = gradw_nz - div
C
              volinv = 1./(vol(lvor)+vol(lvol))
              xmutvol = (xmut(ir)+xmut(il))*volinv
              xktvol = xmutvol*gam3
C
              fvd = -(xmutvol*(2.*tcx*f1d+tcy*f2d+tcz*f3d))
              fv = -((2.*f1*tcx+f2*tcy+f3*tcz)*xmutvol)
              fv5d = fvd*(rop(ir+v2)+rop(il+v2)) + fv*(ropd(ir+v2)+ropd(
     +          il+v2))
              fv5 = fv*(rop(ir+v2)+rop(il+v2))
              flu2d = flu2d + fvd
              flu2 = flu2 + fv
C
              fvd = -(xmutvol*(tcx*f2d+2.*tcy*f4d+tcz*f5d))
              fv = -((f2*tcx+2.*f4*tcy+f5*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v3)+rop(il+v3)) + fv*(ropd(ir+v3
     +          )+ropd(il+v3))
              fv5 = fv5 + fv*(rop(ir+v3)+rop(il+v3))
              flu3d = flu3d + fvd
              flu3 = flu3 + fv
C
              fvd = -(xmutvol*(tcx*f3d+tcy*f5d+2.*tcz*f6d))
              fv = -((f3*tcx+f5*tcy+2.*f6*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v4)+rop(il+v4)) + fv*(ropd(ir+v4
     +          )+ropd(il+v4))
              fv5 = fv5 + fv*(rop(ir+v4)+rop(il+v4))
              flu4d = flu4d + fvd
              flu4 = flu4 + fv
C
              fvd = 0.5*fv5d - xktvol*(tcx*gradt_nxd+tcy*gradt_nyd+tcz*
     +          gradt_nzd)
              fv = fv5*0.5 - (gradt_nx*tcx+gradt_ny*tcy+gradt_nz*tcz)*
     +          xktvol
              flu5d = flu5d + fvd
              flu5 = flu5 + fv
              drodmd(l+v1) = drodmd(l+v1) + flu1d
              drodmd(l0+v1) = drodmd(l0+v1) - flu1d
              drodmd(l+v2) = drodmd(l+v2) + flu2d
              drodmd(l0+v2) = drodmd(l0+v2) - flu2d
              drodmd(l+v3) = drodmd(l+v3) + flu3d
              drodmd(l0+v3) = drodmd(l0+v3) - flu3d
              drodmd(l+v4) = drodmd(l+v4) + flu4d
              drodmd(l0+v4) = drodmd(l0+v4) - flu4d
              drodmd(l+v5) = drodmd(l+v5) + flu5d
              drodmd(l0+v5) = drodmd(l0+v5) - flu5d
            ENDDO
C
            lij = 1 + (ind_loop(1)+param_int(0+3)-1) + (j+param_int(0+3)
     +        -1)*param_int(0) + (k+param_int(0+4)-1)*param_int(0)*
     +        param_int(0+1) - 1
            ltij = lij - (1+(ind_loop(1)+param_int(5+3)-1)*param_int(5)+
     +        (j+param_int(5+3)-1)*param_int(5+1)+(k+param_int(5+4)-1)*
     +        param_int(5+2)) + 1
CC    !DIR$ ASSUME (mod(lij,4) .eq. 0)
CDIR$ IVDEP
CDIR$ DISTRIBUTE POINT
            DO l=lij+1,lij+1+ind_loop(2)-ind_loop(1)
C
              lt = l - ltij
              lvo = lt
              l0 = l - incj
C.....Metrique
              tcx = tj(lt+v1mtr)
              tcy = tj(lt+v2mtr)
              tcz = tj(lt+v3mtr)
              arg1 = tcx*tcx + tcy*tcy + tcz*tcz
              sj = SQRT(arg1)
C
              nm = l - incj
              nm2 = l - 2*incj
              np = l + incj
C
C pente (qm) a l'interface droite et  (qp) a l'interface gauche
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v1
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y16 = 1.
                y16d = 0.0
              ELSE
                y16d = tmin_1*ropd(l+v5)
                y16 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y16) THEN
                max17d = y16d
                max17 = y16
              ELSE
                max17 = 0.
                max17d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max17d
              roff = .5*max17
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x11d = delmd
                x11 = delm
              ELSE
                x11d = -delmd
                x11 = -delm
              END IF
              y101d = SIGN(1., delm)*delpd
              y101 = SIGN(1., delm)*delp
              IF (x11 .GT. y101) THEN
                y17d = y101d
                y17 = y101
              ELSE
                y17d = x11d
                y17 = x11
              END IF
              IF (0. .LT. y17) THEN
                max18d = y17d
                max18 = y17
              ELSE
                max18 = 0.
                max18d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max18+roff*max18d)
              slp = roff*(SIGN(1., delm)*max18)
              IF (delq .GE. 0.) THEN
                x12d = delqd
                x12 = delq
              ELSE
                x12d = -delqd
                x12 = -delq
              END IF
              y102d = SIGN(1., delq)*delmd
              y102 = SIGN(1., delq)*delm
              IF (x12 .GT. y102) THEN
                y18d = y102d
                y18 = y102
              ELSE
                y18d = x12d
                y18 = x12
              END IF
              IF (0. .LT. y18) THEN
                max19d = y18d
                max19 = y18
              ELSE
                max19 = 0.
                max19d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max19+roff*max19d)
              slq = roff*(SIGN(1., delq)*max19)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm1d = qmd
              qm1 = qm
              qp1d = qpd
              qp1 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v2
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y19 = 1.
                y19d = 0.0
              ELSE
                y19d = tmin_1*ropd(l+v5)
                y19 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y19) THEN
                max20d = y19d
                max20 = y19
              ELSE
                max20 = 0.
                max20d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max20d
              roff = .5*max20
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x13d = delmd
                x13 = delm
              ELSE
                x13d = -delmd
                x13 = -delm
              END IF
              y103d = SIGN(1., delm)*delpd
              y103 = SIGN(1., delm)*delp
              IF (x13 .GT. y103) THEN
                y20d = y103d
                y20 = y103
              ELSE
                y20d = x13d
                y20 = x13
              END IF
              IF (0. .LT. y20) THEN
                max21d = y20d
                max21 = y20
              ELSE
                max21 = 0.
                max21d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max21+roff*max21d)
              slp = roff*(SIGN(1., delm)*max21)
              IF (delq .GE. 0.) THEN
                x14d = delqd
                x14 = delq
              ELSE
                x14d = -delqd
                x14 = -delq
              END IF
              y104d = SIGN(1., delq)*delmd
              y104 = SIGN(1., delq)*delm
              IF (x14 .GT. y104) THEN
                y21d = y104d
                y21 = y104
              ELSE
                y21d = x14d
                y21 = x14
              END IF
              IF (0. .LT. y21) THEN
                max22d = y21d
                max22 = y21
              ELSE
                max22 = 0.
                max22d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max22+roff*max22d)
              slq = roff*(SIGN(1., delq)*max22)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm2d = qmd
              qm2 = qm
              qp2d = qpd
              qp2 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v3
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y22 = 1.
                y22d = 0.0
              ELSE
                y22d = tmin_1*ropd(l+v5)
                y22 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y22) THEN
                max23d = y22d
                max23 = y22
              ELSE
                max23 = 0.
                max23d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max23d
              roff = .5*max23
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x15d = delmd
                x15 = delm
              ELSE
                x15d = -delmd
                x15 = -delm
              END IF
              y105d = SIGN(1., delm)*delpd
              y105 = SIGN(1., delm)*delp
              IF (x15 .GT. y105) THEN
                y23d = y105d
                y23 = y105
              ELSE
                y23d = x15d
                y23 = x15
              END IF
              IF (0. .LT. y23) THEN
                max24d = y23d
                max24 = y23
              ELSE
                max24 = 0.
                max24d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max24+roff*max24d)
              slp = roff*(SIGN(1., delm)*max24)
              IF (delq .GE. 0.) THEN
                x16d = delqd
                x16 = delq
              ELSE
                x16d = -delqd
                x16 = -delq
              END IF
              y106d = SIGN(1., delq)*delmd
              y106 = SIGN(1., delq)*delm
              IF (x16 .GT. y106) THEN
                y24d = y106d
                y24 = y106
              ELSE
                y24d = x16d
                y24 = x16
              END IF
              IF (0. .LT. y24) THEN
                max25d = y24d
                max25 = y24
              ELSE
                max25 = 0.
                max25d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max25+roff*max25d)
              slq = roff*(SIGN(1., delq)*max25)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm3d = qmd
              qm3 = qm
              qp3d = qpd
              qp3 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v4
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y25 = 1.
                y25d = 0.0
              ELSE
                y25d = tmin_1*ropd(l+v5)
                y25 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y25) THEN
                max26d = y25d
                max26 = y25
              ELSE
                max26 = 0.
                max26d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max26d
              roff = .5*max26
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x17d = delmd
                x17 = delm
              ELSE
                x17d = -delmd
                x17 = -delm
              END IF
              y107d = SIGN(1., delm)*delpd
              y107 = SIGN(1., delm)*delp
              IF (x17 .GT. y107) THEN
                y26d = y107d
                y26 = y107
              ELSE
                y26d = x17d
                y26 = x17
              END IF
              IF (0. .LT. y26) THEN
                max27d = y26d
                max27 = y26
              ELSE
                max27 = 0.
                max27d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max27+roff*max27d)
              slp = roff*(SIGN(1., delm)*max27)
              IF (delq .GE. 0.) THEN
                x18d = delqd
                x18 = delq
              ELSE
                x18d = -delqd
                x18 = -delq
              END IF
              y108d = SIGN(1., delq)*delmd
              y108 = SIGN(1., delq)*delm
              IF (x18 .GT. y108) THEN
                y27d = y108d
                y27 = y108
              ELSE
                y27d = x18d
                y27 = x18
              END IF
              IF (0. .LT. y27) THEN
                max28d = y27d
                max28 = y27
              ELSE
                max28 = 0.
                max28d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max28+roff*max28d)
              slq = roff*(SIGN(1., delq)*max28)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm4d = qmd
              qm4 = qm
              qp4d = qpd
              qp4 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v5
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y28 = 1.
                y28d = 0.0
              ELSE
                y28d = tmin_1*ropd(l+v5)
                y28 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y28) THEN
                max29d = y28d
                max29 = y28
              ELSE
                max29 = 0.
                max29d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max29d
              roff = .5*max29
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x19d = delmd
                x19 = delm
              ELSE
                x19d = -delmd
                x19 = -delm
              END IF
              y109d = SIGN(1., delm)*delpd
              y109 = SIGN(1., delm)*delp
              IF (x19 .GT. y109) THEN
                y29d = y109d
                y29 = y109
              ELSE
                y29d = x19d
                y29 = x19
              END IF
              IF (0. .LT. y29) THEN
                max30d = y29d
                max30 = y29
              ELSE
                max30 = 0.
                max30d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max30+roff*max30d)
              slp = roff*(SIGN(1., delm)*max30)
              IF (delq .GE. 0.) THEN
                x20d = delqd
                x20 = delq
              ELSE
                x20d = -delqd
                x20 = -delq
              END IF
              y110d = SIGN(1., delq)*delmd
              y110 = SIGN(1., delq)*delm
              IF (x20 .GT. y110) THEN
                y30d = y110d
                y30 = y110
              ELSE
                y30d = x20d
                y30 = x20
              END IF
              IF (0. .LT. y30) THEN
                max31d = y30d
                max31 = y30
              ELSE
                max31 = 0.
                max31d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max31+roff*max31d)
              slq = roff*(SIGN(1., delq)*max31)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm5d = qmd
              qm5 = qm
              qp5d = qpd
              qp5 = qp
C
Cdetermination etat gauche (rou1) et droit (rou2): ro, roui, roe+p
              r1d = qp1d
              r1 = qp1
              p1d = rgp*(r1d*qp5+r1*qp5d)
              p1 = r1*qp5*rgp
Cdetermination etat droite: ro, roui, roe+p
              h1d = gam1*rgp*qp5d + .5*(qp2d*qp2+qp2*qp2d+qp3d*qp3+qp3*
     +          qp3d+qp4d*qp4+qp4*qp4d)
              h1 = gam1*qp5*rgp + .5*(qp2*qp2+qp3*qp3+qp4*qp4)
C
              r2d = qm1d
              r2 = qm1
              p2d = rgp*(r2d*qm5+r2*qm5d)
              p2 = r2*qm5*rgp
              h2d = gam1*rgp*qm5d + .5*(qm2d*qm2+qm2*qm2d+qm3d*qm3+qm3*
     +          qm3d+qm4d*qm4+qm4*qm4d)
              h2 = gam1*qm5*rgp + .5*(qm2*qm2+qm3*qm3+qm4*qm4)
C
Cdetermination etat moyenne roe
              IF (r1 .EQ. 0.0) THEN
                qp1d = 0.D0
              ELSE
                qp1d = r1d/(2.0*SQRT(r1))
              END IF
              qp1 = SQRT(r1)
              IF (r2 .EQ. 0.0) THEN
                qm1d = 0.D0
              ELSE
                qm1d = r2d/(2.0*SQRT(r2))
              END IF
              qm1 = SQRT(r2)
              rd = qp1d*qm1 + qp1*qm1d
              r = qp1*qm1
              r_1d = -((qp1d+qm1d)/(qp1+qm1)**2)
              r_1 = 1./(qp1+qm1)
              ud = (qp1d*qp2+qp1*qp2d+qm1d*qm2+qm1*qm2d)*r_1 + (qp1*qp2+
     +          qm1*qm2)*r_1d
              u = (qp1*qp2+qm1*qm2)*r_1
              vd = (qp1d*qp3+qp1*qp3d+qm1d*qm3+qm1*qm3d)*r_1 + (qp1*qp3+
     +          qm1*qm3)*r_1d
              v = (qp1*qp3+qm1*qm3)*r_1
              wd = (qp1d*qp4+qp1*qp4d+qm1d*qm4+qm1*qm4d)*r_1 + (qp1*qp4+
     +          qm1*qm4)*r_1d
              w = (qp1*qp4+qm1*qm4)*r_1
              hd = (qp1d*h1+qp1*h1d+qm1d*h2+qm1*h2d)*r_1 + (qp1*h1+qm1*
     +          h2)*r_1d
              h = (qp1*h1+qm1*h2)*r_1
              qd = .5*(ud*u+u*ud+vd*v+v*vd+wd*w+w*wd)
              q = .5*(u*u+v*v+w*w)
              IF (h - q .GE. 0.) THEN
                abs8d = hd - qd
                abs8 = h - q
              ELSE
                abs8d = -(hd-qd)
                abs8 = -(h-q)
              END IF
              IF ((gam-1.)*abs8 .EQ. 0.0) THEN
                cd = 0.D0
              ELSE
                cd = (gam-1.)*abs8d/(2.0*SQRT((gam-1.)*abs8))
              END IF
              c = SQRT((gam-1.)*abs8)
C
Cdetermination vitesse normale interface
              qn1d = tcx*qp2d + tcy*qp3d + tcz*qp4d
              qn1 = qp2*tcx + qp3*tcy + qp4*tcz
              qn2d = tcx*qm2d + tcy*qm3d + tcz*qm4d
              qn2 = qm2*tcx + qm3*tcy + qm4*tcz
C
              dud = sj*(qm2d-qp2d)
              du = (qm2-qp2)*sj
              dvd = sj*(qm3d-qp3d)
              dv = (qm3-qp3)*sj
              dwd = sj*(qm4d-qp4d)
              dw = (qm4-qp4)*sj
              dpd = p2d - p1d
              dp = p2 - p1
CSdqn
              dqnd = qn2d - qn1d
              dqn = qn2 - qn1
              IF (sj .LT. 1.e-30) THEN
                max32 = 1.e-30
              ELSE
                max32 = sj
              END IF
C
C.....Evaluation des valeurs propres
              s_1 = 1./max32
              nx = tcx*s_1
              ny = tcy*s_1
              nz = tcz*s_1
C
              qnd = nx*ud + ny*vd + nz*wd
              qn = u*nx + v*ny + w*nz
C
              f1d = qnd
              f1 = qn
              IF (f1 .GE. 0.) THEN
                abs9d = f1d
                abs9 = f1
              ELSE
                abs9d = -f1d
                abs9 = -f1
              END IF
Cdelta
              f4d = psiroe*(abs9d+cd)
              f4 = psiroe*(abs9+c)
              IF (f1 .GE. 0.) THEN
                abs10 = f1
              ELSE
                abs10 = -f1
              END IF
C
              f2 = .5 + SIGN(.5, abs10 - f4)
              IF (f1 .GE. 0.) THEN
                abs11d = f1d
                abs11 = f1
              ELSE
                abs11d = -f1d
                abs11 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs11d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs11
C  a123
              f1d = sj*(r2d-r1d-(dpd*c**2-dp*(cd*c+c*cd))/(c*c)**2)
              f1 = (r2-r1-dp/(c*c))*sj
              flu1d = f3d*f1 + f3*f1d
              flu1 = f3*f1
              flu2d = f3d*(f1*u+r*(du-nx*dqn)) + f3*(f1d*u+f1*ud+rd*(du-
     +          nx*dqn)+r*(dud-nx*dqnd))
              flu2 = f3*(f1*u+r*(du-nx*dqn))
              flu3d = f3d*(f1*v+r*(dv-ny*dqn)) + f3*(f1d*v+f1*vd+rd*(dv-
     +          ny*dqn)+r*(dvd-ny*dqnd))
              flu3 = f3*(f1*v+r*(dv-ny*dqn))
              flu4d = f3d*(f1*w+r*(dw-nz*dqn)) + f3*(f1d*w+f1*wd+rd*(dw-
     +          nz*dqn)+r*(dwd-nz*dqnd))
              flu4 = f3*(f1*w+r*(dw-nz*dqn))
              flu5d = f3d*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn)) + f3*(f1d*q+
     +          f1*qd+rd*(u*du+v*dv+w*dw-qn*dqn)+r*(ud*du+u*dud+vd*dv+v*
     +          dvd+wd*dw+w*dwd-qnd*dqn-qn*dqnd))
              flu5 = f3*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn))
C
              f1d = qnd + cd
              f1 = qn + c
              IF (f1 .GE. 0.) THEN
                abs12 = f1
              ELSE
                abs12 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs12 - f4)
              IF (f1 .GE. 0.) THEN
                abs13d = f1d
                abs13 = f1
              ELSE
                abs13d = -f1d
                abs13 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs13d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs13
Clambda4*S*a4
              f1d = sj*(((dpd+s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp+r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp+r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp+r*c*dqn*s_1)/(2.*c*c)*sj*f3
C
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u+nx*c) + f1*(ud+nx*cd)
              flu2 = flu2 + f1*(u+nx*c)
              flu3d = flu3d + f1d*(v+ny*c) + f1*(vd+ny*cd)
              flu3 = flu3 + f1*(v+ny*c)
              flu4d = flu4d + f1d*(w+nz*c) + f1*(wd+nz*cd)
              flu4 = flu4 + f1*(w+nz*c)
              flu5d = flu5d + f1d*(h+qn*c) + f1*(hd+qnd*c+qn*cd)
              flu5 = flu5 + f1*(h+qn*c)
C
              f1d = qnd - cd
              f1 = qn - c
              IF (f1 .GE. 0.) THEN
                abs14 = f1
              ELSE
                abs14 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs14 - f4)
              IF (f1 .GE. 0.) THEN
                abs15d = f1d
                abs15 = f1
              ELSE
                abs15d = -f1d
                abs15 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs15d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs15
C
Clambda5*S*a5
              f1d = sj*(((dpd-s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp-r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp-r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp-r*c*dqn*s_1)/(2.*c*c)*f3*sj
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u-nx*c) + f1*(ud-nx*cd)
              flu2 = flu2 + f1*(u-nx*c)
              flu3d = flu3d + f1d*(v-ny*c) + f1*(vd-ny*cd)
              flu3 = flu3 + f1*(v-ny*c)
              flu4d = flu4d + f1d*(w-nz*c) + f1*(wd-nz*cd)
              flu4 = flu4 + f1*(w-nz*c)
              flu5d = flu5d + f1d*(h-qn*c) + f1*(hd-qnd*c-qn*cd)
              flu5 = flu5 + f1*(h-qn*c)
C
              rou1d = r1d*qn1 + r1*qn1d
              rou1 = r1*qn1
              rou2d = r2d*qn2 + r2*qn2d
              rou2 = r2*qn2
              p1p2d = p1d + p2d
              p1p2 = p1 + p2
              flu1d = 0.5*(flu1d+rou1d+rou2d)
              flu1 = (flu1+rou1+rou2)*0.5
              flu2d = 0.5*(flu2d+rou1d*qp2+rou1*qp2d+rou2d*qm2+rou2*qm2d
     +          +tcx*p1p2d)
              flu2 = (flu2+rou1*qp2+rou2*qm2+tcx*p1p2)*0.5
              flu3d = 0.5*(flu3d+rou1d*qp3+rou1*qp3d+rou2d*qm3+rou2*qm3d
     +          +tcy*p1p2d)
              flu3 = (flu3+rou1*qp3+rou2*qm3+tcy*p1p2)*0.5
              flu4d = 0.5*(flu4d+rou1d*qp4+rou1*qp4d+rou2d*qm4+rou2*qm4d
     +          +tcz*p1p2d)
              flu4 = (flu4+rou1*qp4+rou2*qm4+tcz*p1p2)*0.5
C1=?+1; 
C3=?+2 
C2=?-1
C4=?-2
Cl341  = (i+2,j-2,k+1)
              flu5d = 0.5*(flu5d+rou1d*h1+rou1*h1d+rou2d*h2+rou2*h2d)
              flu5 = (flu5+rou1*h1+rou2*h2)*0.5
              lt020 = lt - incj_mtr
              lt021 = lt - incj_mtr + inck_mtr
              lt010 = lt + incj_mtr
              lt001 = lt + inck_mtr
              lt100 = lt + inci_mtr
              lt120 = lt + inci_mtr - incj_mtr
C
              lvor = lt
              lvol = lt020
C
              il = l - incj
              ir = l
              l200 = l - inci
              l100 = l + inci
              l010 = l + incj
              l002 = l - inck
              l001 = l + inck
              l220 = l - inci - incj
              l021 = l - incj + inck
              l022 = l - incj - inck
CCalcul des vecteurs surfaces J
              l120 = l + inci - incj
CCCCCC
CCCCCC
CCCCCC   Facette J
CCCCCC
CCCCCC
              tix = .5*(tj(lt+v1mtr)+tj(lt020+v1mtr))
              tiy = .5*(tj(lt+v2mtr)+tj(lt020+v2mtr))
              tiz = .5*(tj(lt+v3mtr)+tj(lt020+v3mtr))
              tix1 = .5*(tj(lt+v1mtr)+tj(lt010+v1mtr))
              tiy1 = .5*(tj(lt+v2mtr)+tj(lt010+v2mtr))
              tiz1 = .5*(tj(lt+v3mtr)+tj(lt010+v3mtr))
C
C(i,j,k) et (i,j-1,k)
              tjx = .125*(tk(lt+v1mtr)+tk(lt020+v1mtr))
              tjy = .125*(tk(lt+v2mtr)+tk(lt020+v2mtr))
              tjz = .125*(tk(lt+v3mtr)+tk(lt020+v3mtr))
C(i,j,k+1) et (i,j-1,k+1)
              tjx1 = .125*(tk(lt001+v1mtr)+tk(lt021+v1mtr))
              tjy1 = .125*(tk(lt001+v2mtr)+tk(lt021+v2mtr))
              tjz1 = .125*(tk(lt001+v3mtr)+tk(lt021+v3mtr))
C
C(i,j,k) et (i,j-1,k)
              tkx = .125*(ti(lt+v1mtr)+ti(lt020+v1mtr))
              tky = .125*(ti(lt+v2mtr)+ti(lt020+v2mtr))
              tkz = .125*(ti(lt+v3mtr)+ti(lt020+v3mtr))
C(i+1,j,k) et (i+1,j-1,k)
              tkx1 = .125*(ti(lt100+v1mtr)+ti(lt120+v1mtr))
              tky1 = .125*(ti(lt100+v2mtr)+ti(lt120+v2mtr))
C --- Gradients en U_j (i,j,k), (i,j-1,k), (i,j-1,k-1), (i,j,k-1)
              tkz1 = .125*(ti(lt100+v3mtr)+ti(lt120+v3mtr))
C
              f1d = ropd(il+v2)
              f1 = rop(il+v2)
              f2d = ropd(ir+v2)
              f2 = rop(ir+v2)
              f3d = ropd(ir+v2) + ropd(il+v2) + ropd(l022+v2) + ropd(
     +          l002+v2)
              f3 = rop(ir+v2) + rop(il+v2) + rop(l022+v2) + rop(l002+v2)
              f4d = ropd(ir+v2) + ropd(il+v2) + ropd(l021+v2) + ropd(
     +          l001+v2)
              f4 = rop(ir+v2) + rop(il+v2) + rop(l021+v2) + rop(l001+v2)
              f5d = ropd(ir+v2) + ropd(il+v2) + ropd(l220+v2) + ropd(
     +          l200+v2)
              f5 = rop(ir+v2) + rop(il+v2) + rop(l220+v2) + rop(l200+v2)
              f6d = ropd(ir+v2) + ropd(il+v2) + ropd(l120+v2) + ropd(
     +          l100+v2)
              f6 = rop(ir+v2) + rop(il+v2) + rop(l120+v2) + rop(l100+v2)
C
              gradu_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradu_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradu_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradu_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en V_j
              gradu_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradu_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v3)
              f1 = rop(il+v3)
              f2d = ropd(ir+v3)
              f2 = rop(ir+v3)
              f3d = ropd(ir+v3) + ropd(il+v3) + ropd(l022+v3) + ropd(
     +          l002+v3)
              f3 = rop(ir+v3) + rop(il+v3) + rop(l022+v3) + rop(l002+v3)
              f4d = ropd(ir+v3) + ropd(il+v3) + ropd(l021+v3) + ropd(
     +          l001+v3)
              f4 = rop(ir+v3) + rop(il+v3) + rop(l021+v3) + rop(l001+v3)
              f5d = ropd(ir+v3) + ropd(il+v3) + ropd(l220+v3) + ropd(
     +          l200+v3)
              f5 = rop(ir+v3) + rop(il+v3) + rop(l220+v3) + rop(l200+v3)
              f6d = ropd(ir+v3) + ropd(il+v3) + ropd(l120+v3) + ropd(
     +          l100+v3)
              f6 = rop(ir+v3) + rop(il+v3) + rop(l120+v3) + rop(l100+v3)
C
              gradv_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradv_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradv_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradv_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en W_j
              gradv_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradv_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v4)
              f1 = rop(il+v4)
              f2d = ropd(ir+v4)
              f2 = rop(ir+v4)
              f3d = ropd(ir+v4) + ropd(il+v4) + ropd(l022+v4) + ropd(
     +          l002+v4)
              f3 = rop(ir+v4) + rop(il+v4) + rop(l022+v4) + rop(l002+v4)
              f4d = ropd(ir+v4) + ropd(il+v4) + ropd(l021+v4) + ropd(
     +          l001+v4)
              f4 = rop(ir+v4) + rop(il+v4) + rop(l021+v4) + rop(l001+v4)
              f5d = ropd(ir+v4) + ropd(il+v4) + ropd(l220+v4) + ropd(
     +          l200+v4)
              f5 = rop(ir+v4) + rop(il+v4) + rop(l220+v4) + rop(l200+v4)
              f6d = ropd(ir+v4) + ropd(il+v4) + ropd(l120+v4) + ropd(
     +          l100+v4)
              f6 = rop(ir+v4) + rop(il+v4) + rop(l120+v4) + rop(l100+v4)
C
              gradw_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradw_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradw_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradw_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en T_j
              gradw_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradw_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v5)
              f1 = rop(il+v5)
              f2d = ropd(ir+v5)
              f2 = rop(ir+v5)
              f3d = ropd(ir+v5) + ropd(il+v5) + ropd(l022+v5) + ropd(
     +          l002+v5)
              f3 = rop(ir+v5) + rop(il+v5) + rop(l022+v5) + rop(l002+v5)
              f4d = ropd(ir+v5) + ropd(il+v5) + ropd(l021+v5) + ropd(
     +          l001+v5)
              f4 = rop(ir+v5) + rop(il+v5) + rop(l021+v5) + rop(l001+v5)
              f5d = ropd(ir+v5) + ropd(il+v5) + ropd(l220+v5) + ropd(
     +          l200+v5)
              f5 = rop(ir+v5) + rop(il+v5) + rop(l220+v5) + rop(l200+v5)
              f6d = ropd(ir+v5) + ropd(il+v5) + ropd(l120+v5) + ropd(
     +          l100+v5)
              f6 = rop(ir+v5) + rop(il+v5) + rop(l120+v5) + rop(l100+v5)
C
              gradt_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradt_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradt_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradt_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- assemblage flux
              gradt_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradt_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              divd = cvisq*(gradu_nxd+gradv_nyd+gradw_nzd)
              div = (gradu_nx+gradv_ny+gradw_nz)*cvisq
              f1d = gradu_nxd - divd
              f1 = gradu_nx - div
              f2d = gradu_nyd + gradv_nxd
              f2 = gradu_ny + gradv_nx
              f3d = gradu_nzd + gradw_nxd
              f3 = gradu_nz + gradw_nx
              f4d = gradv_nyd - divd
              f4 = gradv_ny - div
              f5d = gradv_nzd + gradw_nyd
              f5 = gradv_nz + gradw_ny
              f6d = gradw_nzd - divd
              f6 = gradw_nz - div
C
              volinv = 1./(vol(lvor)+vol(lvol))
              xmutvol = (xmut(ir)+xmut(il))*volinv
              xktvol = xmutvol*gam3
C
              fvd = -(xmutvol*(2.*tcx*f1d+tcy*f2d+tcz*f3d))
              fv = -((2.*f1*tcx+f2*tcy+f3*tcz)*xmutvol)
              fv5d = fvd*(rop(ir+v2)+rop(il+v2)) + fv*(ropd(ir+v2)+ropd(
     +          il+v2))
              fv5 = fv*(rop(ir+v2)+rop(il+v2))
              flu2d = flu2d + fvd
              flu2 = flu2 + fv
C
              fvd = -(xmutvol*(tcx*f2d+2.*tcy*f4d+tcz*f5d))
              fv = -((f2*tcx+2.*f4*tcy+f5*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v3)+rop(il+v3)) + fv*(ropd(ir+v3
     +          )+ropd(il+v3))
              fv5 = fv5 + fv*(rop(ir+v3)+rop(il+v3))
              flu3d = flu3d + fvd
              flu3 = flu3 + fv
C
              fvd = -(xmutvol*(tcx*f3d+tcy*f5d+2.*tcz*f6d))
              fv = -((f3*tcx+f5*tcy+2.*f6*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v4)+rop(il+v4)) + fv*(ropd(ir+v4
     +          )+ropd(il+v4))
              fv5 = fv5 + fv*(rop(ir+v4)+rop(il+v4))
              flu4d = flu4d + fvd
              flu4 = flu4 + fv
C
              fvd = 0.5*fv5d - xktvol*(tcx*gradt_nxd+tcy*gradt_nyd+tcz*
     +          gradt_nzd)
              fv = fv5*0.5 - (gradt_nx*tcx+gradt_ny*tcy+gradt_nz*tcz)*
     +          xktvol
              flu5d = flu5d + fvd
              flu5 = flu5 + fv
              drodmd(l+v1) = drodmd(l+v1) + flu1d
              drodmd(l0+v1) = drodmd(l0+v1) - flu1d
              drodmd(l+v2) = drodmd(l+v2) + flu2d
              drodmd(l0+v2) = drodmd(l0+v2) - flu2d
              drodmd(l+v3) = drodmd(l+v3) + flu3d
              drodmd(l0+v3) = drodmd(l0+v3) - flu3d
              drodmd(l+v4) = drodmd(l+v4) + flu4d
              drodmd(l0+v4) = drodmd(l0+v4) - flu4d
              drodmd(l+v5) = drodmd(l+v5) + flu5d
              drodmd(l0+v5) = drodmd(l0+v5) - flu5d
            ENDDO
C
            lij = 1 + (ind_loop(1)+param_int(0+3)-1) + (j+param_int(0+3)
     +        -1)*param_int(0) + (k+param_int(0+4)-1)*param_int(0)*
     +        param_int(0+1) - 1
            ltij = lij - (1+(ind_loop(1)+param_int(5+3)-1)*param_int(5)+
     +        (j+param_int(5+3)-1)*param_int(5+1)+(k+param_int(5+4)-1)*
     +        param_int(5+2)) + 1
CC    !DIR$ ASSUME (mod(lij,4) .eq. 0)
CDIR$ IVDEP
CDIR$ DISTRIBUTE POINT
            DO l=lij+1,lij+1+ind_loop(2)-ind_loop(1)
C
              lt = l - ltij
              lvo = lt
              l0 = l - inci
C.....Metrique
              tcx = ti(lt+v1mtr)
              tcy = ti(lt+v2mtr)
              tcz = ti(lt+v3mtr)
              arg1 = tcx*tcx + tcy*tcy + tcz*tcz
              si = SQRT(arg1)
C
              nm = l - inci
              nm2 = l - 2*inci
              np = l + inci
C
C pente (qm) a l'interface droite et  (qp) a l'interface gauche
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v1
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y31 = 1.
                y31d = 0.0
              ELSE
                y31d = tmin_1*ropd(l+v5)
                y31 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y31) THEN
                max33d = y31d
                max33 = y31
              ELSE
                max33 = 0.
                max33d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max33d
              roff = .5*max33
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x21d = delmd
                x21 = delm
              ELSE
                x21d = -delmd
                x21 = -delm
              END IF
              y111d = SIGN(1., delm)*delpd
              y111 = SIGN(1., delm)*delp
              IF (x21 .GT. y111) THEN
                y32d = y111d
                y32 = y111
              ELSE
                y32d = x21d
                y32 = x21
              END IF
              IF (0. .LT. y32) THEN
                max34d = y32d
                max34 = y32
              ELSE
                max34 = 0.
                max34d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max34+roff*max34d)
              slp = roff*(SIGN(1., delm)*max34)
              IF (delq .GE. 0.) THEN
                x22d = delqd
                x22 = delq
              ELSE
                x22d = -delqd
                x22 = -delq
              END IF
              y112d = SIGN(1., delq)*delmd
              y112 = SIGN(1., delq)*delm
              IF (x22 .GT. y112) THEN
                y33d = y112d
                y33 = y112
              ELSE
                y33d = x22d
                y33 = x22
              END IF
              IF (0. .LT. y33) THEN
                max35d = y33d
                max35 = y33
              ELSE
                max35 = 0.
                max35d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max35+roff*max35d)
              slq = roff*(SIGN(1., delq)*max35)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm1d = qmd
              qm1 = qm
              qp1d = qpd
              qp1 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v2
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y34 = 1.
                y34d = 0.0
              ELSE
                y34d = tmin_1*ropd(l+v5)
                y34 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y34) THEN
                max36d = y34d
                max36 = y34
              ELSE
                max36 = 0.
                max36d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max36d
              roff = .5*max36
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x23d = delmd
                x23 = delm
              ELSE
                x23d = -delmd
                x23 = -delm
              END IF
              y113d = SIGN(1., delm)*delpd
              y113 = SIGN(1., delm)*delp
              IF (x23 .GT. y113) THEN
                y35d = y113d
                y35 = y113
              ELSE
                y35d = x23d
                y35 = x23
              END IF
              IF (0. .LT. y35) THEN
                max37d = y35d
                max37 = y35
              ELSE
                max37 = 0.
                max37d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max37+roff*max37d)
              slp = roff*(SIGN(1., delm)*max37)
              IF (delq .GE. 0.) THEN
                x24d = delqd
                x24 = delq
              ELSE
                x24d = -delqd
                x24 = -delq
              END IF
              y114d = SIGN(1., delq)*delmd
              y114 = SIGN(1., delq)*delm
              IF (x24 .GT. y114) THEN
                y36d = y114d
                y36 = y114
              ELSE
                y36d = x24d
                y36 = x24
              END IF
              IF (0. .LT. y36) THEN
                max38d = y36d
                max38 = y36
              ELSE
                max38 = 0.
                max38d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max38+roff*max38d)
              slq = roff*(SIGN(1., delq)*max38)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm2d = qmd
              qm2 = qm
              qp2d = qpd
              qp2 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v3
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y37 = 1.
                y37d = 0.0
              ELSE
                y37d = tmin_1*ropd(l+v5)
                y37 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y37) THEN
                max39d = y37d
                max39 = y37
              ELSE
                max39 = 0.
                max39d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max39d
              roff = .5*max39
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x25d = delmd
                x25 = delm
              ELSE
                x25d = -delmd
                x25 = -delm
              END IF
              y115d = SIGN(1., delm)*delpd
              y115 = SIGN(1., delm)*delp
              IF (x25 .GT. y115) THEN
                y38d = y115d
                y38 = y115
              ELSE
                y38d = x25d
                y38 = x25
              END IF
              IF (0. .LT. y38) THEN
                max40d = y38d
                max40 = y38
              ELSE
                max40 = 0.
                max40d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max40+roff*max40d)
              slp = roff*(SIGN(1., delm)*max40)
              IF (delq .GE. 0.) THEN
                x26d = delqd
                x26 = delq
              ELSE
                x26d = -delqd
                x26 = -delq
              END IF
              y116d = SIGN(1., delq)*delmd
              y116 = SIGN(1., delq)*delm
              IF (x26 .GT. y116) THEN
                y39d = y116d
                y39 = y116
              ELSE
                y39d = x26d
                y39 = x26
              END IF
              IF (0. .LT. y39) THEN
                max41d = y39d
                max41 = y39
              ELSE
                max41 = 0.
                max41d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max41+roff*max41d)
              slq = roff*(SIGN(1., delq)*max41)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm3d = qmd
              qm3 = qm
              qp3d = qpd
              qp3 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v4
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y40 = 1.
                y40d = 0.0
              ELSE
                y40d = tmin_1*ropd(l+v5)
                y40 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y40) THEN
                max42d = y40d
                max42 = y40
              ELSE
                max42 = 0.
                max42d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max42d
              roff = .5*max42
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x27d = delmd
                x27 = delm
              ELSE
                x27d = -delmd
                x27 = -delm
              END IF
              y117d = SIGN(1., delm)*delpd
              y117 = SIGN(1., delm)*delp
              IF (x27 .GT. y117) THEN
                y41d = y117d
                y41 = y117
              ELSE
                y41d = x27d
                y41 = x27
              END IF
              IF (0. .LT. y41) THEN
                max43d = y41d
                max43 = y41
              ELSE
                max43 = 0.
                max43d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max43+roff*max43d)
              slp = roff*(SIGN(1., delm)*max43)
              IF (delq .GE. 0.) THEN
                x28d = delqd
                x28 = delq
              ELSE
                x28d = -delqd
                x28 = -delq
              END IF
              y118d = SIGN(1., delq)*delmd
              y118 = SIGN(1., delq)*delm
              IF (x28 .GT. y118) THEN
                y42d = y118d
                y42 = y118
              ELSE
                y42d = x28d
                y42 = x28
              END IF
              IF (0. .LT. y42) THEN
                max44d = y42d
                max44 = y42
              ELSE
                max44 = 0.
                max44d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max44+roff*max44d)
              slq = roff*(SIGN(1., delq)*max44)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm4d = qmd
              qm4 = qm
              qp4d = qpd
              qp4 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v5
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y43 = 1.
                y43d = 0.0
              ELSE
                y43d = tmin_1*ropd(l+v5)
                y43 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y43) THEN
                max45d = y43d
                max45 = y43
              ELSE
                max45 = 0.
                max45d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max45d
              roff = .5*max45
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x29d = delmd
                x29 = delm
              ELSE
                x29d = -delmd
                x29 = -delm
              END IF
              y119d = SIGN(1., delm)*delpd
              y119 = SIGN(1., delm)*delp
              IF (x29 .GT. y119) THEN
                y44d = y119d
                y44 = y119
              ELSE
                y44d = x29d
                y44 = x29
              END IF
              IF (0. .LT. y44) THEN
                max46d = y44d
                max46 = y44
              ELSE
                max46 = 0.
                max46d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max46+roff*max46d)
              slp = roff*(SIGN(1., delm)*max46)
              IF (delq .GE. 0.) THEN
                x30d = delqd
                x30 = delq
              ELSE
                x30d = -delqd
                x30 = -delq
              END IF
              y120d = SIGN(1., delq)*delmd
              y120 = SIGN(1., delq)*delm
              IF (x30 .GT. y120) THEN
                y45d = y120d
                y45 = y120
              ELSE
                y45d = x30d
                y45 = x30
              END IF
              IF (0. .LT. y45) THEN
                max47d = y45d
                max47 = y45
              ELSE
                max47 = 0.
                max47d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max47+roff*max47d)
              slq = roff*(SIGN(1., delq)*max47)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm5d = qmd
              qm5 = qm
              qp5d = qpd
              qp5 = qp
C
Cdetermination etat gauche (rou1) et droit (rou2): ro, roui, roe+p
              r1d = qp1d
              r1 = qp1
              p1d = rgp*(r1d*qp5+r1*qp5d)
              p1 = r1*qp5*rgp
Cdetermination etat droite: ro, roui, roe+p
              h1d = gam1*rgp*qp5d + .5*(qp2d*qp2+qp2*qp2d+qp3d*qp3+qp3*
     +          qp3d+qp4d*qp4+qp4*qp4d)
              h1 = gam1*qp5*rgp + .5*(qp2*qp2+qp3*qp3+qp4*qp4)
C
              r2d = qm1d
              r2 = qm1
              p2d = rgp*(r2d*qm5+r2*qm5d)
              p2 = r2*qm5*rgp
              h2d = gam1*rgp*qm5d + .5*(qm2d*qm2+qm2*qm2d+qm3d*qm3+qm3*
     +          qm3d+qm4d*qm4+qm4*qm4d)
              h2 = gam1*qm5*rgp + .5*(qm2*qm2+qm3*qm3+qm4*qm4)
C
Cdetermination etat moyenne roe
              IF (r1 .EQ. 0.0) THEN
                qp1d = 0.D0
              ELSE
                qp1d = r1d/(2.0*SQRT(r1))
              END IF
              qp1 = SQRT(r1)
              IF (r2 .EQ. 0.0) THEN
                qm1d = 0.D0
              ELSE
                qm1d = r2d/(2.0*SQRT(r2))
              END IF
              qm1 = SQRT(r2)
              rd = qp1d*qm1 + qp1*qm1d
              r = qp1*qm1
              r_1d = -((qp1d+qm1d)/(qp1+qm1)**2)
              r_1 = 1./(qp1+qm1)
              ud = (qp1d*qp2+qp1*qp2d+qm1d*qm2+qm1*qm2d)*r_1 + (qp1*qp2+
     +          qm1*qm2)*r_1d
              u = (qp1*qp2+qm1*qm2)*r_1
              vd = (qp1d*qp3+qp1*qp3d+qm1d*qm3+qm1*qm3d)*r_1 + (qp1*qp3+
     +          qm1*qm3)*r_1d
              v = (qp1*qp3+qm1*qm3)*r_1
              wd = (qp1d*qp4+qp1*qp4d+qm1d*qm4+qm1*qm4d)*r_1 + (qp1*qp4+
     +          qm1*qm4)*r_1d
              w = (qp1*qp4+qm1*qm4)*r_1
              hd = (qp1d*h1+qp1*h1d+qm1d*h2+qm1*h2d)*r_1 + (qp1*h1+qm1*
     +          h2)*r_1d
              h = (qp1*h1+qm1*h2)*r_1
              qd = .5*(ud*u+u*ud+vd*v+v*vd+wd*w+w*wd)
              q = .5*(u*u+v*v+w*w)
              IF (h - q .GE. 0.) THEN
                abs16d = hd - qd
                abs16 = h - q
              ELSE
                abs16d = -(hd-qd)
                abs16 = -(h-q)
              END IF
              IF ((gam-1.)*abs16 .EQ. 0.0) THEN
                cd = 0.D0
              ELSE
                cd = (gam-1.)*abs16d/(2.0*SQRT((gam-1.)*abs16))
              END IF
              c = SQRT((gam-1.)*abs16)
C
Cdetermination vitesse normale interface
              qn1d = tcx*qp2d + tcy*qp3d + tcz*qp4d
              qn1 = qp2*tcx + qp3*tcy + qp4*tcz
              qn2d = tcx*qm2d + tcy*qm3d + tcz*qm4d
              qn2 = qm2*tcx + qm3*tcy + qm4*tcz
C
              dud = si*(qm2d-qp2d)
              du = (qm2-qp2)*si
              dvd = si*(qm3d-qp3d)
              dv = (qm3-qp3)*si
              dwd = si*(qm4d-qp4d)
              dw = (qm4-qp4)*si
              dpd = p2d - p1d
              dp = p2 - p1
CSdqn
              dqnd = qn2d - qn1d
              dqn = qn2 - qn1
              IF (si .LT. 1.e-30) THEN
                max48 = 1.e-30
              ELSE
                max48 = si
              END IF
C
C.....Evaluation des valeurs propres
              s_1 = 1.0/max48
              nx = tcx*s_1
              ny = tcy*s_1
              nz = tcz*s_1
C
              qnd = nx*ud + ny*vd + nz*wd
              qn = u*nx + v*ny + w*nz
C
              f1d = qnd
              f1 = qn
              IF (f1 .GE. 0.) THEN
                abs17d = f1d
                abs17 = f1
              ELSE
                abs17d = -f1d
                abs17 = -f1
              END IF
Cdelta
              f4d = psiroe*(abs17d+cd)
              f4 = psiroe*(abs17+c)
              IF (f1 .GE. 0.) THEN
                abs18 = f1
              ELSE
                abs18 = -f1
              END IF
C
              f2 = 0.5 + SIGN(0.5, abs18 - f4)
              IF (f1 .GE. 0.) THEN
                abs19d = f1d
                abs19 = f1
              ELSE
                abs19d = -f1d
                abs19 = -f1
              END IF
              f3d = (f2-1.0)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs19d
              f3 = (f2-1.0)*(f1*f1/f4+f4)*0.5 - f2*abs19
C  a123
              f1d = si*(r2d-r1d-(dpd*c**2-dp*(cd*c+c*cd))/(c*c)**2)
              f1 = (r2-r1-dp/(c*c))*si
              flu1d = f3d*f1 + f3*f1d
              flu1 = f3*f1
              flu2d = f3d*(f1*u+r*(du-nx*dqn)) + f3*(f1d*u+f1*ud+rd*(du-
     +          nx*dqn)+r*(dud-nx*dqnd))
              flu2 = f3*(f1*u+r*(du-nx*dqn))
              flu3d = f3d*(f1*v+r*(dv-ny*dqn)) + f3*(f1d*v+f1*vd+rd*(dv-
     +          ny*dqn)+r*(dvd-ny*dqnd))
              flu3 = f3*(f1*v+r*(dv-ny*dqn))
              flu4d = f3d*(f1*w+r*(dw-nz*dqn)) + f3*(f1d*w+f1*wd+rd*(dw-
     +          nz*dqn)+r*(dwd-nz*dqnd))
              flu4 = f3*(f1*w+r*(dw-nz*dqn))
              flu5d = f3d*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn)) + f3*(f1d*q+
     +          f1*qd+rd*(u*du+v*dv+w*dw-qn*dqn)+r*(ud*du+u*dud+vd*dv+v*
     +          dvd+wd*dw+w*dwd-qnd*dqn-qn*dqnd))
              flu5 = f3*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn))
C
              f1d = qnd + cd
              f1 = qn + c
              IF (f1 .GE. 0.) THEN
                abs20 = f1
              ELSE
                abs20 = -f1
              END IF
              f2 = 0.5 + SIGN(0.5, abs20 - f4)
              IF (f1 .GE. 0.) THEN
                abs21d = f1d
                abs21 = f1
              ELSE
                abs21d = -f1d
                abs21 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs21d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs21
Clambda4*S*a4
              f1d = si*(((dpd+s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp+r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp+r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp+r*c*dqn*s_1)/(2.*c*c)*si*f3
C
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u+nx*c) + f1*(ud+nx*cd)
              flu2 = flu2 + f1*(u+nx*c)
              flu3d = flu3d + f1d*(v+ny*c) + f1*(vd+ny*cd)
              flu3 = flu3 + f1*(v+ny*c)
              flu4d = flu4d + f1d*(w+nz*c) + f1*(wd+nz*cd)
              flu4 = flu4 + f1*(w+nz*c)
              flu5d = flu5d + f1d*(h+qn*c) + f1*(hd+qnd*c+qn*cd)
              flu5 = flu5 + f1*(h+qn*c)
C
              f1d = qnd - cd
              f1 = qn - c
              IF (f1 .GE. 0.) THEN
                abs22 = f1
              ELSE
                abs22 = -f1
              END IF
              f2 = 0.5 + SIGN(0.5, abs22 - f4)
              IF (f1 .GE. 0.) THEN
                abs23d = f1d
                abs23 = f1
              ELSE
                abs23d = -f1d
                abs23 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs23d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs23
C
Clambda5*S*a5
              f1d = si*(((dpd-s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp-r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp-r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp-r*c*dqn*s_1)/(2.*c*c)*f3*si
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u-nx*c) + f1*(ud-nx*cd)
              flu2 = flu2 + f1*(u-nx*c)
              flu3d = flu3d + f1d*(v-ny*c) + f1*(vd-ny*cd)
              flu3 = flu3 + f1*(v-ny*c)
              flu4d = flu4d + f1d*(w-nz*c) + f1*(wd-nz*cd)
              flu4 = flu4 + f1*(w-nz*c)
              flu5d = flu5d + f1d*(h-qn*c) + f1*(hd-qnd*c-qn*cd)
              flu5 = flu5 + f1*(h-qn*c)
C
              rou1d = r1d*qn1 + r1*qn1d
              rou1 = r1*qn1
              rou2d = r2d*qn2 + r2*qn2d
              rou2 = r2*qn2
              p1p2d = p1d + p2d
              p1p2 = p1 + p2
              flu1d = 0.5*(flu1d+rou1d+rou2d)
              flu1 = (flu1+rou1+rou2)*0.5
              flu2d = 0.5*(flu2d+rou1d*qp2+rou1*qp2d+rou2d*qm2+rou2*qm2d
     +          +tcx*p1p2d)
              flu2 = (flu2+rou1*qp2+rou2*qm2+tcx*p1p2)*0.5
              flu3d = 0.5*(flu3d+rou1d*qp3+rou1*qp3d+rou2d*qm3+rou2*qm3d
     +          +tcy*p1p2d)
              flu3 = (flu3+rou1*qp3+rou2*qm3+tcy*p1p2)*0.5
              flu4d = 0.5*(flu4d+rou1d*qp4+rou1*qp4d+rou2d*qm4+rou2*qm4d
     +          +tcz*p1p2d)
              flu4 = (flu4+rou1*qp4+rou2*qm4+tcz*p1p2)*0.5
C1=?+1; 
C3=?+2 
C2=?-1
C4=?-2
Cl341  = (i+2,j-2,k+1)
              flu5d = 0.5*(flu5d+rou1d*h1+rou1*h1d+rou2d*h2+rou2*h2d)
              flu5 = (flu5+rou1*h1+rou2*h2)*0.5
              lt200 = lt - inci_mtr
              lt100 = lt + inci_mtr
              lt010 = lt + incj_mtr
              lt210 = lt - inci_mtr + incj_mtr
              lt201 = lt - inci_mtr + inck_mtr
              lt001 = lt + inck_mtr
C
              lvor = lt
              lvol = lt200
C
              il = l - inci
              ir = l
              l100 = l + inci
              l010 = l + incj
              l020 = l - incj
              l001 = l + inck
              l002 = l - inck
              l210 = l - inci + incj
              l220 = l - inci - incj
              l201 = l - inci + inck
CCalcul des vecteurs surfaces I
              l202 = l - inci - inck
C
CCCCCC
CCCCCC
CCCCCC   Facette I
CCCCCC
CCCCCC
              tix = .5*(ti(lt+v1mtr)+ti(lt200+v1mtr))
              tiy = .5*(ti(lt+v2mtr)+ti(lt200+v2mtr))
              tiz = .5*(ti(lt+v3mtr)+ti(lt200+v3mtr))
              tix1 = .5*(ti(lt+v1mtr)+ti(lt100+v1mtr))
              tiy1 = .5*(ti(lt+v2mtr)+ti(lt100+v2mtr))
              tiz1 = .5*(ti(lt+v3mtr)+ti(lt100+v3mtr))
C
              tjx = .125*(tj(lt+v1mtr)+tj(lt200+v1mtr))
              tjy = .125*(tj(lt+v2mtr)+tj(lt200+v2mtr))
              tjz = .125*(tj(lt+v3mtr)+tj(lt200+v3mtr))
              tjx1 = .125*(tj(lt010+v1mtr)+tj(lt210+v1mtr))
              tjy1 = .125*(tj(lt010+v2mtr)+tj(lt210+v2mtr))
              tjz1 = .125*(tj(lt010+v3mtr)+tj(lt210+v3mtr))
C
              tkx = .125*(tk(lt+v1mtr)+tk(lt200+v1mtr))
              tky = .125*(tk(lt+v2mtr)+tk(lt200+v2mtr))
              tkz = .125*(tk(lt+v3mtr)+tk(lt200+v3mtr))
              tkx1 = .125*(tk(lt001+v1mtr)+tk(lt201+v1mtr))
              tky1 = .125*(tk(lt001+v2mtr)+tk(lt201+v2mtr))
C --- Gradients en U_i
              tkz1 = .125*(tk(lt001+v3mtr)+tk(lt201+v3mtr))
C
              f1d = ropd(il+v2)
              f1 = rop(il+v2)
              f2d = ropd(ir+v2)
              f2 = rop(ir+v2)
              f3d = ropd(ir+v2) + ropd(il+v2) + ropd(l220+v2) + ropd(
     +          l020+v2)
              f3 = rop(ir+v2) + rop(il+v2) + rop(l220+v2) + rop(l020+v2)
              f4d = ropd(ir+v2) + ropd(il+v2) + ropd(l210+v2) + ropd(
     +          l010+v2)
              f4 = rop(ir+v2) + rop(il+v2) + rop(l210+v2) + rop(l010+v2)
              f5d = ropd(ir+v2) + ropd(il+v2) + ropd(l202+v2) + ropd(
     +          l002+v2)
              f5 = rop(ir+v2) + rop(il+v2) + rop(l202+v2) + rop(l002+v2)
              f6d = ropd(ir+v2) + ropd(il+v2) + ropd(l201+v2) + ropd(
     +          l001+v2)
              f6 = rop(ir+v2) + rop(il+v2) + rop(l201+v2) + rop(l001+v2)
C
              gradu_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradu_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradu_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradu_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- Gradients en v_i
              gradu_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradu_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v3)
              f1 = rop(il+v3)
              f2d = ropd(ir+v3)
              f2 = rop(ir+v3)
              f3d = ropd(ir+v3) + ropd(il+v3) + ropd(l220+v3) + ropd(
     +          l020+v3)
              f3 = rop(ir+v3) + rop(il+v3) + rop(l220+v3) + rop(l020+v3)
              f4d = ropd(ir+v3) + ropd(il+v3) + ropd(l210+v3) + ropd(
     +          l010+v3)
              f4 = rop(ir+v3) + rop(il+v3) + rop(l210+v3) + rop(l010+v3)
              f5d = ropd(ir+v3) + ropd(il+v3) + ropd(l202+v3) + ropd(
     +          l002+v3)
              f5 = rop(ir+v3) + rop(il+v3) + rop(l202+v3) + rop(l002+v3)
              f6d = ropd(ir+v3) + ropd(il+v3) + ropd(l201+v3) + ropd(
     +          l001+v3)
              f6 = rop(ir+v3) + rop(il+v3) + rop(l201+v3) + rop(l001+v3)
C
              gradv_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradv_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradv_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradv_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- Gradients en W_i
              gradv_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradv_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v4)
              f1 = rop(il+v4)
              f2d = ropd(ir+v4)
              f2 = rop(ir+v4)
              f3d = ropd(ir+v4) + ropd(il+v4) + ropd(l220+v4) + ropd(
     +          l020+v4)
              f3 = rop(ir+v4) + rop(il+v4) + rop(l220+v4) + rop(l020+v4)
              f4d = ropd(ir+v4) + ropd(il+v4) + ropd(l210+v4) + ropd(
     +          l010+v4)
              f4 = rop(ir+v4) + rop(il+v4) + rop(l210+v4) + rop(l010+v4)
              f5d = ropd(ir+v4) + ropd(il+v4) + ropd(l202+v4) + ropd(
     +          l002+v4)
              f5 = rop(ir+v4) + rop(il+v4) + rop(l202+v4) + rop(l002+v4)
              f6d = ropd(ir+v4) + ropd(il+v4) + ropd(l201+v4) + ropd(
     +          l001+v4)
              f6 = rop(ir+v4) + rop(il+v4) + rop(l201+v4) + rop(l001+v4)
C
              gradw_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradw_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradw_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradw_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- Gradients en T_i
              gradw_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradw_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v5)
              f1 = rop(il+v5)
              f2d = ropd(ir+v5)
              f2 = rop(ir+v5)
              f3d = ropd(ir+v5) + ropd(il+v5) + ropd(l220+v5) + ropd(
     +          l020+v5)
              f3 = rop(ir+v5) + rop(il+v5) + rop(l220+v5) + rop(l020+v5)
              f4d = ropd(ir+v5) + ropd(il+v5) + ropd(l210+v5) + ropd(
     +          l010+v5)
              f4 = rop(ir+v5) + rop(il+v5) + rop(l210+v5) + rop(l010+v5)
              f5d = ropd(ir+v5) + ropd(il+v5) + ropd(l202+v5) + ropd(
     +          l002+v5)
              f5 = rop(ir+v5) + rop(il+v5) + rop(l202+v5) + rop(l002+v5)
              f6d = ropd(ir+v5) + ropd(il+v5) + ropd(l201+v5) + ropd(
     +          l001+v5)
              f6 = rop(ir+v5) + rop(il+v5) + rop(l201+v5) + rop(l001+v5)
C
              gradt_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradt_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradt_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradt_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- assemblage flux
              gradt_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradt_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              divd = cvisq*(gradu_nxd+gradv_nyd+gradw_nzd)
              div = (gradu_nx+gradv_ny+gradw_nz)*cvisq
              f1d = gradu_nxd - divd
              f1 = gradu_nx - div
              f2d = gradu_nyd + gradv_nxd
              f2 = gradu_ny + gradv_nx
              f3d = gradu_nzd + gradw_nxd
              f3 = gradu_nz + gradw_nx
              f4d = gradv_nyd - divd
              f4 = gradv_ny - div
              f5d = gradv_nzd + gradw_nyd
              f5 = gradv_nz + gradw_ny
              f6d = gradw_nzd - divd
              f6 = gradw_nz - div
C
              volinv = 1./(vol(lvor)+vol(lvol))
              xmutvol = (xmut(ir)+xmut(il))*volinv
              xktvol = xmutvol*gam3
C
              fvd = -(xmutvol*(2.*tcx*f1d+tcy*f2d+tcz*f3d))
              fv = -((2.*f1*tcx+f2*tcy+f3*tcz)*xmutvol)
              fv5d = fvd*(rop(ir+v2)+rop(il+v2)) + fv*(ropd(ir+v2)+ropd(
     +          il+v2))
              fv5 = fv*(rop(ir+v2)+rop(il+v2))
              flu2d = flu2d + fvd
              flu2 = flu2 + fv
C
              fvd = -(xmutvol*(tcx*f2d+2.*tcy*f4d+tcz*f5d))
              fv = -((f2*tcx+2.*f4*tcy+f5*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v3)+rop(il+v3)) + fv*(ropd(ir+v3
     +          )+ropd(il+v3))
              fv5 = fv5 + fv*(rop(ir+v3)+rop(il+v3))
              flu3d = flu3d + fvd
              flu3 = flu3 + fv
C
              fvd = -(xmutvol*(tcx*f3d+tcy*f5d+2.*tcz*f6d))
              fv = -((f3*tcx+f5*tcy+2.*f6*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v4)+rop(il+v4)) + fv*(ropd(ir+v4
     +          )+ropd(il+v4))
              fv5 = fv5 + fv*(rop(ir+v4)+rop(il+v4))
              flu4d = flu4d + fvd
              flu4 = flu4 + fv
C
              fvd = 0.5*fv5d - xktvol*(tcx*gradt_nxd+tcy*gradt_nyd+tcz*
     +          gradt_nzd)
              fv = fv5*0.5 - (gradt_nx*tcx+gradt_ny*tcy+gradt_nz*tcz)*
     +          xktvol
              flu5d = flu5d + fvd
              flu5 = flu5 + fv
C
              drodmd(l+v1) = drodmd(l+v1) + flu1d
              drodmd(l0+v1) = drodmd(l0+v1) - flu1d
              drodmd(l+v2) = drodmd(l+v2) + flu2d
              drodmd(l0+v2) = drodmd(l0+v2) - flu2d
              drodmd(l+v3) = drodmd(l+v3) + flu3d
              drodmd(l0+v3) = drodmd(l0+v3) - flu3d
              drodmd(l+v4) = drodmd(l+v4) + flu4d
              drodmd(l0+v4) = drodmd(l0+v4) - flu4d
              drodmd(l+v5) = drodmd(l+v5) + flu5d
              drodmd(l0+v5) = drodmd(l0+v5) - flu5d
            ENDDO
C
C
            IF (icorr .EQ. 1) THEN
Cflux manquant en I
              i = ind_loop(2) + 1
              l = 1 + (i+param_int(0+3)-1) + (j+param_int(0+3)-1)*
     +          param_int(0) + (k+param_int(0+4)-1)*param_int(0)*
     +          param_int(0+1)
              lt = 1 + (i+param_int(5+3)-1)*param_int(5) + (j+param_int(
     +          5+3)-1)*param_int(5+1) + (k+param_int(5+4)-1)*param_int(
     +          5+2)
C.....Metrique
              tcx = ti(lt+v1mtr)
              tcy = ti(lt+v2mtr)
              tcz = ti(lt+v3mtr)
              arg1 = tcx*tcx + tcy*tcy + tcz*tcz
              si = SQRT(arg1)
C
              nm = l - inci
              nm2 = l - 2*inci
              np = l + inci
C
C pente (qm) a l'interface droite et  (qp) a l'interface gauche
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v1
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y46 = 1.
                y46d = 0.0
              ELSE
                y46d = tmin_1*ropd(l+v5)
                y46 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y46) THEN
                max49d = y46d
                max49 = y46
              ELSE
                max49 = 0.
                max49d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max49d
              roff = .5*max49
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x31d = delmd
                x31 = delm
              ELSE
                x31d = -delmd
                x31 = -delm
              END IF
              y121d = SIGN(1., delm)*delpd
              y121 = SIGN(1., delm)*delp
              IF (x31 .GT. y121) THEN
                y47d = y121d
                y47 = y121
              ELSE
                y47d = x31d
                y47 = x31
              END IF
              IF (0. .LT. y47) THEN
                max50d = y47d
                max50 = y47
              ELSE
                max50 = 0.
                max50d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max50+roff*max50d)
              slp = roff*(SIGN(1., delm)*max50)
              IF (delq .GE. 0.) THEN
                x32d = delqd
                x32 = delq
              ELSE
                x32d = -delqd
                x32 = -delq
              END IF
              y122d = SIGN(1., delq)*delmd
              y122 = SIGN(1., delq)*delm
              IF (x32 .GT. y122) THEN
                y48d = y122d
                y48 = y122
              ELSE
                y48d = x32d
                y48 = x32
              END IF
              IF (0. .LT. y48) THEN
                max51d = y48d
                max51 = y48
              ELSE
                max51 = 0.
                max51d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max51+roff*max51d)
              slq = roff*(SIGN(1., delq)*max51)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm1d = qmd
              qm1 = qm
              qp1d = qpd
              qp1 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v2
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y49 = 1.
                y49d = 0.0
              ELSE
                y49d = tmin_1*ropd(l+v5)
                y49 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y49) THEN
                max52d = y49d
                max52 = y49
              ELSE
                max52 = 0.
                max52d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max52d
              roff = .5*max52
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x33d = delmd
                x33 = delm
              ELSE
                x33d = -delmd
                x33 = -delm
              END IF
              y123d = SIGN(1., delm)*delpd
              y123 = SIGN(1., delm)*delp
              IF (x33 .GT. y123) THEN
                y50d = y123d
                y50 = y123
              ELSE
                y50d = x33d
                y50 = x33
              END IF
              IF (0. .LT. y50) THEN
                max53d = y50d
                max53 = y50
              ELSE
                max53 = 0.
                max53d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max53+roff*max53d)
              slp = roff*(SIGN(1., delm)*max53)
              IF (delq .GE. 0.) THEN
                x34d = delqd
                x34 = delq
              ELSE
                x34d = -delqd
                x34 = -delq
              END IF
              y124d = SIGN(1., delq)*delmd
              y124 = SIGN(1., delq)*delm
              IF (x34 .GT. y124) THEN
                y51d = y124d
                y51 = y124
              ELSE
                y51d = x34d
                y51 = x34
              END IF
              IF (0. .LT. y51) THEN
                max54d = y51d
                max54 = y51
              ELSE
                max54 = 0.
                max54d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max54+roff*max54d)
              slq = roff*(SIGN(1., delq)*max54)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm2d = qmd
              qm2 = qm
              qp2d = qpd
              qp2 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v3
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y52 = 1.
                y52d = 0.0
              ELSE
                y52d = tmin_1*ropd(l+v5)
                y52 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y52) THEN
                max55d = y52d
                max55 = y52
              ELSE
                max55 = 0.
                max55d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max55d
              roff = .5*max55
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x35d = delmd
                x35 = delm
              ELSE
                x35d = -delmd
                x35 = -delm
              END IF
              y125d = SIGN(1., delm)*delpd
              y125 = SIGN(1., delm)*delp
              IF (x35 .GT. y125) THEN
                y53d = y125d
                y53 = y125
              ELSE
                y53d = x35d
                y53 = x35
              END IF
              IF (0. .LT. y53) THEN
                max56d = y53d
                max56 = y53
              ELSE
                max56 = 0.
                max56d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max56+roff*max56d)
              slp = roff*(SIGN(1., delm)*max56)
              IF (delq .GE. 0.) THEN
                x36d = delqd
                x36 = delq
              ELSE
                x36d = -delqd
                x36 = -delq
              END IF
              y126d = SIGN(1., delq)*delmd
              y126 = SIGN(1., delq)*delm
              IF (x36 .GT. y126) THEN
                y54d = y126d
                y54 = y126
              ELSE
                y54d = x36d
                y54 = x36
              END IF
              IF (0. .LT. y54) THEN
                max57d = y54d
                max57 = y54
              ELSE
                max57 = 0.
                max57d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max57+roff*max57d)
              slq = roff*(SIGN(1., delq)*max57)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm3d = qmd
              qm3 = qm
              qp3d = qpd
              qp3 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v4
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y55 = 1.
                y55d = 0.0
              ELSE
                y55d = tmin_1*ropd(l+v5)
                y55 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y55) THEN
                max58d = y55d
                max58 = y55
              ELSE
                max58 = 0.
                max58d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max58d
              roff = .5*max58
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x37d = delmd
                x37 = delm
              ELSE
                x37d = -delmd
                x37 = -delm
              END IF
              y127d = SIGN(1., delm)*delpd
              y127 = SIGN(1., delm)*delp
              IF (x37 .GT. y127) THEN
                y56d = y127d
                y56 = y127
              ELSE
                y56d = x37d
                y56 = x37
              END IF
              IF (0. .LT. y56) THEN
                max59d = y56d
                max59 = y56
              ELSE
                max59 = 0.
                max59d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max59+roff*max59d)
              slp = roff*(SIGN(1., delm)*max59)
              IF (delq .GE. 0.) THEN
                x38d = delqd
                x38 = delq
              ELSE
                x38d = -delqd
                x38 = -delq
              END IF
              y128d = SIGN(1., delq)*delmd
              y128 = SIGN(1., delq)*delm
              IF (x38 .GT. y128) THEN
                y57d = y128d
                y57 = y128
              ELSE
                y57d = x38d
                y57 = x38
              END IF
              IF (0. .LT. y57) THEN
                max60d = y57d
                max60 = y57
              ELSE
                max60 = 0.
                max60d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max60+roff*max60d)
              slq = roff*(SIGN(1., delq)*max60)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm4d = qmd
              qm4 = qm
              qp4d = qpd
              qp4 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v5
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y58 = 1.
                y58d = 0.0
              ELSE
                y58d = tmin_1*ropd(l+v5)
                y58 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y58) THEN
                max61d = y58d
                max61 = y58
              ELSE
                max61 = 0.
                max61d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max61d
              roff = .5*max61
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x39d = delmd
                x39 = delm
              ELSE
                x39d = -delmd
                x39 = -delm
              END IF
              y129d = SIGN(1., delm)*delpd
              y129 = SIGN(1., delm)*delp
              IF (x39 .GT. y129) THEN
                y59d = y129d
                y59 = y129
              ELSE
                y59d = x39d
                y59 = x39
              END IF
              IF (0. .LT. y59) THEN
                max62d = y59d
                max62 = y59
              ELSE
                max62 = 0.
                max62d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max62+roff*max62d)
              slp = roff*(SIGN(1., delm)*max62)
              IF (delq .GE. 0.) THEN
                x40d = delqd
                x40 = delq
              ELSE
                x40d = -delqd
                x40 = -delq
              END IF
              y130d = SIGN(1., delq)*delmd
              y130 = SIGN(1., delq)*delm
              IF (x40 .GT. y130) THEN
                y60d = y130d
                y60 = y130
              ELSE
                y60d = x40d
                y60 = x40
              END IF
              IF (0. .LT. y60) THEN
                max63d = y60d
                max63 = y60
              ELSE
                max63 = 0.
                max63d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max63+roff*max63d)
              slq = roff*(SIGN(1., delq)*max63)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm5d = qmd
              qm5 = qm
              qp5d = qpd
              qp5 = qp
C
Cdetermination etat gauche (rou1) et droit (rou2): ro, roui, roe+p
              r1d = qp1d
              r1 = qp1
              p1d = rgp*(r1d*qp5+r1*qp5d)
              p1 = r1*qp5*rgp
Cdetermination etat droite: ro, roui, roe+p
              h1d = gam1*rgp*qp5d + .5*(qp2d*qp2+qp2*qp2d+qp3d*qp3+qp3*
     +          qp3d+qp4d*qp4+qp4*qp4d)
              h1 = gam1*qp5*rgp + .5*(qp2*qp2+qp3*qp3+qp4*qp4)
C
              r2d = qm1d
              r2 = qm1
              p2d = rgp*(r2d*qm5+r2*qm5d)
              p2 = r2*qm5*rgp
              h2d = gam1*rgp*qm5d + .5*(qm2d*qm2+qm2*qm2d+qm3d*qm3+qm3*
     +          qm3d+qm4d*qm4+qm4*qm4d)
              h2 = gam1*qm5*rgp + .5*(qm2*qm2+qm3*qm3+qm4*qm4)
C
Cdetermination etat moyenne roe
              IF (r1 .EQ. 0.0) THEN
                qp1d = 0.D0
              ELSE
                qp1d = r1d/(2.0*SQRT(r1))
              END IF
              qp1 = SQRT(r1)
              IF (r2 .EQ. 0.0) THEN
                qm1d = 0.D0
              ELSE
                qm1d = r2d/(2.0*SQRT(r2))
              END IF
              qm1 = SQRT(r2)
              rd = qp1d*qm1 + qp1*qm1d
              r = qp1*qm1
              r_1d = -((qp1d+qm1d)/(qp1+qm1)**2)
              r_1 = 1./(qp1+qm1)
              ud = (qp1d*qp2+qp1*qp2d+qm1d*qm2+qm1*qm2d)*r_1 + (qp1*qp2+
     +          qm1*qm2)*r_1d
              u = (qp1*qp2+qm1*qm2)*r_1
              vd = (qp1d*qp3+qp1*qp3d+qm1d*qm3+qm1*qm3d)*r_1 + (qp1*qp3+
     +          qm1*qm3)*r_1d
              v = (qp1*qp3+qm1*qm3)*r_1
              wd = (qp1d*qp4+qp1*qp4d+qm1d*qm4+qm1*qm4d)*r_1 + (qp1*qp4+
     +          qm1*qm4)*r_1d
              w = (qp1*qp4+qm1*qm4)*r_1
              hd = (qp1d*h1+qp1*h1d+qm1d*h2+qm1*h2d)*r_1 + (qp1*h1+qm1*
     +          h2)*r_1d
              h = (qp1*h1+qm1*h2)*r_1
              qd = .5*(ud*u+u*ud+vd*v+v*vd+wd*w+w*wd)
              q = .5*(u*u+v*v+w*w)
              IF (h - q .GE. 0.) THEN
                abs24d = hd - qd
                abs24 = h - q
              ELSE
                abs24d = -(hd-qd)
                abs24 = -(h-q)
              END IF
              IF ((gam-1.)*abs24 .EQ. 0.0) THEN
                cd = 0.D0
              ELSE
                cd = (gam-1.)*abs24d/(2.0*SQRT((gam-1.)*abs24))
              END IF
              c = SQRT((gam-1.)*abs24)
C
Cdetermination vitesse normale interface
              qn1d = tcx*qp2d + tcy*qp3d + tcz*qp4d
              qn1 = qp2*tcx + qp3*tcy + qp4*tcz
              qn2d = tcx*qm2d + tcy*qm3d + tcz*qm4d
              qn2 = qm2*tcx + qm3*tcy + qm4*tcz
C
              dud = si*(qm2d-qp2d)
              du = (qm2-qp2)*si
              dvd = si*(qm3d-qp3d)
              dv = (qm3-qp3)*si
              dwd = si*(qm4d-qp4d)
              dw = (qm4-qp4)*si
              dpd = p2d - p1d
              dp = p2 - p1
CSdqn
              dqnd = qn2d - qn1d
              dqn = qn2 - qn1
              IF (si .LT. 1.e-30) THEN
                max64 = 1.e-30
              ELSE
                max64 = si
              END IF
C
C.....Evaluation des valeurs propres
              s_1 = 1.0/max64
              nx = tcx*s_1
              ny = tcy*s_1
              nz = tcz*s_1
C
              qnd = nx*ud + ny*vd + nz*wd
              qn = u*nx + v*ny + w*nz
C
              f1d = qnd
              f1 = qn
              IF (f1 .GE. 0.) THEN
                abs25d = f1d
                abs25 = f1
              ELSE
                abs25d = -f1d
                abs25 = -f1
              END IF
Cdelta
              f4d = psiroe*(abs25d+cd)
              f4 = psiroe*(abs25+c)
              IF (f1 .GE. 0.) THEN
                abs26 = f1
              ELSE
                abs26 = -f1
              END IF
C
              f2 = 0.5 + SIGN(0.5, abs26 - f4)
              IF (f1 .GE. 0.) THEN
                abs27d = f1d
                abs27 = f1
              ELSE
                abs27d = -f1d
                abs27 = -f1
              END IF
              f3d = (f2-1.0)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs27d
              f3 = (f2-1.0)*(f1*f1/f4+f4)*0.5 - f2*abs27
C  a123
              f1d = si*(r2d-r1d-(dpd*c**2-dp*(cd*c+c*cd))/(c*c)**2)
              f1 = (r2-r1-dp/(c*c))*si
              flu1d = f3d*f1 + f3*f1d
              flu1 = f3*f1
              flu2d = f3d*(f1*u+r*(du-nx*dqn)) + f3*(f1d*u+f1*ud+rd*(du-
     +          nx*dqn)+r*(dud-nx*dqnd))
              flu2 = f3*(f1*u+r*(du-nx*dqn))
              flu3d = f3d*(f1*v+r*(dv-ny*dqn)) + f3*(f1d*v+f1*vd+rd*(dv-
     +          ny*dqn)+r*(dvd-ny*dqnd))
              flu3 = f3*(f1*v+r*(dv-ny*dqn))
              flu4d = f3d*(f1*w+r*(dw-nz*dqn)) + f3*(f1d*w+f1*wd+rd*(dw-
     +          nz*dqn)+r*(dwd-nz*dqnd))
              flu4 = f3*(f1*w+r*(dw-nz*dqn))
              flu5d = f3d*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn)) + f3*(f1d*q+
     +          f1*qd+rd*(u*du+v*dv+w*dw-qn*dqn)+r*(ud*du+u*dud+vd*dv+v*
     +          dvd+wd*dw+w*dwd-qnd*dqn-qn*dqnd))
              flu5 = f3*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn))
C
              f1d = qnd + cd
              f1 = qn + c
              IF (f1 .GE. 0.) THEN
                abs28 = f1
              ELSE
                abs28 = -f1
              END IF
              f2 = 0.5 + SIGN(0.5, abs28 - f4)
              IF (f1 .GE. 0.) THEN
                abs29d = f1d
                abs29 = f1
              ELSE
                abs29d = -f1d
                abs29 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs29d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs29
Clambda4*S*a4
              f1d = si*(((dpd+s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp+r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp+r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp+r*c*dqn*s_1)/(2.*c*c)*si*f3
C
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u+nx*c) + f1*(ud+nx*cd)
              flu2 = flu2 + f1*(u+nx*c)
              flu3d = flu3d + f1d*(v+ny*c) + f1*(vd+ny*cd)
              flu3 = flu3 + f1*(v+ny*c)
              flu4d = flu4d + f1d*(w+nz*c) + f1*(wd+nz*cd)
              flu4 = flu4 + f1*(w+nz*c)
              flu5d = flu5d + f1d*(h+qn*c) + f1*(hd+qnd*c+qn*cd)
              flu5 = flu5 + f1*(h+qn*c)
C
              f1d = qnd - cd
              f1 = qn - c
              IF (f1 .GE. 0.) THEN
                abs30 = f1
              ELSE
                abs30 = -f1
              END IF
              f2 = 0.5 + SIGN(0.5, abs30 - f4)
              IF (f1 .GE. 0.) THEN
                abs31d = f1d
                abs31 = f1
              ELSE
                abs31d = -f1d
                abs31 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs31d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs31
C
Clambda5*S*a5
              f1d = si*(((dpd-s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp-r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp-r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp-r*c*dqn*s_1)/(2.*c*c)*f3*si
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u-nx*c) + f1*(ud-nx*cd)
              flu2 = flu2 + f1*(u-nx*c)
              flu3d = flu3d + f1d*(v-ny*c) + f1*(vd-ny*cd)
              flu3 = flu3 + f1*(v-ny*c)
              flu4d = flu4d + f1d*(w-nz*c) + f1*(wd-nz*cd)
              flu4 = flu4 + f1*(w-nz*c)
              flu5d = flu5d + f1d*(h-qn*c) + f1*(hd-qnd*c-qn*cd)
              flu5 = flu5 + f1*(h-qn*c)
C
              rou1d = r1d*qn1 + r1*qn1d
              rou1 = r1*qn1
              rou2d = r2d*qn2 + r2*qn2d
              rou2 = r2*qn2
              p1p2d = p1d + p2d
              p1p2 = p1 + p2
              flu1d = 0.5*(flu1d+rou1d+rou2d)
              flu1 = (flu1+rou1+rou2)*0.5
              flu2d = 0.5*(flu2d+rou1d*qp2+rou1*qp2d+rou2d*qm2+rou2*qm2d
     +          +tcx*p1p2d)
              flu2 = (flu2+rou1*qp2+rou2*qm2+tcx*p1p2)*0.5
              flu3d = 0.5*(flu3d+rou1d*qp3+rou1*qp3d+rou2d*qm3+rou2*qm3d
     +          +tcy*p1p2d)
              flu3 = (flu3+rou1*qp3+rou2*qm3+tcy*p1p2)*0.5
              flu4d = 0.5*(flu4d+rou1d*qp4+rou1*qp4d+rou2d*qm4+rou2*qm4d
     +          +tcz*p1p2d)
              flu4 = (flu4+rou1*qp4+rou2*qm4+tcz*p1p2)*0.5
C1=?+1; 
C3=?+2 
C2=?-1
C4=?-2
Cl341  = (i+2,j-2,k+1)
              flu5d = 0.5*(flu5d+rou1d*h1+rou1*h1d+rou2d*h2+rou2*h2d)
              flu5 = (flu5+rou1*h1+rou2*h2)*0.5
              lt200 = lt - inci_mtr
              lt100 = lt + inci_mtr
              lt010 = lt + incj_mtr
              lt210 = lt - inci_mtr + incj_mtr
              lt201 = lt - inci_mtr + inck_mtr
              lt001 = lt + inck_mtr
C
              lvor = lt
              lvol = lt200
C
              il = l - inci
              ir = l
              l100 = l + inci
              l010 = l + incj
              l020 = l - incj
              l001 = l + inck
              l002 = l - inck
              l210 = l - inci + incj
              l220 = l - inci - incj
              l201 = l - inci + inck
CCalcul des vecteurs surfaces I
              l202 = l - inci - inck
C
CCCCCC
CCCCCC
CCCCCC   Facette I
CCCCCC
CCCCCC
              tix = .5*(ti(lt+v1mtr)+ti(lt200+v1mtr))
              tiy = .5*(ti(lt+v2mtr)+ti(lt200+v2mtr))
              tiz = .5*(ti(lt+v3mtr)+ti(lt200+v3mtr))
              tix1 = .5*(ti(lt+v1mtr)+ti(lt100+v1mtr))
              tiy1 = .5*(ti(lt+v2mtr)+ti(lt100+v2mtr))
              tiz1 = .5*(ti(lt+v3mtr)+ti(lt100+v3mtr))
C
              tjx = .125*(tj(lt+v1mtr)+tj(lt200+v1mtr))
              tjy = .125*(tj(lt+v2mtr)+tj(lt200+v2mtr))
              tjz = .125*(tj(lt+v3mtr)+tj(lt200+v3mtr))
              tjx1 = .125*(tj(lt010+v1mtr)+tj(lt210+v1mtr))
              tjy1 = .125*(tj(lt010+v2mtr)+tj(lt210+v2mtr))
              tjz1 = .125*(tj(lt010+v3mtr)+tj(lt210+v3mtr))
C
              tkx = .125*(tk(lt+v1mtr)+tk(lt200+v1mtr))
              tky = .125*(tk(lt+v2mtr)+tk(lt200+v2mtr))
              tkz = .125*(tk(lt+v3mtr)+tk(lt200+v3mtr))
              tkx1 = .125*(tk(lt001+v1mtr)+tk(lt201+v1mtr))
              tky1 = .125*(tk(lt001+v2mtr)+tk(lt201+v2mtr))
C --- Gradients en U_i
              tkz1 = .125*(tk(lt001+v3mtr)+tk(lt201+v3mtr))
C
              f1d = ropd(il+v2)
              f1 = rop(il+v2)
              f2d = ropd(ir+v2)
              f2 = rop(ir+v2)
              f3d = ropd(ir+v2) + ropd(il+v2) + ropd(l220+v2) + ropd(
     +          l020+v2)
              f3 = rop(ir+v2) + rop(il+v2) + rop(l220+v2) + rop(l020+v2)
              f4d = ropd(ir+v2) + ropd(il+v2) + ropd(l210+v2) + ropd(
     +          l010+v2)
              f4 = rop(ir+v2) + rop(il+v2) + rop(l210+v2) + rop(l010+v2)
              f5d = ropd(ir+v2) + ropd(il+v2) + ropd(l202+v2) + ropd(
     +          l002+v2)
              f5 = rop(ir+v2) + rop(il+v2) + rop(l202+v2) + rop(l002+v2)
              f6d = ropd(ir+v2) + ropd(il+v2) + ropd(l201+v2) + ropd(
     +          l001+v2)
              f6 = rop(ir+v2) + rop(il+v2) + rop(l201+v2) + rop(l001+v2)
C
              gradu_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradu_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradu_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradu_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- Gradients en v_i
              gradu_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradu_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v3)
              f1 = rop(il+v3)
              f2d = ropd(ir+v3)
              f2 = rop(ir+v3)
              f3d = ropd(ir+v3) + ropd(il+v3) + ropd(l220+v3) + ropd(
     +          l020+v3)
              f3 = rop(ir+v3) + rop(il+v3) + rop(l220+v3) + rop(l020+v3)
              f4d = ropd(ir+v3) + ropd(il+v3) + ropd(l210+v3) + ropd(
     +          l010+v3)
              f4 = rop(ir+v3) + rop(il+v3) + rop(l210+v3) + rop(l010+v3)
              f5d = ropd(ir+v3) + ropd(il+v3) + ropd(l202+v3) + ropd(
     +          l002+v3)
              f5 = rop(ir+v3) + rop(il+v3) + rop(l202+v3) + rop(l002+v3)
              f6d = ropd(ir+v3) + ropd(il+v3) + ropd(l201+v3) + ropd(
     +          l001+v3)
              f6 = rop(ir+v3) + rop(il+v3) + rop(l201+v3) + rop(l001+v3)
C
              gradv_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradv_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradv_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradv_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- Gradients en W_i
              gradv_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradv_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v4)
              f1 = rop(il+v4)
              f2d = ropd(ir+v4)
              f2 = rop(ir+v4)
              f3d = ropd(ir+v4) + ropd(il+v4) + ropd(l220+v4) + ropd(
     +          l020+v4)
              f3 = rop(ir+v4) + rop(il+v4) + rop(l220+v4) + rop(l020+v4)
              f4d = ropd(ir+v4) + ropd(il+v4) + ropd(l210+v4) + ropd(
     +          l010+v4)
              f4 = rop(ir+v4) + rop(il+v4) + rop(l210+v4) + rop(l010+v4)
              f5d = ropd(ir+v4) + ropd(il+v4) + ropd(l202+v4) + ropd(
     +          l002+v4)
              f5 = rop(ir+v4) + rop(il+v4) + rop(l202+v4) + rop(l002+v4)
              f6d = ropd(ir+v4) + ropd(il+v4) + ropd(l201+v4) + ropd(
     +          l001+v4)
              f6 = rop(ir+v4) + rop(il+v4) + rop(l201+v4) + rop(l001+v4)
C
              gradw_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradw_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradw_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradw_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- Gradients en T_i
              gradw_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradw_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v5)
              f1 = rop(il+v5)
              f2d = ropd(ir+v5)
              f2 = rop(ir+v5)
              f3d = ropd(ir+v5) + ropd(il+v5) + ropd(l220+v5) + ropd(
     +          l020+v5)
              f3 = rop(ir+v5) + rop(il+v5) + rop(l220+v5) + rop(l020+v5)
              f4d = ropd(ir+v5) + ropd(il+v5) + ropd(l210+v5) + ropd(
     +          l010+v5)
              f4 = rop(ir+v5) + rop(il+v5) + rop(l210+v5) + rop(l010+v5)
              f5d = ropd(ir+v5) + ropd(il+v5) + ropd(l202+v5) + ropd(
     +          l002+v5)
              f5 = rop(ir+v5) + rop(il+v5) + rop(l202+v5) + rop(l002+v5)
              f6d = ropd(ir+v5) + ropd(il+v5) + ropd(l201+v5) + ropd(
     +          l001+v5)
              f6 = rop(ir+v5) + rop(il+v5) + rop(l201+v5) + rop(l001+v5)
C
              gradt_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradt_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradt_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradt_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- assemblage flux
              gradt_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradt_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              divd = cvisq*(gradu_nxd+gradv_nyd+gradw_nzd)
              div = (gradu_nx+gradv_ny+gradw_nz)*cvisq
              f1d = gradu_nxd - divd
              f1 = gradu_nx - div
              f2d = gradu_nyd + gradv_nxd
              f2 = gradu_ny + gradv_nx
              f3d = gradu_nzd + gradw_nxd
              f3 = gradu_nz + gradw_nx
              f4d = gradv_nyd - divd
              f4 = gradv_ny - div
              f5d = gradv_nzd + gradw_nyd
              f5 = gradv_nz + gradw_ny
              f6d = gradw_nzd - divd
              f6 = gradw_nz - div
C
              volinv = 1./(vol(lvor)+vol(lvol))
              xmutvol = (xmut(ir)+xmut(il))*volinv
              xktvol = xmutvol*gam3
C
              fvd = -(xmutvol*(2.*tcx*f1d+tcy*f2d+tcz*f3d))
              fv = -((2.*f1*tcx+f2*tcy+f3*tcz)*xmutvol)
              fv5d = fvd*(rop(ir+v2)+rop(il+v2)) + fv*(ropd(ir+v2)+ropd(
     +          il+v2))
              fv5 = fv*(rop(ir+v2)+rop(il+v2))
              flu2d = flu2d + fvd
              flu2 = flu2 + fv
C
              fvd = -(xmutvol*(tcx*f2d+2.*tcy*f4d+tcz*f5d))
              fv = -((f2*tcx+2.*f4*tcy+f5*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v3)+rop(il+v3)) + fv*(ropd(ir+v3
     +          )+ropd(il+v3))
              fv5 = fv5 + fv*(rop(ir+v3)+rop(il+v3))
              flu3d = flu3d + fvd
              flu3 = flu3 + fv
C
              fvd = -(xmutvol*(tcx*f3d+tcy*f5d+2.*tcz*f6d))
              fv = -((f3*tcx+f5*tcy+2.*f6*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v4)+rop(il+v4)) + fv*(ropd(ir+v4
     +          )+ropd(il+v4))
              fv5 = fv5 + fv*(rop(ir+v4)+rop(il+v4))
              flu4d = flu4d + fvd
              flu4 = flu4 + fv
C
              fvd = 0.5*fv5d - xktvol*(tcx*gradt_nxd+tcy*gradt_nyd+tcz*
     +          gradt_nzd)
              fv = fv5*0.5 - (gradt_nx*tcx+gradt_ny*tcy+gradt_nz*tcz)*
     +          xktvol
              flu5d = flu5d + fvd
              flu5 = flu5 + fv
C
              ls = l - inci
              drodmd(ls+v1) = drodmd(ls+v1) - flu1d
              drodmd(ls+v2) = drodmd(ls+v2) - flu2d
              drodmd(ls+v3) = drodmd(ls+v3) - flu3d
              drodmd(ls+v4) = drodmd(ls+v4) - flu4d
              drodmd(ls+v5) = drodmd(ls+v5) - flu5d
            END IF
          ENDDO
Cdo j
CComplement fluj en Jmax
C
          IF (jcorr .EQ. 1) THEN
C
            j = ind_loop(4) + 1
C
            lij = 1 + (ind_loop(1)+param_int(0+3)-1) + (j+param_int(0+3)
     +        -1)*param_int(0) + (k+param_int(0+4)-1)*param_int(0)*
     +        param_int(0+1) - 1
            ltij = lij - (1+(ind_loop(1)+param_int(5+3)-1)*param_int(5)+
     +        (j+param_int(5+3)-1)*param_int(5+1)+(k+param_int(5+4)-1)*
     +        param_int(5+2)) + 1
CC    !DIR$ ASSUME (mod(lij,4) .eq. 0)
CDIR$ IVDEP
CDIR$ DISTRIBUTE POINT
            DO l=lij+1,lij+1+ind_loop(2)-ind_loop(1)
C
              lt = l - ltij
              lvo = lt
C
C.....Metrique
              tcx = tj(lt+v1mtr)
              tcy = tj(lt+v2mtr)
              tcz = tj(lt+v3mtr)
              arg1 = tcx*tcx + tcy*tcy + tcz*tcz
              sj = SQRT(arg1)
C
              nm = l - incj
              nm2 = l - 2*incj
              np = l + incj
C
C pente (qm) a l'interface droite et  (qp) a l'interface gauche
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v1
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y61 = 1.
                y61d = 0.0
              ELSE
                y61d = tmin_1*ropd(l+v5)
                y61 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y61) THEN
                max65d = y61d
                max65 = y61
              ELSE
                max65 = 0.
                max65d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max65d
              roff = .5*max65
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x41d = delmd
                x41 = delm
              ELSE
                x41d = -delmd
                x41 = -delm
              END IF
              y131d = SIGN(1., delm)*delpd
              y131 = SIGN(1., delm)*delp
              IF (x41 .GT. y131) THEN
                y62d = y131d
                y62 = y131
              ELSE
                y62d = x41d
                y62 = x41
              END IF
              IF (0. .LT. y62) THEN
                max66d = y62d
                max66 = y62
              ELSE
                max66 = 0.
                max66d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max66+roff*max66d)
              slp = roff*(SIGN(1., delm)*max66)
              IF (delq .GE. 0.) THEN
                x42d = delqd
                x42 = delq
              ELSE
                x42d = -delqd
                x42 = -delq
              END IF
              y132d = SIGN(1., delq)*delmd
              y132 = SIGN(1., delq)*delm
              IF (x42 .GT. y132) THEN
                y63d = y132d
                y63 = y132
              ELSE
                y63d = x42d
                y63 = x42
              END IF
              IF (0. .LT. y63) THEN
                max67d = y63d
                max67 = y63
              ELSE
                max67 = 0.
                max67d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max67+roff*max67d)
              slq = roff*(SIGN(1., delq)*max67)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm1d = qmd
              qm1 = qm
              qp1d = qpd
              qp1 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v2
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y64 = 1.
                y64d = 0.0
              ELSE
                y64d = tmin_1*ropd(l+v5)
                y64 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y64) THEN
                max68d = y64d
                max68 = y64
              ELSE
                max68 = 0.
                max68d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max68d
              roff = .5*max68
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x43d = delmd
                x43 = delm
              ELSE
                x43d = -delmd
                x43 = -delm
              END IF
              y133d = SIGN(1., delm)*delpd
              y133 = SIGN(1., delm)*delp
              IF (x43 .GT. y133) THEN
                y65d = y133d
                y65 = y133
              ELSE
                y65d = x43d
                y65 = x43
              END IF
              IF (0. .LT. y65) THEN
                max69d = y65d
                max69 = y65
              ELSE
                max69 = 0.
                max69d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max69+roff*max69d)
              slp = roff*(SIGN(1., delm)*max69)
              IF (delq .GE. 0.) THEN
                x44d = delqd
                x44 = delq
              ELSE
                x44d = -delqd
                x44 = -delq
              END IF
              y134d = SIGN(1., delq)*delmd
              y134 = SIGN(1., delq)*delm
              IF (x44 .GT. y134) THEN
                y66d = y134d
                y66 = y134
              ELSE
                y66d = x44d
                y66 = x44
              END IF
              IF (0. .LT. y66) THEN
                max70d = y66d
                max70 = y66
              ELSE
                max70 = 0.
                max70d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max70+roff*max70d)
              slq = roff*(SIGN(1., delq)*max70)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm2d = qmd
              qm2 = qm
              qp2d = qpd
              qp2 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v3
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y67 = 1.
                y67d = 0.0
              ELSE
                y67d = tmin_1*ropd(l+v5)
                y67 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y67) THEN
                max71d = y67d
                max71 = y67
              ELSE
                max71 = 0.
                max71d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max71d
              roff = .5*max71
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x45d = delmd
                x45 = delm
              ELSE
                x45d = -delmd
                x45 = -delm
              END IF
              y135d = SIGN(1., delm)*delpd
              y135 = SIGN(1., delm)*delp
              IF (x45 .GT. y135) THEN
                y68d = y135d
                y68 = y135
              ELSE
                y68d = x45d
                y68 = x45
              END IF
              IF (0. .LT. y68) THEN
                max72d = y68d
                max72 = y68
              ELSE
                max72 = 0.
                max72d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max72+roff*max72d)
              slp = roff*(SIGN(1., delm)*max72)
              IF (delq .GE. 0.) THEN
                x46d = delqd
                x46 = delq
              ELSE
                x46d = -delqd
                x46 = -delq
              END IF
              y136d = SIGN(1., delq)*delmd
              y136 = SIGN(1., delq)*delm
              IF (x46 .GT. y136) THEN
                y69d = y136d
                y69 = y136
              ELSE
                y69d = x46d
                y69 = x46
              END IF
              IF (0. .LT. y69) THEN
                max73d = y69d
                max73 = y69
              ELSE
                max73 = 0.
                max73d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max73+roff*max73d)
              slq = roff*(SIGN(1., delq)*max73)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm3d = qmd
              qm3 = qm
              qp3d = qpd
              qp3 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v4
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y70 = 1.
                y70d = 0.0
              ELSE
                y70d = tmin_1*ropd(l+v5)
                y70 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y70) THEN
                max74d = y70d
                max74 = y70
              ELSE
                max74 = 0.
                max74d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max74d
              roff = .5*max74
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x47d = delmd
                x47 = delm
              ELSE
                x47d = -delmd
                x47 = -delm
              END IF
              y137d = SIGN(1., delm)*delpd
              y137 = SIGN(1., delm)*delp
              IF (x47 .GT. y137) THEN
                y71d = y137d
                y71 = y137
              ELSE
                y71d = x47d
                y71 = x47
              END IF
              IF (0. .LT. y71) THEN
                max75d = y71d
                max75 = y71
              ELSE
                max75 = 0.
                max75d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max75+roff*max75d)
              slp = roff*(SIGN(1., delm)*max75)
              IF (delq .GE. 0.) THEN
                x48d = delqd
                x48 = delq
              ELSE
                x48d = -delqd
                x48 = -delq
              END IF
              y138d = SIGN(1., delq)*delmd
              y138 = SIGN(1., delq)*delm
              IF (x48 .GT. y138) THEN
                y72d = y138d
                y72 = y138
              ELSE
                y72d = x48d
                y72 = x48
              END IF
              IF (0. .LT. y72) THEN
                max76d = y72d
                max76 = y72
              ELSE
                max76 = 0.
                max76d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max76+roff*max76d)
              slq = roff*(SIGN(1., delq)*max76)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm4d = qmd
              qm4 = qm
              qp4d = qpd
              qp4 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v5
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y73 = 1.
                y73d = 0.0
              ELSE
                y73d = tmin_1*ropd(l+v5)
                y73 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y73) THEN
                max77d = y73d
                max77 = y73
              ELSE
                max77 = 0.
                max77d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max77d
              roff = .5*max77
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x49d = delmd
                x49 = delm
              ELSE
                x49d = -delmd
                x49 = -delm
              END IF
              y139d = SIGN(1., delm)*delpd
              y139 = SIGN(1., delm)*delp
              IF (x49 .GT. y139) THEN
                y74d = y139d
                y74 = y139
              ELSE
                y74d = x49d
                y74 = x49
              END IF
              IF (0. .LT. y74) THEN
                max78d = y74d
                max78 = y74
              ELSE
                max78 = 0.
                max78d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max78+roff*max78d)
              slp = roff*(SIGN(1., delm)*max78)
              IF (delq .GE. 0.) THEN
                x50d = delqd
                x50 = delq
              ELSE
                x50d = -delqd
                x50 = -delq
              END IF
              y140d = SIGN(1., delq)*delmd
              y140 = SIGN(1., delq)*delm
              IF (x50 .GT. y140) THEN
                y75d = y140d
                y75 = y140
              ELSE
                y75d = x50d
                y75 = x50
              END IF
              IF (0. .LT. y75) THEN
                max79d = y75d
                max79 = y75
              ELSE
                max79 = 0.
                max79d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max79+roff*max79d)
              slq = roff*(SIGN(1., delq)*max79)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm5d = qmd
              qm5 = qm
              qp5d = qpd
              qp5 = qp
C
Cdetermination etat gauche (rou1) et droit (rou2): ro, roui, roe+p
              r1d = qp1d
              r1 = qp1
              p1d = rgp*(r1d*qp5+r1*qp5d)
              p1 = r1*qp5*rgp
Cdetermination etat droite: ro, roui, roe+p
              h1d = gam1*rgp*qp5d + .5*(qp2d*qp2+qp2*qp2d+qp3d*qp3+qp3*
     +          qp3d+qp4d*qp4+qp4*qp4d)
              h1 = gam1*qp5*rgp + .5*(qp2*qp2+qp3*qp3+qp4*qp4)
C
              r2d = qm1d
              r2 = qm1
              p2d = rgp*(r2d*qm5+r2*qm5d)
              p2 = r2*qm5*rgp
              h2d = gam1*rgp*qm5d + .5*(qm2d*qm2+qm2*qm2d+qm3d*qm3+qm3*
     +          qm3d+qm4d*qm4+qm4*qm4d)
              h2 = gam1*qm5*rgp + .5*(qm2*qm2+qm3*qm3+qm4*qm4)
C
Cdetermination etat moyenne roe
              IF (r1 .EQ. 0.0) THEN
                qp1d = 0.D0
              ELSE
                qp1d = r1d/(2.0*SQRT(r1))
              END IF
              qp1 = SQRT(r1)
              IF (r2 .EQ. 0.0) THEN
                qm1d = 0.D0
              ELSE
                qm1d = r2d/(2.0*SQRT(r2))
              END IF
              qm1 = SQRT(r2)
              rd = qp1d*qm1 + qp1*qm1d
              r = qp1*qm1
              r_1d = -((qp1d+qm1d)/(qp1+qm1)**2)
              r_1 = 1./(qp1+qm1)
              ud = (qp1d*qp2+qp1*qp2d+qm1d*qm2+qm1*qm2d)*r_1 + (qp1*qp2+
     +          qm1*qm2)*r_1d
              u = (qp1*qp2+qm1*qm2)*r_1
              vd = (qp1d*qp3+qp1*qp3d+qm1d*qm3+qm1*qm3d)*r_1 + (qp1*qp3+
     +          qm1*qm3)*r_1d
              v = (qp1*qp3+qm1*qm3)*r_1
              wd = (qp1d*qp4+qp1*qp4d+qm1d*qm4+qm1*qm4d)*r_1 + (qp1*qp4+
     +          qm1*qm4)*r_1d
              w = (qp1*qp4+qm1*qm4)*r_1
              hd = (qp1d*h1+qp1*h1d+qm1d*h2+qm1*h2d)*r_1 + (qp1*h1+qm1*
     +          h2)*r_1d
              h = (qp1*h1+qm1*h2)*r_1
              qd = .5*(ud*u+u*ud+vd*v+v*vd+wd*w+w*wd)
              q = .5*(u*u+v*v+w*w)
              IF (h - q .GE. 0.) THEN
                abs32d = hd - qd
                abs32 = h - q
              ELSE
                abs32d = -(hd-qd)
                abs32 = -(h-q)
              END IF
              IF ((gam-1.)*abs32 .EQ. 0.0) THEN
                cd = 0.D0
              ELSE
                cd = (gam-1.)*abs32d/(2.0*SQRT((gam-1.)*abs32))
              END IF
              c = SQRT((gam-1.)*abs32)
C
Cdetermination vitesse normale interface
              qn1d = tcx*qp2d + tcy*qp3d + tcz*qp4d
              qn1 = qp2*tcx + qp3*tcy + qp4*tcz
              qn2d = tcx*qm2d + tcy*qm3d + tcz*qm4d
              qn2 = qm2*tcx + qm3*tcy + qm4*tcz
C
              dud = sj*(qm2d-qp2d)
              du = (qm2-qp2)*sj
              dvd = sj*(qm3d-qp3d)
              dv = (qm3-qp3)*sj
              dwd = sj*(qm4d-qp4d)
              dw = (qm4-qp4)*sj
              dpd = p2d - p1d
              dp = p2 - p1
CSdqn
              dqnd = qn2d - qn1d
              dqn = qn2 - qn1
              IF (sj .LT. 1.e-30) THEN
                max80 = 1.e-30
              ELSE
                max80 = sj
              END IF
C
C.....Evaluation des valeurs propres
              s_1 = 1./max80
              nx = tcx*s_1
              ny = tcy*s_1
              nz = tcz*s_1
C
              qnd = nx*ud + ny*vd + nz*wd
              qn = u*nx + v*ny + w*nz
C
              f1d = qnd
              f1 = qn
              IF (f1 .GE. 0.) THEN
                abs33d = f1d
                abs33 = f1
              ELSE
                abs33d = -f1d
                abs33 = -f1
              END IF
Cdelta
              f4d = psiroe*(abs33d+cd)
              f4 = psiroe*(abs33+c)
              IF (f1 .GE. 0.) THEN
                abs34 = f1
              ELSE
                abs34 = -f1
              END IF
C
              f2 = .5 + SIGN(.5, abs34 - f4)
              IF (f1 .GE. 0.) THEN
                abs35d = f1d
                abs35 = f1
              ELSE
                abs35d = -f1d
                abs35 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs35d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs35
C  a123
              f1d = sj*(r2d-r1d-(dpd*c**2-dp*(cd*c+c*cd))/(c*c)**2)
              f1 = (r2-r1-dp/(c*c))*sj
              flu1d = f3d*f1 + f3*f1d
              flu1 = f3*f1
              flu2d = f3d*(f1*u+r*(du-nx*dqn)) + f3*(f1d*u+f1*ud+rd*(du-
     +          nx*dqn)+r*(dud-nx*dqnd))
              flu2 = f3*(f1*u+r*(du-nx*dqn))
              flu3d = f3d*(f1*v+r*(dv-ny*dqn)) + f3*(f1d*v+f1*vd+rd*(dv-
     +          ny*dqn)+r*(dvd-ny*dqnd))
              flu3 = f3*(f1*v+r*(dv-ny*dqn))
              flu4d = f3d*(f1*w+r*(dw-nz*dqn)) + f3*(f1d*w+f1*wd+rd*(dw-
     +          nz*dqn)+r*(dwd-nz*dqnd))
              flu4 = f3*(f1*w+r*(dw-nz*dqn))
              flu5d = f3d*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn)) + f3*(f1d*q+
     +          f1*qd+rd*(u*du+v*dv+w*dw-qn*dqn)+r*(ud*du+u*dud+vd*dv+v*
     +          dvd+wd*dw+w*dwd-qnd*dqn-qn*dqnd))
              flu5 = f3*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn))
C
              f1d = qnd + cd
              f1 = qn + c
              IF (f1 .GE. 0.) THEN
                abs36 = f1
              ELSE
                abs36 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs36 - f4)
              IF (f1 .GE. 0.) THEN
                abs37d = f1d
                abs37 = f1
              ELSE
                abs37d = -f1d
                abs37 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs37d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs37
Clambda4*S*a4
              f1d = sj*(((dpd+s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp+r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp+r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp+r*c*dqn*s_1)/(2.*c*c)*sj*f3
C
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u+nx*c) + f1*(ud+nx*cd)
              flu2 = flu2 + f1*(u+nx*c)
              flu3d = flu3d + f1d*(v+ny*c) + f1*(vd+ny*cd)
              flu3 = flu3 + f1*(v+ny*c)
              flu4d = flu4d + f1d*(w+nz*c) + f1*(wd+nz*cd)
              flu4 = flu4 + f1*(w+nz*c)
              flu5d = flu5d + f1d*(h+qn*c) + f1*(hd+qnd*c+qn*cd)
              flu5 = flu5 + f1*(h+qn*c)
C
              f1d = qnd - cd
              f1 = qn - c
              IF (f1 .GE. 0.) THEN
                abs38 = f1
              ELSE
                abs38 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs38 - f4)
              IF (f1 .GE. 0.) THEN
                abs39d = f1d
                abs39 = f1
              ELSE
                abs39d = -f1d
                abs39 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs39d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs39
C
Clambda5*S*a5
              f1d = sj*(((dpd-s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp-r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp-r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp-r*c*dqn*s_1)/(2.*c*c)*f3*sj
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u-nx*c) + f1*(ud-nx*cd)
              flu2 = flu2 + f1*(u-nx*c)
              flu3d = flu3d + f1d*(v-ny*c) + f1*(vd-ny*cd)
              flu3 = flu3 + f1*(v-ny*c)
              flu4d = flu4d + f1d*(w-nz*c) + f1*(wd-nz*cd)
              flu4 = flu4 + f1*(w-nz*c)
              flu5d = flu5d + f1d*(h-qn*c) + f1*(hd-qnd*c-qn*cd)
              flu5 = flu5 + f1*(h-qn*c)
C
              rou1d = r1d*qn1 + r1*qn1d
              rou1 = r1*qn1
              rou2d = r2d*qn2 + r2*qn2d
              rou2 = r2*qn2
              p1p2d = p1d + p2d
              p1p2 = p1 + p2
              flu1d = 0.5*(flu1d+rou1d+rou2d)
              flu1 = (flu1+rou1+rou2)*0.5
              flu2d = 0.5*(flu2d+rou1d*qp2+rou1*qp2d+rou2d*qm2+rou2*qm2d
     +          +tcx*p1p2d)
              flu2 = (flu2+rou1*qp2+rou2*qm2+tcx*p1p2)*0.5
              flu3d = 0.5*(flu3d+rou1d*qp3+rou1*qp3d+rou2d*qm3+rou2*qm3d
     +          +tcy*p1p2d)
              flu3 = (flu3+rou1*qp3+rou2*qm3+tcy*p1p2)*0.5
              flu4d = 0.5*(flu4d+rou1d*qp4+rou1*qp4d+rou2d*qm4+rou2*qm4d
     +          +tcz*p1p2d)
              flu4 = (flu4+rou1*qp4+rou2*qm4+tcz*p1p2)*0.5
C1=?+1; 
C3=?+2 
C2=?-1
C4=?-2
Cl341  = (i+2,j-2,k+1)
              flu5d = 0.5*(flu5d+rou1d*h1+rou1*h1d+rou2d*h2+rou2*h2d)
              flu5 = (flu5+rou1*h1+rou2*h2)*0.5
              lt020 = lt - incj_mtr
              lt021 = lt - incj_mtr + inck_mtr
              lt010 = lt + incj_mtr
              lt001 = lt + inck_mtr
              lt100 = lt + inci_mtr
              lt120 = lt + inci_mtr - incj_mtr
C
              lvor = lt
              lvol = lt020
C
              il = l - incj
              ir = l
              l200 = l - inci
              l100 = l + inci
              l010 = l + incj
              l002 = l - inck
              l001 = l + inck
              l220 = l - inci - incj
              l021 = l - incj + inck
              l022 = l - incj - inck
CCalcul des vecteurs surfaces J
              l120 = l + inci - incj
CCCCCC
CCCCCC
CCCCCC   Facette J
CCCCCC
CCCCCC
              tix = .5*(tj(lt+v1mtr)+tj(lt020+v1mtr))
              tiy = .5*(tj(lt+v2mtr)+tj(lt020+v2mtr))
              tiz = .5*(tj(lt+v3mtr)+tj(lt020+v3mtr))
              tix1 = .5*(tj(lt+v1mtr)+tj(lt010+v1mtr))
              tiy1 = .5*(tj(lt+v2mtr)+tj(lt010+v2mtr))
              tiz1 = .5*(tj(lt+v3mtr)+tj(lt010+v3mtr))
C
C(i,j,k) et (i,j-1,k)
              tjx = .125*(tk(lt+v1mtr)+tk(lt020+v1mtr))
              tjy = .125*(tk(lt+v2mtr)+tk(lt020+v2mtr))
              tjz = .125*(tk(lt+v3mtr)+tk(lt020+v3mtr))
C(i,j,k+1) et (i,j-1,k+1)
              tjx1 = .125*(tk(lt001+v1mtr)+tk(lt021+v1mtr))
              tjy1 = .125*(tk(lt001+v2mtr)+tk(lt021+v2mtr))
              tjz1 = .125*(tk(lt001+v3mtr)+tk(lt021+v3mtr))
C
C(i,j,k) et (i,j-1,k)
              tkx = .125*(ti(lt+v1mtr)+ti(lt020+v1mtr))
              tky = .125*(ti(lt+v2mtr)+ti(lt020+v2mtr))
              tkz = .125*(ti(lt+v3mtr)+ti(lt020+v3mtr))
C(i+1,j,k) et (i+1,j-1,k)
              tkx1 = .125*(ti(lt100+v1mtr)+ti(lt120+v1mtr))
              tky1 = .125*(ti(lt100+v2mtr)+ti(lt120+v2mtr))
C --- Gradients en U_j (i,j,k), (i,j-1,k), (i,j-1,k-1), (i,j,k-1)
              tkz1 = .125*(ti(lt100+v3mtr)+ti(lt120+v3mtr))
C
              f1d = ropd(il+v2)
              f1 = rop(il+v2)
              f2d = ropd(ir+v2)
              f2 = rop(ir+v2)
              f3d = ropd(ir+v2) + ropd(il+v2) + ropd(l022+v2) + ropd(
     +          l002+v2)
              f3 = rop(ir+v2) + rop(il+v2) + rop(l022+v2) + rop(l002+v2)
              f4d = ropd(ir+v2) + ropd(il+v2) + ropd(l021+v2) + ropd(
     +          l001+v2)
              f4 = rop(ir+v2) + rop(il+v2) + rop(l021+v2) + rop(l001+v2)
              f5d = ropd(ir+v2) + ropd(il+v2) + ropd(l220+v2) + ropd(
     +          l200+v2)
              f5 = rop(ir+v2) + rop(il+v2) + rop(l220+v2) + rop(l200+v2)
              f6d = ropd(ir+v2) + ropd(il+v2) + ropd(l120+v2) + ropd(
     +          l100+v2)
              f6 = rop(ir+v2) + rop(il+v2) + rop(l120+v2) + rop(l100+v2)
C
              gradu_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradu_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradu_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradu_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en V_j
              gradu_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradu_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v3)
              f1 = rop(il+v3)
              f2d = ropd(ir+v3)
              f2 = rop(ir+v3)
              f3d = ropd(ir+v3) + ropd(il+v3) + ropd(l022+v3) + ropd(
     +          l002+v3)
              f3 = rop(ir+v3) + rop(il+v3) + rop(l022+v3) + rop(l002+v3)
              f4d = ropd(ir+v3) + ropd(il+v3) + ropd(l021+v3) + ropd(
     +          l001+v3)
              f4 = rop(ir+v3) + rop(il+v3) + rop(l021+v3) + rop(l001+v3)
              f5d = ropd(ir+v3) + ropd(il+v3) + ropd(l220+v3) + ropd(
     +          l200+v3)
              f5 = rop(ir+v3) + rop(il+v3) + rop(l220+v3) + rop(l200+v3)
              f6d = ropd(ir+v3) + ropd(il+v3) + ropd(l120+v3) + ropd(
     +          l100+v3)
              f6 = rop(ir+v3) + rop(il+v3) + rop(l120+v3) + rop(l100+v3)
C
              gradv_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradv_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradv_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradv_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en W_j
              gradv_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradv_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v4)
              f1 = rop(il+v4)
              f2d = ropd(ir+v4)
              f2 = rop(ir+v4)
              f3d = ropd(ir+v4) + ropd(il+v4) + ropd(l022+v4) + ropd(
     +          l002+v4)
              f3 = rop(ir+v4) + rop(il+v4) + rop(l022+v4) + rop(l002+v4)
              f4d = ropd(ir+v4) + ropd(il+v4) + ropd(l021+v4) + ropd(
     +          l001+v4)
              f4 = rop(ir+v4) + rop(il+v4) + rop(l021+v4) + rop(l001+v4)
              f5d = ropd(ir+v4) + ropd(il+v4) + ropd(l220+v4) + ropd(
     +          l200+v4)
              f5 = rop(ir+v4) + rop(il+v4) + rop(l220+v4) + rop(l200+v4)
              f6d = ropd(ir+v4) + ropd(il+v4) + ropd(l120+v4) + ropd(
     +          l100+v4)
              f6 = rop(ir+v4) + rop(il+v4) + rop(l120+v4) + rop(l100+v4)
C
              gradw_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradw_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradw_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradw_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en T_j
              gradw_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradw_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v5)
              f1 = rop(il+v5)
              f2d = ropd(ir+v5)
              f2 = rop(ir+v5)
              f3d = ropd(ir+v5) + ropd(il+v5) + ropd(l022+v5) + ropd(
     +          l002+v5)
              f3 = rop(ir+v5) + rop(il+v5) + rop(l022+v5) + rop(l002+v5)
              f4d = ropd(ir+v5) + ropd(il+v5) + ropd(l021+v5) + ropd(
     +          l001+v5)
              f4 = rop(ir+v5) + rop(il+v5) + rop(l021+v5) + rop(l001+v5)
              f5d = ropd(ir+v5) + ropd(il+v5) + ropd(l220+v5) + ropd(
     +          l200+v5)
              f5 = rop(ir+v5) + rop(il+v5) + rop(l220+v5) + rop(l200+v5)
              f6d = ropd(ir+v5) + ropd(il+v5) + ropd(l120+v5) + ropd(
     +          l100+v5)
              f6 = rop(ir+v5) + rop(il+v5) + rop(l120+v5) + rop(l100+v5)
C
              gradt_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradt_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradt_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradt_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- assemblage flux
              gradt_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradt_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              divd = cvisq*(gradu_nxd+gradv_nyd+gradw_nzd)
              div = (gradu_nx+gradv_ny+gradw_nz)*cvisq
              f1d = gradu_nxd - divd
              f1 = gradu_nx - div
              f2d = gradu_nyd + gradv_nxd
              f2 = gradu_ny + gradv_nx
              f3d = gradu_nzd + gradw_nxd
              f3 = gradu_nz + gradw_nx
              f4d = gradv_nyd - divd
              f4 = gradv_ny - div
              f5d = gradv_nzd + gradw_nyd
              f5 = gradv_nz + gradw_ny
              f6d = gradw_nzd - divd
              f6 = gradw_nz - div
C
              volinv = 1./(vol(lvor)+vol(lvol))
              xmutvol = (xmut(ir)+xmut(il))*volinv
              xktvol = xmutvol*gam3
C
              fvd = -(xmutvol*(2.*tcx*f1d+tcy*f2d+tcz*f3d))
              fv = -((2.*f1*tcx+f2*tcy+f3*tcz)*xmutvol)
              fv5d = fvd*(rop(ir+v2)+rop(il+v2)) + fv*(ropd(ir+v2)+ropd(
     +          il+v2))
              fv5 = fv*(rop(ir+v2)+rop(il+v2))
              flu2d = flu2d + fvd
              flu2 = flu2 + fv
C
              fvd = -(xmutvol*(tcx*f2d+2.*tcy*f4d+tcz*f5d))
              fv = -((f2*tcx+2.*f4*tcy+f5*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v3)+rop(il+v3)) + fv*(ropd(ir+v3
     +          )+ropd(il+v3))
              fv5 = fv5 + fv*(rop(ir+v3)+rop(il+v3))
              flu3d = flu3d + fvd
              flu3 = flu3 + fv
C
              fvd = -(xmutvol*(tcx*f3d+tcy*f5d+2.*tcz*f6d))
              fv = -((f3*tcx+f5*tcy+2.*f6*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v4)+rop(il+v4)) + fv*(ropd(ir+v4
     +          )+ropd(il+v4))
              fv5 = fv5 + fv*(rop(ir+v4)+rop(il+v4))
              flu4d = flu4d + fvd
              flu4 = flu4 + fv
C
              fvd = 0.5*fv5d - xktvol*(tcx*gradt_nxd+tcy*gradt_nyd+tcz*
     +          gradt_nzd)
              fv = fv5*0.5 - (gradt_nx*tcx+gradt_ny*tcy+gradt_nz*tcz)*
     +          xktvol
              flu5d = flu5d + fvd
              flu5 = flu5 + fv
              ls = l - incj
              drodmd(ls+v1) = drodmd(ls+v1) - flu1d
              drodmd(ls+v2) = drodmd(ls+v2) - flu2d
              drodmd(ls+v3) = drodmd(ls+v3) - flu3d
              drodmd(ls+v4) = drodmd(ls+v4) - flu4d
              drodmd(ls+v5) = drodmd(ls+v5) - flu5d
            ENDDO
          END IF
        ENDDO
C
Cdo k
CComplement fluk en Kmax                                         
        IF (kbloc .EQ. ijkv_bloc(3) .AND. synchro_receive_sock(3) .EQ. 0
     +      .AND. kcache .EQ. ijkv_cache(3) .AND. synchro_receive_th(3) 
     +      .EQ. 0) THEN
          k = ind_loop(6) + 1
          DO j=ind_loop(3),ind_loop(4)
            lij = 1 + (ind_loop(1)+param_int(0+3)-1) + (j+param_int(0+3)
     +        -1)*param_int(0) + (k+param_int(0+4)-1)*param_int(0)*
     +        param_int(0+1) - 1
            ltij = lij - (1+(ind_loop(1)+param_int(5+3)-1)*param_int(5)+
     +        (j+param_int(5+3)-1)*param_int(5+1)+(k+param_int(5+4)-1)*
     +        param_int(5+2)) + 1
CC    !DIR$ ASSUME (mod(lij,4) .eq. 0)
CDIR$ IVDEP
CDIR$ DISTRIBUTE POINT
            DO l=lij+1,lij+1+ind_loop(2)-ind_loop(1)
C
              lt = l - ltij
              lvo = lt
C.....Metrique
              tcx = tk(lt+v1mtr)
              tcy = tk(lt+v2mtr)
              tcz = tk(lt+v3mtr)
              arg1 = tcx*tcx + tcy*tcy + tcz*tcz
              sk = SQRT(arg1)
C
              nm = l - inck
              nm2 = l - 2*inck
              np = l + inck
C
C pente (qm) a l'interface droite et  (qp) a l'interface gauche
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v1
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y76 = 1.
                y76d = 0.0
              ELSE
                y76d = tmin_1*ropd(l+v5)
                y76 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y76) THEN
                max81d = y76d
                max81 = y76
              ELSE
                max81 = 0.
                max81d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max81d
              roff = .5*max81
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x51d = delmd
                x51 = delm
              ELSE
                x51d = -delmd
                x51 = -delm
              END IF
              y141d = SIGN(1., delm)*delpd
              y141 = SIGN(1., delm)*delp
              IF (x51 .GT. y141) THEN
                y77d = y141d
                y77 = y141
              ELSE
                y77d = x51d
                y77 = x51
              END IF
              IF (0. .LT. y77) THEN
                max82d = y77d
                max82 = y77
              ELSE
                max82 = 0.
                max82d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max82+roff*max82d)
              slp = roff*(SIGN(1., delm)*max82)
              IF (delq .GE. 0.) THEN
                x52d = delqd
                x52 = delq
              ELSE
                x52d = -delqd
                x52 = -delq
              END IF
              y142d = SIGN(1., delq)*delmd
              y142 = SIGN(1., delq)*delm
              IF (x52 .GT. y142) THEN
                y78d = y142d
                y78 = y142
              ELSE
                y78d = x52d
                y78 = x52
              END IF
              IF (0. .LT. y78) THEN
                max83d = y78d
                max83 = y78
              ELSE
                max83 = 0.
                max83d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max83+roff*max83d)
              slq = roff*(SIGN(1., delq)*max83)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm1d = qmd
              qm1 = qm
              qp1d = qpd
              qp1 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v2
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y79 = 1.
                y79d = 0.0
              ELSE
                y79d = tmin_1*ropd(l+v5)
                y79 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y79) THEN
                max84d = y79d
                max84 = y79
              ELSE
                max84 = 0.
                max84d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max84d
              roff = .5*max84
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x53d = delmd
                x53 = delm
              ELSE
                x53d = -delmd
                x53 = -delm
              END IF
              y143d = SIGN(1., delm)*delpd
              y143 = SIGN(1., delm)*delp
              IF (x53 .GT. y143) THEN
                y80d = y143d
                y80 = y143
              ELSE
                y80d = x53d
                y80 = x53
              END IF
              IF (0. .LT. y80) THEN
                max85d = y80d
                max85 = y80
              ELSE
                max85 = 0.
                max85d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max85+roff*max85d)
              slp = roff*(SIGN(1., delm)*max85)
              IF (delq .GE. 0.) THEN
                x54d = delqd
                x54 = delq
              ELSE
                x54d = -delqd
                x54 = -delq
              END IF
              y144d = SIGN(1., delq)*delmd
              y144 = SIGN(1., delq)*delm
              IF (x54 .GT. y144) THEN
                y81d = y144d
                y81 = y144
              ELSE
                y81d = x54d
                y81 = x54
              END IF
              IF (0. .LT. y81) THEN
                max86d = y81d
                max86 = y81
              ELSE
                max86 = 0.
                max86d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max86+roff*max86d)
              slq = roff*(SIGN(1., delq)*max86)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm2d = qmd
              qm2 = qm
              qp2d = qpd
              qp2 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v3
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y82 = 1.
                y82d = 0.0
              ELSE
                y82d = tmin_1*ropd(l+v5)
                y82 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y82) THEN
                max87d = y82d
                max87 = y82
              ELSE
                max87 = 0.
                max87d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max87d
              roff = .5*max87
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x55d = delmd
                x55 = delm
              ELSE
                x55d = -delmd
                x55 = -delm
              END IF
              y145d = SIGN(1., delm)*delpd
              y145 = SIGN(1., delm)*delp
              IF (x55 .GT. y145) THEN
                y83d = y145d
                y83 = y145
              ELSE
                y83d = x55d
                y83 = x55
              END IF
              IF (0. .LT. y83) THEN
                max88d = y83d
                max88 = y83
              ELSE
                max88 = 0.
                max88d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max88+roff*max88d)
              slp = roff*(SIGN(1., delm)*max88)
              IF (delq .GE. 0.) THEN
                x56d = delqd
                x56 = delq
              ELSE
                x56d = -delqd
                x56 = -delq
              END IF
              y146d = SIGN(1., delq)*delmd
              y146 = SIGN(1., delq)*delm
              IF (x56 .GT. y146) THEN
                y84d = y146d
                y84 = y146
              ELSE
                y84d = x56d
                y84 = x56
              END IF
              IF (0. .LT. y84) THEN
                max89d = y84d
                max89 = y84
              ELSE
                max89 = 0.
                max89d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max89+roff*max89d)
              slq = roff*(SIGN(1., delq)*max89)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm3d = qmd
              qm3 = qm
              qp3d = qpd
              qp3 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v4
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y85 = 1.
                y85d = 0.0
              ELSE
                y85d = tmin_1*ropd(l+v5)
                y85 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y85) THEN
                max90d = y85d
                max90 = y85
              ELSE
                max90 = 0.
                max90d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max90d
              roff = .5*max90
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x57d = delmd
                x57 = delm
              ELSE
                x57d = -delmd
                x57 = -delm
              END IF
              y147d = SIGN(1., delm)*delpd
              y147 = SIGN(1., delm)*delp
              IF (x57 .GT. y147) THEN
                y86d = y147d
                y86 = y147
              ELSE
                y86d = x57d
                y86 = x57
              END IF
              IF (0. .LT. y86) THEN
                max91d = y86d
                max91 = y86
              ELSE
                max91 = 0.
                max91d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max91+roff*max91d)
              slp = roff*(SIGN(1., delm)*max91)
              IF (delq .GE. 0.) THEN
                x58d = delqd
                x58 = delq
              ELSE
                x58d = -delqd
                x58 = -delq
              END IF
              y148d = SIGN(1., delq)*delmd
              y148 = SIGN(1., delq)*delm
              IF (x58 .GT. y148) THEN
                y87d = y148d
                y87 = y148
              ELSE
                y87d = x58d
                y87 = x58
              END IF
              IF (0. .LT. y87) THEN
                max92d = y87d
                max92 = y87
              ELSE
                max92 = 0.
                max92d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max92+roff*max92d)
              slq = roff*(SIGN(1., delq)*max92)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm4d = qmd
              qm4 = qm
              qp4d = qpd
              qp4 = qp
C
CPentes annulees pour toute temperature inferieure a la temperature Tmin
              vslp = v5
              IF (rop(l+v5)*tmin_1 - .5 .GT. 1.) THEN
                y88 = 1.
                y88d = 0.0
              ELSE
                y88d = tmin_1*ropd(l+v5)
                y88 = rop(l+v5)*tmin_1 - .5
              END IF
              IF (0. .LT. y88) THEN
                max93d = y88d
                max93 = y88
              ELSE
                max93 = 0.
                max93d = 0.0
              END IF
C qm: right state,  qp: left state
              roffd = .5*max93d
              roff = .5*max93
C
Ci+1 - i 
              delmd = ropd(l+vslp) - ropd(nm+vslp)
              delm = rop(l+vslp) - rop(nm+vslp)
Ci+2 - i+1
              delpd = ropd(np+vslp) - ropd(l+vslp)
              delp = rop(np+vslp) - rop(l+vslp)
Ci   - i-1
              delqd = ropd(nm+vslp) - ropd(nm2+vslp)
              delq = rop(nm+vslp) - rop(nm2+vslp)
              IF (delm .GE. 0.) THEN
                x59d = delmd
                x59 = delm
              ELSE
                x59d = -delmd
                x59 = -delm
              END IF
              y149d = SIGN(1., delm)*delpd
              y149 = SIGN(1., delm)*delp
              IF (x59 .GT. y149) THEN
                y89d = y149d
                y89 = y149
              ELSE
                y89d = x59d
                y89 = x59
              END IF
              IF (0. .LT. y89) THEN
                max94d = y89d
                max94 = y89
              ELSE
                max94 = 0.
                max94d = 0.0
              END IF
C
C
              slpd = SIGN(1., delm)*(roffd*max94+roff*max94d)
              slp = roff*(SIGN(1., delm)*max94)
              IF (delq .GE. 0.) THEN
                x60d = delqd
                x60 = delq
              ELSE
                x60d = -delqd
                x60 = -delq
              END IF
              y150d = SIGN(1., delq)*delmd
              y150 = SIGN(1., delq)*delm
              IF (x60 .GT. y150) THEN
                y90d = y150d
                y90 = y150
              ELSE
                y90d = x60d
                y90 = x60
              END IF
              IF (0. .LT. y90) THEN
                max95d = y90d
                max95 = y90
              ELSE
                max95 = 0.
                max95d = 0.0
              END IF
Cright state
              slqd = SIGN(1., delq)*(roffd*max95+roff*max95d)
              slq = roff*(SIGN(1., delq)*max95)
C
Cleft state
              qmd = ropd(l+vslp) - slpd
              qm = rop(l+vslp) - slp
C
              qpd = ropd(nm+vslp) + slqd
              qp = rop(nm+vslp) + slq
              qm5d = qmd
              qm5 = qm
              qp5d = qpd
              qp5 = qp
C
Cdetermination etat gauche (rou1) et droit (rou2): ro, roui, roe+p
              r1d = qp1d
              r1 = qp1
              p1d = rgp*(r1d*qp5+r1*qp5d)
              p1 = r1*qp5*rgp
Cdetermination etat droite: ro, roui, roe+p
              h1d = gam1*rgp*qp5d + .5*(qp2d*qp2+qp2*qp2d+qp3d*qp3+qp3*
     +          qp3d+qp4d*qp4+qp4*qp4d)
              h1 = gam1*qp5*rgp + .5*(qp2*qp2+qp3*qp3+qp4*qp4)
C
              r2d = qm1d
              r2 = qm1
              p2d = rgp*(r2d*qm5+r2*qm5d)
              p2 = r2*qm5*rgp
              h2d = gam1*rgp*qm5d + .5*(qm2d*qm2+qm2*qm2d+qm3d*qm3+qm3*
     +          qm3d+qm4d*qm4+qm4*qm4d)
              h2 = gam1*qm5*rgp + .5*(qm2*qm2+qm3*qm3+qm4*qm4)
C
Cdetermination etat moyenne roe
              IF (r1 .EQ. 0.0) THEN
                qp1d = 0.D0
              ELSE
                qp1d = r1d/(2.0*SQRT(r1))
              END IF
              qp1 = SQRT(r1)
              IF (r2 .EQ. 0.0) THEN
                qm1d = 0.D0
              ELSE
                qm1d = r2d/(2.0*SQRT(r2))
              END IF
              qm1 = SQRT(r2)
              rd = qp1d*qm1 + qp1*qm1d
              r = qp1*qm1
              r_1d = -((qp1d+qm1d)/(qp1+qm1)**2)
              r_1 = 1./(qp1+qm1)
              ud = (qp1d*qp2+qp1*qp2d+qm1d*qm2+qm1*qm2d)*r_1 + (qp1*qp2+
     +          qm1*qm2)*r_1d
              u = (qp1*qp2+qm1*qm2)*r_1
              vd = (qp1d*qp3+qp1*qp3d+qm1d*qm3+qm1*qm3d)*r_1 + (qp1*qp3+
     +          qm1*qm3)*r_1d
              v = (qp1*qp3+qm1*qm3)*r_1
              wd = (qp1d*qp4+qp1*qp4d+qm1d*qm4+qm1*qm4d)*r_1 + (qp1*qp4+
     +          qm1*qm4)*r_1d
              w = (qp1*qp4+qm1*qm4)*r_1
              hd = (qp1d*h1+qp1*h1d+qm1d*h2+qm1*h2d)*r_1 + (qp1*h1+qm1*
     +          h2)*r_1d
              h = (qp1*h1+qm1*h2)*r_1
              qd = .5*(ud*u+u*ud+vd*v+v*vd+wd*w+w*wd)
              q = .5*(u*u+v*v+w*w)
              IF (h - q .GE. 0.) THEN
                abs40d = hd - qd
                abs40 = h - q
              ELSE
                abs40d = -(hd-qd)
                abs40 = -(h-q)
              END IF
              IF ((gam-1.)*abs40 .EQ. 0.0) THEN
                cd = 0.D0
              ELSE
                cd = (gam-1.)*abs40d/(2.0*SQRT((gam-1.)*abs40))
              END IF
              c = SQRT((gam-1.)*abs40)
C
Cdetermination vitesse normale interface
              qn1d = tcx*qp2d + tcy*qp3d + tcz*qp4d
              qn1 = qp2*tcx + qp3*tcy + qp4*tcz
              qn2d = tcx*qm2d + tcy*qm3d + tcz*qm4d
              qn2 = qm2*tcx + qm3*tcy + qm4*tcz
C
              dud = sk*(qm2d-qp2d)
              du = (qm2-qp2)*sk
              dvd = sk*(qm3d-qp3d)
              dv = (qm3-qp3)*sk
              dwd = sk*(qm4d-qp4d)
              dw = (qm4-qp4)*sk
              dpd = p2d - p1d
              dp = p2 - p1
CSdqn
              dqnd = qn2d - qn1d
              dqn = qn2 - qn1
              IF (sk .LT. 1.e-30) THEN
                max96 = 1.e-30
              ELSE
                max96 = sk
              END IF
C
C.....Evaluation des valeurs propres
              s_1 = 1./max96
              nx = tcx*s_1
              ny = tcy*s_1
              nz = tcz*s_1
C
              qnd = nx*ud + ny*vd + nz*wd
              qn = u*nx + v*ny + w*nz
C
              f1d = qnd
              f1 = qn
              IF (f1 .GE. 0.) THEN
                abs41d = f1d
                abs41 = f1
              ELSE
                abs41d = -f1d
                abs41 = -f1
              END IF
Cdelta
              f4d = psiroe*(abs41d+cd)
              f4 = psiroe*(abs41+c)
              IF (f1 .GE. 0.) THEN
                abs42 = f1
              ELSE
                abs42 = -f1
              END IF
C
              f2 = .5 + SIGN(.5, abs42 - f4)
              IF (f1 .GE. 0.) THEN
                abs43d = f1d
                abs43 = f1
              ELSE
                abs43d = -f1d
                abs43 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs43d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs43
C  a123
              f1d = sk*(r2d-r1d-(dpd*c**2-dp*(cd*c+c*cd))/(c*c)**2)
              f1 = (r2-r1-dp/(c*c))*sk
              flu1d = f3d*f1 + f3*f1d
              flu1 = f3*f1
              flu2d = f3d*(f1*u+r*(du-nx*dqn)) + f3*(f1d*u+f1*ud+rd*(du-
     +          nx*dqn)+r*(dud-nx*dqnd))
              flu2 = f3*(f1*u+r*(du-nx*dqn))
              flu3d = f3d*(f1*v+r*(dv-ny*dqn)) + f3*(f1d*v+f1*vd+rd*(dv-
     +          ny*dqn)+r*(dvd-ny*dqnd))
              flu3 = f3*(f1*v+r*(dv-ny*dqn))
              flu4d = f3d*(f1*w+r*(dw-nz*dqn)) + f3*(f1d*w+f1*wd+rd*(dw-
     +          nz*dqn)+r*(dwd-nz*dqnd))
              flu4 = f3*(f1*w+r*(dw-nz*dqn))
              flu5d = f3d*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn)) + f3*(f1d*q+
     +          f1*qd+rd*(u*du+v*dv+w*dw-qn*dqn)+r*(ud*du+u*dud+vd*dv+v*
     +          dvd+wd*dw+w*dwd-qnd*dqn-qn*dqnd))
              flu5 = f3*(f1*q+r*(u*du+v*dv+w*dw-qn*dqn))
C
              f1d = qnd + cd
              f1 = qn + c
              IF (f1 .GE. 0.) THEN
                abs44 = f1
              ELSE
                abs44 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs44 - f4)
              IF (f1 .GE. 0.) THEN
                abs45d = f1d
                abs45 = f1
              ELSE
                abs45d = -f1d
                abs45 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs45d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs45
Clambda4*S*a4
              f1d = sk*(((dpd+s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp+r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp+r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp+r*c*dqn*s_1)/(2.*c*c)*sk*f3
C
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u+nx*c) + f1*(ud+nx*cd)
              flu2 = flu2 + f1*(u+nx*c)
              flu3d = flu3d + f1d*(v+ny*c) + f1*(vd+ny*cd)
              flu3 = flu3 + f1*(v+ny*c)
              flu4d = flu4d + f1d*(w+nz*c) + f1*(wd+nz*cd)
              flu4 = flu4 + f1*(w+nz*c)
              flu5d = flu5d + f1d*(h+qn*c) + f1*(hd+qnd*c+qn*cd)
              flu5 = flu5 + f1*(h+qn*c)
C
              f1d = qnd - cd
              f1 = qn - c
              IF (f1 .GE. 0.) THEN
                abs46 = f1
              ELSE
                abs46 = -f1
              END IF
              f2 = .5 + SIGN(.5, abs46 - f4)
              IF (f1 .GE. 0.) THEN
                abs47d = f1d
                abs47 = f1
              ELSE
                abs47d = -f1d
                abs47 = -f1
              END IF
              f3d = (f2-1.)*0.5*(((f1d*f1+f1*f1d)*f4-f1**2*f4d)/f4**2+
     +          f4d) - f2*abs47d
              f3 = (f2-1.)*(f1*f1/f4+f4)*0.5 - f2*abs47
C
Clambda5*S*a5
              f1d = sk*(((dpd-s_1*((rd*c+r*cd)*dqn+r*c*dqnd))*2.*c**2-(
     +          dp-r*c*dqn*s_1)*2.*(cd*c+c*cd))*f3/(2.**2*c**4)+(dp-r*c*
     +          dqn*s_1)*f3d/(2.*c**2))
              f1 = (dp-r*c*dqn*s_1)/(2.*c*c)*f3*sk
              flu1d = flu1d + f1d
              flu1 = flu1 + f1
              flu2d = flu2d + f1d*(u-nx*c) + f1*(ud-nx*cd)
              flu2 = flu2 + f1*(u-nx*c)
              flu3d = flu3d + f1d*(v-ny*c) + f1*(vd-ny*cd)
              flu3 = flu3 + f1*(v-ny*c)
              flu4d = flu4d + f1d*(w-nz*c) + f1*(wd-nz*cd)
              flu4 = flu4 + f1*(w-nz*c)
              flu5d = flu5d + f1d*(h-qn*c) + f1*(hd-qnd*c-qn*cd)
              flu5 = flu5 + f1*(h-qn*c)
C
              rou1d = r1d*qn1 + r1*qn1d
              rou1 = r1*qn1
              rou2d = r2d*qn2 + r2*qn2d
              rou2 = r2*qn2
              p1p2d = p1d + p2d
              p1p2 = p1 + p2
              flu1d = 0.5*(flu1d+rou1d+rou2d)
              flu1 = (flu1+rou1+rou2)*0.5
              flu2d = 0.5*(flu2d+rou1d*qp2+rou1*qp2d+rou2d*qm2+rou2*qm2d
     +          +tcx*p1p2d)
              flu2 = (flu2+rou1*qp2+rou2*qm2+tcx*p1p2)*0.5
              flu3d = 0.5*(flu3d+rou1d*qp3+rou1*qp3d+rou2d*qm3+rou2*qm3d
     +          +tcy*p1p2d)
              flu3 = (flu3+rou1*qp3+rou2*qm3+tcy*p1p2)*0.5
              flu4d = 0.5*(flu4d+rou1d*qp4+rou1*qp4d+rou2d*qm4+rou2*qm4d
     +          +tcz*p1p2d)
              flu4 = (flu4+rou1*qp4+rou2*qm4+tcz*p1p2)*0.5
C1=?+1; 
C3=?+2 
C2=?-1
C4=?-2
Cl341  = (i+2,j-2,k+1)
              flu5d = 0.5*(flu5d+rou1d*h1+rou1*h1d+rou2d*h2+rou2*h2d)
              flu5 = (flu5+rou1*h1+rou2*h2)*0.5
              lt002 = lt - inck_mtr
              lt001 = lt + inck_mtr
              lt102 = lt + inci_mtr - inck_mtr
              lt100 = lt + inci_mtr
              lt010 = lt + incj_mtr
              lt012 = lt + incj_mtr - inck_mtr
C
              lvor = lt
              lvol = lt002
C
              il = l - inck
              ir = l
              l001 = l + inck
              l200 = l - inci
              l100 = l + inci
              l010 = l + incj
              l020 = l - incj
              l202 = l - inci - inck
              l022 = l - incj - inck
              l102 = l + inci - inck
              l012 = l + incj - inck
CCCCCC
CCCCCC
CCCCCC   Facette K
CCCCCC
CCCCCC
              tix = .5*(tk(lt+v1mtr)+tk(lt002+v1mtr))
              tiy = .5*(tk(lt+v2mtr)+tk(lt002+v2mtr))
              tiz = .5*(tk(lt+v3mtr)+tk(lt002+v3mtr))
              tix1 = .5*(tk(lt+v1mtr)+tk(lt001+v1mtr))
              tiy1 = .5*(tk(lt+v2mtr)+tk(lt001+v2mtr))
              tiz1 = .5*(tk(lt+v3mtr)+tk(lt001+v3mtr))
C
              tjx = .125*(ti(lt+v1mtr)+ti(lt002+v1mtr))
              tjy = .125*(ti(lt+v2mtr)+ti(lt002+v2mtr))
              tjz = .125*(ti(lt+v3mtr)+ti(lt002+v3mtr))
              tjx1 = .125*(ti(lt100+v1mtr)+ti(lt102+v1mtr))
              tjy1 = .125*(ti(lt100+v2mtr)+ti(lt102+v2mtr))
              tjz1 = .125*(ti(lt100+v3mtr)+ti(lt102+v3mtr))
C
              tkx = .125*(tj(lt+v1mtr)+tj(lt002+v1mtr))
              tky = .125*(tj(lt+v2mtr)+tj(lt002+v2mtr))
              tkz = .125*(tj(lt+v3mtr)+tj(lt002+v3mtr))
              tkx1 = .125*(tj(lt010+v1mtr)+tj(lt012+v1mtr))
              tky1 = .125*(tj(lt010+v2mtr)+tj(lt012+v2mtr))
C --- Gradients en U_k
              tkz1 = .125*(tj(lt010+v3mtr)+tj(lt012+v3mtr))
C
              f1d = ropd(il+v2)
              f1 = rop(il+v2)
              f2d = ropd(ir+v2)
              f2 = rop(ir+v2)
              f3d = ropd(ir+v2) + ropd(il+v2) + ropd(l202+v2) + ropd(
     +          l200+v2)
              f3 = rop(ir+v2) + rop(il+v2) + rop(l202+v2) + rop(l200+v2)
              f4d = ropd(ir+v2) + ropd(il+v2) + ropd(l102+v2) + ropd(
     +          l100+v2)
              f4 = rop(ir+v2) + rop(il+v2) + rop(l102+v2) + rop(l100+v2)
              f5d = ropd(ir+v2) + ropd(il+v2) + ropd(l022+v2) + ropd(
     +          l020+v2)
              f5 = rop(ir+v2) + rop(il+v2) + rop(l022+v2) + rop(l020+v2)
              f6d = ropd(ir+v2) + ropd(il+v2) + ropd(l012+v2) + ropd(
     +          l010+v2)
              f6 = rop(ir+v2) + rop(il+v2) + rop(l012+v2) + rop(l010+v2)
C
              gradu_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradu_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradu_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradu_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en V_k
              gradu_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradu_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v3)
              f1 = rop(il+v3)
              f2d = ropd(ir+v3)
              f2 = rop(ir+v3)
              f3d = ropd(ir+v3) + ropd(il+v3) + ropd(l202+v3) + ropd(
     +          l200+v3)
              f3 = rop(ir+v3) + rop(il+v3) + rop(l202+v3) + rop(l200+v3)
              f4d = ropd(ir+v3) + ropd(il+v3) + ropd(l102+v3) + ropd(
     +          l100+v3)
              f4 = rop(ir+v3) + rop(il+v3) + rop(l102+v3) + rop(l100+v3)
              f5d = ropd(ir+v3) + ropd(il+v3) + ropd(l022+v3) + ropd(
     +          l020+v3)
              f5 = rop(ir+v3) + rop(il+v3) + rop(l022+v3) + rop(l020+v3)
              f6d = ropd(ir+v3) + ropd(il+v3) + ropd(l012+v3) + ropd(
     +          l010+v3)
              f6 = rop(ir+v3) + rop(il+v3) + rop(l012+v3) + rop(l010+v3)
C
              gradv_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradv_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradv_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradv_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en W_k
              gradv_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradv_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v4)
              f1 = rop(il+v4)
              f2d = ropd(ir+v4)
              f2 = rop(ir+v4)
              f3d = ropd(ir+v4) + ropd(il+v4) + ropd(l202+v4) + ropd(
     +          l200+v4)
              f3 = rop(ir+v4) + rop(il+v4) + rop(l202+v4) + rop(l200+v4)
              f4d = ropd(ir+v4) + ropd(il+v4) + ropd(l102+v4) + ropd(
     +          l100+v4)
              f4 = rop(ir+v4) + rop(il+v4) + rop(l102+v4) + rop(l100+v4)
              f5d = ropd(ir+v4) + ropd(il+v4) + ropd(l022+v4) + ropd(
     +          l020+v4)
              f5 = rop(ir+v4) + rop(il+v4) + rop(l022+v4) + rop(l020+v4)
              f6d = ropd(ir+v4) + ropd(il+v4) + ropd(l012+v4) + ropd(
     +          l010+v4)
              f6 = rop(ir+v4) + rop(il+v4) + rop(l012+v4) + rop(l010+v4)
C
              gradw_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradw_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradw_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradw_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C --- Gradients en T_k
              gradw_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradw_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              f1d = ropd(il+v5)
              f1 = rop(il+v5)
              f2d = ropd(ir+v5)
              f2 = rop(ir+v5)
              f3d = ropd(ir+v5) + ropd(il+v5) + ropd(l202+v5) + ropd(
     +          l200+v5)
              f3 = rop(ir+v5) + rop(il+v5) + rop(l202+v5) + rop(l200+v5)
              f4d = ropd(ir+v5) + ropd(il+v5) + ropd(l102+v5) + ropd(
     +          l100+v5)
              f4 = rop(ir+v5) + rop(il+v5) + rop(l102+v5) + rop(l100+v5)
              f5d = ropd(ir+v5) + ropd(il+v5) + ropd(l022+v5) + ropd(
     +          l020+v5)
              f5 = rop(ir+v5) + rop(il+v5) + rop(l022+v5) + rop(l020+v5)
              f6d = ropd(ir+v5) + ropd(il+v5) + ropd(l012+v5) + ropd(
     +          l010+v5)
              f6 = rop(ir+v5) + rop(il+v5) + rop(l012+v5) + rop(l010+v5)
C
              gradt_nxd = tix1*f2d - tix*f1d + tjx1*f4d - tjx*f3d + tkx1
     +          *f6d - tkx*f5d
              gradt_nx = f2*tix1 - f1*tix + (f4*tjx1-f3*tjx) + (f6*tkx1-
     +          f5*tkx)
              gradt_nyd = tiy1*f2d - tiy*f1d + tjy1*f4d - tjy*f3d + tky1
     +          *f6d - tky*f5d
              gradt_ny = f2*tiy1 - f1*tiy + (f4*tjy1-f3*tjy) + (f6*tky1-
     +          f5*tky)
C--- assemblage flux
              gradt_nzd = tiz1*f2d - tiz*f1d + tjz1*f4d - tjz*f3d + tkz1
     +          *f6d - tkz*f5d
              gradt_nz = f2*tiz1 - f1*tiz + (f4*tjz1-f3*tjz) + (f6*tkz1-
     +          f5*tkz)
C
              divd = cvisq*(gradu_nxd+gradv_nyd+gradw_nzd)
              div = (gradu_nx+gradv_ny+gradw_nz)*cvisq
              f1d = gradu_nxd - divd
              f1 = gradu_nx - div
              f2d = gradu_nyd + gradv_nxd
              f2 = gradu_ny + gradv_nx
              f3d = gradu_nzd + gradw_nxd
              f3 = gradu_nz + gradw_nx
              f4d = gradv_nyd - divd
              f4 = gradv_ny - div
              f5d = gradv_nzd + gradw_nyd
              f5 = gradv_nz + gradw_ny
              f6d = gradw_nzd - divd
              f6 = gradw_nz - div
C
              volinv = 1./(vol(lvor)+vol(lvol))
              xmutvol = (xmut(ir)+xmut(il))*volinv
              xktvol = xmutvol*gam3
C
              fvd = -(xmutvol*(2.*tcx*f1d+tcy*f2d+tcz*f3d))
              fv = -((2.*f1*tcx+f2*tcy+f3*tcz)*xmutvol)
              fv5d = fvd*(rop(ir+v2)+rop(il+v2)) + fv*(ropd(ir+v2)+ropd(
     +          il+v2))
              fv5 = fv*(rop(ir+v2)+rop(il+v2))
              flu2d = flu2d + fvd
              flu2 = flu2 + fv
C
              fvd = -(xmutvol*(tcx*f2d+2.*tcy*f4d+tcz*f5d))
              fv = -((f2*tcx+2.*f4*tcy+f5*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v3)+rop(il+v3)) + fv*(ropd(ir+v3
     +          )+ropd(il+v3))
              fv5 = fv5 + fv*(rop(ir+v3)+rop(il+v3))
              flu3d = flu3d + fvd
              flu3 = flu3 + fv
C
              fvd = -(xmutvol*(tcx*f3d+tcy*f5d+2.*tcz*f6d))
              fv = -((f3*tcx+f5*tcy+2.*f6*tcz)*xmutvol)
              fv5d = fv5d + fvd*(rop(ir+v4)+rop(il+v4)) + fv*(ropd(ir+v4
     +          )+ropd(il+v4))
              fv5 = fv5 + fv*(rop(ir+v4)+rop(il+v4))
              flu4d = flu4d + fvd
              flu4 = flu4 + fv
C
              fvd = 0.5*fv5d - xktvol*(tcx*gradt_nxd+tcy*gradt_nyd+tcz*
     +          gradt_nzd)
              fv = fv5*0.5 - (gradt_nx*tcx+gradt_ny*tcy+gradt_nz*tcz)*
     +          xktvol
              flu5d = flu5d + fvd
              flu5 = flu5 + fv
              ls = l - inck
              drodmd(ls+v1) = drodmd(ls+v1) - flu1d
              drodmd(ls+v2) = drodmd(ls+v2) - flu2d
              drodmd(ls+v3) = drodmd(ls+v3) - flu3d
              drodmd(ls+v4) = drodmd(ls+v4) - flu4d
              drodmd(ls+v5) = drodmd(ls+v5) - flu5d
            ENDDO
          ENDDO
        END IF
      END IF
      END
C

